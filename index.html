<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPSS ASÄ°STANIM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,700;1,700&display=swap');
        
        :root {
            /* VarsayÄ±lan (Gece) */
            --osym-dark: #0a0f1c;
            --osym-card: #161e31;
            --osym-accent: #3b82f6;
            --osym-text: #f8fafc;
            --success-gold: linear-gradient(135deg, #b45309 0%, #f59e0b 50%, #fbbf24 100%);
            --card-border: rgba(255, 255, 255, 0.08);
            --map-line: #1e293b;
        }

        /* Okyanus TemasÄ± */
        body.theme-ocean {
            --osym-dark: #0f172a;
            --osym-card: #1e293b;
            --osym-accent: #06b6d4;
            --success-gold: linear-gradient(135deg, #0891b2 0%, #22d3ee 50%, #67e8f9 100%);
            --map-line: #164e63;
        }

        /* Orman TemasÄ± */
        body.theme-forest {
            --osym-dark: #022c22;
            --osym-card: #064e3b;
            --osym-accent: #10b981;
            --success-gold: linear-gradient(135deg, #15803d 0%, #4ade80 50%, #86efac 100%);
            --map-line: #065f46;
        }

        /* GÃ¼n BatÄ±mÄ± TemasÄ± */
        body.theme-sunset {
            --osym-dark: #2e1065;
            --osym-card: #4c1d95;
            --osym-accent: #f472b6;
            --success-gold: linear-gradient(135deg, #be185d 0%, #db2777 50%, #f9a8d4 100%);
            --map-line: #701a75;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--osym-dark); 
            color: var(--osym-text);
            transition: background-color 0.5s ease, color 0.5s ease;
        }
        
        .glass-morphism { 
            background: rgba(22, 30, 49, 0.6); 
            backdrop-filter: blur(16px); 
            border: 1px solid var(--card-border); 
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
        }

        .checked-item { 
            text-decoration: line-through; 
            opacity: 0.3; 
            transition: all 0.6s ease; 
            transform: translateX(8px); 
        }

        .timer-container { position: relative; width: 180px; height: 180px; margin: 0 auto; }
        .timer-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .timer-circle-bg { fill: none; stroke: rgba(255,255,255,0.03); stroke-width: 6; }
        .timer-circle-progress { fill: none; stroke: var(--osym-accent); stroke-width: 6; stroke-linecap: round; transition: stroke-dashoffset 1s linear; }

        .week-card { transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1); cursor: pointer; }
        .week-card:hover { transform: translateY(-8px) scale(1.02); border-color: var(--osym-accent); box-shadow: 0 30px 60px -20px var(--osym-accent); }
        .week-done { background: var(--success-gold) !important; color: #0a0f1c !important; }

        .day-card-container { perspective: 2000px; min-height: auto; margin-bottom: 1rem; }
        .day-card-inner { 
            position: relative; 
            width: 100%; 
            height: 100%; 
            transition: transform 1.2s cubic-bezier(0.34, 1.56, 0.64, 1); 
            transform-style: preserve-3d; 
            min-height: 280px;
        }
        .is-day-done { transform: rotateY(180deg); }
        .day-card-front, .day-card-back { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            backface-visibility: hidden; 
            border-radius: 2rem; 
        }
        .day-card-front { background: var(--osym-card); border: 1px solid var(--card-border); display: flex; flex-direction: column; }
        .day-card-back { 
            background: var(--success-gold); 
            transform: rotateY(180deg); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            color: #0a0f1c; 
            border: 4px solid rgba(0,0,0,0.1);
        }

        .checkbox-container { width: 22px; height: 22px; position: relative; }
        .checkbox-inner { width: 100%; height: 100%; position: absolute; transform-style: preserve-3d; transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .is-checked .checkbox-inner { transform: rotateY(180deg); }
        .checkbox-front, .checkbox-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 6px; border: 2px solid #334155; }
        .checkbox-back { background: #f59e0b; border-color: #f59e0b; transform: rotateY(180deg); display: flex; align-items: center; justify-content: center; color: #0a0f1c; font-size: 12px; font-weight: bold; }

        #toast {
            position: fixed; top: 24px; left: 50%; transform: translateX(-50%) translateY(-150%);
            background: var(--osym-card); color: white; padding: 18px 36px; border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.6); transition: all 0.7s cubic-bezier(0.68, -0.6, 0.32, 1.6);
            z-index: 10100; border: 2px solid #fbbf24; display: flex; flex-direction: column; align-items: center; gap: 8px;
        }
        #toast.show { transform: translateX(-50%) translateY(0); }

        .fade-in { animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .shimmer { background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent); background-size: 200% 100%; animation: shimmer 3s infinite; }
        
        .certificate-card {
            background: #fffdf9;
            color: #1a1a1a;
            padding: 2.5rem;
            border: 15px solid #fff;
            box-shadow: 0 40px 100px rgba(0,0,0,0.8);
            width: 100%;
            max-width: 600px;
            position: relative;
            background-image: url("https://www.transparenttextures.com/patterns/cream-paper.png");
            margin: 0 auto;
        }
        .cert-border-inner {
            position: absolute;
            inset: 10px;
            border: 2px solid #b45309;
            pointer-events: none;
        }
        .cert-seal {
            width: 80px;
            height: 80px;
            background: #b45309;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: 900;
            text-align: center;
        }
        .gold-gradient-text {
            background: linear-gradient(to bottom, #b45309, #f59e0b, #b45309);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
        }

        .motivation-fade {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .motivation-active {
            opacity: 1;
            transform: translateY(0);
        }

        /* AltÄ±n Buton Efekti */
        .gold-btn {
            background: var(--success-gold);
            color: #0a0f1c !important;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
            transition: all 0.3s ease;
        }
        .gold-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.6);
        }

        /* Nefes Egzersizi Animasyonu */
        @keyframes breathe-anim {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.5); opacity: 1; }
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }

        /* Flashcard Styles */
        .flashcard-container { width: 100%; cursor: pointer; position: relative; perspective: 1000px; }
        .flashcard-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.4s ease; transform-style: preserve-3d; }
        .flashcard-flipped { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { position: absolute; top: 0; left: 0; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 2.4rem; padding: 2rem; }
        .flashcard-front { background: var(--osym-card); z-index: 2; }
        .flashcard-back { background: linear-gradient(145deg, #0d9488, #0f766e); color: white; transform: rotateY(180deg); z-index: 1; }

        /* YENÄ°: OyunlaÅŸtÄ±rma Stilleri */
        #xp-toast.show { transform: translateY(0); opacity: 1; }
        .badge-card { background: linear-gradient(145deg, var(--osym-card), var(--osym-dark)); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1.5rem; padding: 1.5rem; text-align: center; transition: all 0.3s ease; position: relative; overflow: hidden; }
        .badge-card.locked { background: var(--osym-card); filter: grayscale(80%) brightness(0.6); opacity: 0.7; }
        .badge-card.locked .badge-icon { filter: blur(2px); }
        .badge-card:not(.locked):hover { transform: translateY(-8px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); border-color: #f59e0b; }
        .badge-icon { font-size: 3rem; line-height: 1; margin-bottom: 1rem; transition: transform 0.3s ease; }
        .badge-card:not(.locked):hover .badge-icon { transform: scale(1.1); }
        .badge-name { font-weight: 800; font-size: 0.875rem; color: #f8fafc; margin-bottom: 0.25rem; }
        .badge-card.locked .badge-name { color: #64748b; }
        .badge-desc { font-size: 0.75rem; color: #94a3b8; line-height: 1.4; }

        /* YENÄ°: Tooltip Stilleri (Ã‡alÄ±ÅŸan Versiyon) */
        .tooltip-container {
            position: relative;
            display: inline-flex;
            align-items: center;
            outline: none; /* Mobilde dokunma sonrasÄ± Ã§Ä±kan Ã§erÃ§eveyi gizle */
        }
        .tooltip-text {
            visibility: hidden;
            width: 240px;
            max-width: calc(100vw - 32px);
            background-color: var(--osym-card);
            color: #cbd5e1;
            text-align: center;
            border-radius: 0.75rem;
            padding: 1rem;
            position: absolute;
            z-index: 100;
            bottom: 150%;
            left: 50%;
            transform: translateX(-50%); /* Modern merkezleme */
            opacity: 0;
            transition: opacity 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            font-size: 12px;
            line-height: 1.5;
            font-weight: 500;
            pointer-events: none;
        }
        .tooltip-container:hover .tooltip-text, .tooltip-container:focus .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* YENÄ°: Harita Stilleri */
        .map-wrapper { position: relative; padding: 20px 0; max-width: 400px; margin: 0 auto; }
        .map-line { position: absolute; top: 0; bottom: 0; left: 50%; width: 4px; background: var(--map-line); transform: translateX(-50%); border-radius: 2px; z-index: 0; }
        .map-item { position: relative; margin-bottom: 40px; display: flex; justify-content: center; align-items: center; }
        .map-node {
            width: 50px; height: 50px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 900; font-size: 16px;
            position: relative; z-index: 10;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            border: 4px solid var(--osym-dark);
            box-shadow: 0 0 0 4px var(--map-line);
            background: var(--osym-card);
            color: #64748b;
        }
        .map-node:hover { transform: scale(1.15); z-index: 20; }
        .map-node.completed { background: var(--success-gold); color: #0a0f1c; box-shadow: 0 0 15px rgba(245, 158, 11, 0.4); border-color: #f59e0b; }
        .map-node.current { background: var(--osym-accent); color: white; border-color: var(--osym-accent); animation: pulse-node 2s infinite; }
        .map-node.locked { filter: grayscale(100%); opacity: 0.5; cursor: not-allowed; }
        
        .map-content { position: absolute; width: 45%; top: 50%; transform: translateY(-50%); transition: all 0.3s ease; }
        .map-content.left { right: 50%; text-align: right; padding-right: 40px; }
        .map-content.right { left: 50%; text-align: left; padding-left: 40px; }
        
        .map-title { font-weight: 800; font-size: 13px; color: #fff; text-transform: uppercase; margin-bottom: 2px; }
        .map-desc { font-size: 10px; font-weight: 600; color: #94a3b8; }

        /* YENÄ°: Sohbet Stilleri */
        .chat-message { display: flex; gap: 10px; margin-bottom: 12px; align-items: flex-end; animation: fadeIn 0.3s ease; }
        .chat-message.mine { flex-direction: row-reverse; }
        .chat-bubble { max-width: 85%; padding: 14px 18px; border-radius: 20px; font-size: 15px; line-height: 1.5; position: relative; word-wrap: break-word; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .chat-bubble { max-width: 85%; padding: 16px 24px; border-radius: 24px; font-size: 17px; line-height: 1.6; position: relative; word-wrap: break-word; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .chat-message.mine .chat-bubble { background: var(--osym-accent); color: white; border-bottom-right-radius: 2px; }
        .chat-message:not(.mine) .chat-bubble { background: rgba(255,255,255,0.1); color: #e2e8f0; border-bottom-left-radius: 2px; }
        .chat-info { font-size: 9px; color: #64748b; margin-bottom: 4px; font-weight: bold; }
        .chat-message.mine .chat-info { text-align: right; }
        /* YENÄ°: Admin ve Duyuru Stilleri */
        .chat-message.announcement { flex-direction: column; align-items: center; margin: 20px 0; }
        .chat-message.announcement .chat-bubble { background: linear-gradient(135deg, #b45309 0%, #f59e0b 100%); color: #0a0f1c; font-weight: 900; text-align: center; border-radius: 20px; max-width: 90%; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4); border: 2px solid #fff; font-size: 16px; text-transform: uppercase; letter-spacing: 1px; }
        .chat-badge-admin { background: #ef4444; color: white; padding: 2px 6px; border-radius: 4px; font-size: 8px; font-weight: 900; margin-left: 4px; vertical-align: middle; box-shadow: 0 2px 5px rgba(239,68,68,0.4); }
        .delete-msg-btn { opacity: 0.5; transition: all 0.2s; color: #ef4444; cursor: pointer; padding: 4px; font-size: 14px; margin-left: 5px; }
        .delete-msg-btn:hover { opacity: 1; transform: scale(1.2); }
        .chat-message:hover .delete-msg-btn { opacity: 1; }

        /* YENÄ°: Alt MenÃ¼ ve Sayfa YapÄ±sÄ± */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-around; padding: 10px 0 20px 0; z-index: 9000; box-shadow: 0 -10px 40px rgba(0,0,0,0.5); }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: #64748b; font-size: 10px; font-weight: 700; text-transform: uppercase; transition: all 0.3s ease; background: none; border: none; cursor: pointer; width: 20%; }
        .nav-item svg { width: 24px; height: 24px; fill: currentColor; transition: all 0.3s ease; }
        .nav-item.active { color: var(--osym-accent); }
        .nav-item.active svg { transform: translateY(-5px); filter: drop-shadow(0 4px 8px var(--osym-accent)); }
        
        .page-content { display: none; padding-bottom: 100px; animation: fadeInPage 0.4s ease forwards; }
        .page-content.active { display: block; }
        
        @keyframes fadeInPage {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mobilde alt barÄ±n iÃ§eriÄŸi kapatmamasÄ± iÃ§in body padding */
        body { padding-bottom: 80px; }

        @keyframes pulse-node { 0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); } 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } }
        
    </style>
    <style>
        /* Collapsible Sections for Mobile */
        @media (max-width: 767px) {
            .collapsible-on-mobile .collapsible-content {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.7s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .collapsible-on-mobile.is-open .collapsible-content {
                max-height: 5000px; /* A large enough value to not clip content */
            }
            .collapsible-on-mobile .collapsible-trigger {
                cursor: pointer;
                position: relative;
                margin-bottom: 0 !important;
                /* TasarÄ±m iyileÅŸtirmesi ve Ã§akÄ±ÅŸma Ã¶nleme */
                background: linear-gradient(145deg, rgba(30, 41, 59, 0.6), rgba(15, 23, 42, 0.6));
                padding: 1.5rem;
                padding-right: 4rem; /* Ä°kon iÃ§in saÄŸ tarafta gÃ¼venli boÅŸluk */
                border-radius: 1.5rem;
                border: 1px solid rgba(255, 255, 255, 0.1);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease;
            }
            .collapsible-on-mobile.is-open .collapsible-trigger {
                 margin-bottom: 1.5rem !important; /* 24px, same as original mb-6 */
                 background: rgba(255, 255, 255, 0.08);
                 border-color: rgba(255, 255, 255, 0.2);
            }
            .collapsible-trigger::after {
                content: 'â–¼';
                position: absolute;
                right: 1.5rem;
                top: 1.5rem;
                transform: none;
                font-size: 1.5rem;
                color: var(--osym-accent);
                transition: transform 0.3s ease;
            }
            .collapsible-on-mobile.is-open .collapsible-trigger::after {
                transform: rotate(180deg);
            }
        }
    </style>
    <!-- FIREBASE & GOOGLE LOGIN ENTEGRASYONU -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
</head>
<body>

    <!-- WELCOME OVERLAY (YENÄ°: HOÅ GELDÄ°N EKRANI) -->
    <div id="welcome-overlay" class="fixed inset-0 bg-black/95 z-[10070] hidden flex items-center justify-center backdrop-blur-xl transition-opacity duration-1000">
        <div class="text-center transform transition-all duration-1000 scale-100 flex flex-col items-center">
            <div class="relative mb-8">
                <div class="absolute inset-0 bg-amber-500 blur-2xl opacity-40 rounded-full animate-pulse"></div>
                <img id="welcome-avatar" src="" class="relative w-32 h-32 rounded-full border-4 border-amber-500 shadow-2xl object-cover" alt="Avatar">
            </div>
            <h2 class="text-4xl md:text-6xl font-black text-white mb-4 uppercase tracking-tighter drop-shadow-lg">HOÅ GELDÄ°N</h2>
            <p id="welcome-name" class="text-2xl md:text-4xl font-['Playfair_Display'] text-amber-400 italic font-bold">KullanÄ±cÄ± AdÄ±</p>
            <p id="welcome-rank" class="text-lg md:text-xl text-slate-300 font-bold mt-2 uppercase tracking-widest"></p>
            <p class="text-slate-500 text-sm mt-4 font-bold uppercase tracking-widest animate-bounce mt-8">BaÅŸarÄ±ya giden yol yÃ¼kleniyor...</p>
        </div>
    </div>

    <!-- VICTORY OVERLAY -->
    <div id="victory-overlay" class="fixed inset-0 bg-[#0a0f1c]/98 z-[10000] hidden flex flex-col items-center justify-center backdrop-blur-3xl overflow-y-auto py-10">
        <h2 class="text-white text-3xl md:text-5xl font-black mb-8 text-center px-4 tracking-tighter uppercase">PROGRAM <span class="text-amber-500">TAMAMLANDI!</span></h2>
        
        <!-- YENÄ°LENMÄ°Å SERTÄ°FÄ°KA TASARIMI -->
        <div id="ui-certificate" class="certificate-card flex flex-col items-center text-center relative shadow-[0_0_50px_rgba(245,158,11,0.3)]">
           <!-- Dekoratif KÃ¶ÅŸeler -->
            <div class="absolute top-0 left-0 w-16 h-16 border-t-4 border-l-4 border-amber-600 m-2"></div>
            <div class="absolute top-0 right-0 w-16 h-16 border-t-4 border-r-4 border-amber-600 m-2"></div>
            <div class="absolute bottom-0 left-0 w-16 h-16 border-b-4 border-l-4 border-amber-600 m-2"></div>
            <div class="absolute bottom-0 right-0 w-16 h-16 border-b-4 border-r-4 border-amber-600 m-2"></div>
            
            <div class="cert-border-inner border-double border-4 !border-amber-700/20 inset-4"></div>
            
            <div class="w-20 h-20 mb-4 bg-amber-600 rounded-full flex items-center justify-center text-white text-4xl shadow-lg">ğŸ›ï¸</div>
            
            <div class="text-amber-800 font-black tracking-[0.3em] uppercase text-[10px] mb-2">Kamu Personeli SeÃ§me SÄ±navÄ±</div>
            <h3 class="font-['Playfair_Display'] text-4xl md:text-5xl font-bold mb-4 gold-gradient-text drop-shadow-sm">ÃœstÃ¼n BaÅŸarÄ± Belgesi</h3>
            
            <p class="text-slate-500 font-serif italic text-sm mb-2">Bu belge, gÃ¶sterdiÄŸi azim ve kararlÄ±lÄ±kla programÄ± tamamlayan</p>
            
            <div class="relative py-4 px-8 mb-6">
                <span class="absolute top-0 left-1/2 -translate-x-1/2 text-amber-200 text-6xl opacity-20">â</span>
                <p id="cert-user-name" class="text-2xl md:text-4xl font-black uppercase tracking-widest text-slate-900 border-b-2 border-amber-500 pb-2 font-['Playfair_Display']">Ä°SÄ°M SOYAD</p>
            </div>
            
            <p class="text-slate-600 max-w-md text-xs leading-relaxed mb-8 font-medium">
                HaftalÄ±k Ã§alÄ±ÅŸma disiplinini bozmadan tÃ¼m konularÄ± baÅŸarÄ±yla bitirmiÅŸ ve hedefine giden yolda sarsÄ±lmaz bir irade gÃ¶stermiÅŸtir.
            </p>
            
            <div class="flex justify-between w-full items-end px-8 mt-auto">
                <div class="text-left">
                    <div class="text-[9px] text-amber-700 uppercase font-bold tracking-wider mb-1">Onay Tarihi</div>
                    <div class="font-['Playfair_Display'] font-bold text-slate-800 text-lg" id="cert-date">--.--.202X</div>
                </div>
                <div class="flex flex-col items-center">
                    <div class="cert-seal shadow-xl mb-2 scale-110 border-2 border-white">RESMÄ°<br>ONAY</div>
                    <div class="text-[8px] text-amber-700 font-bold uppercase">KPSS Dashboard</div>
                </div>
            </div>
        </div>

        <div class="flex flex-wrap justify-center gap-4 mt-10 px-4">
            <button onclick="document.getElementById('victory-overlay').classList.add('hidden')" class="bg-slate-800 text-white px-8 py-4 rounded-2xl font-bold text-xs border border-white/10 uppercase">Geri DÃ¶n</button>
            <button id="download-certificate-button" class="bg-amber-600 text-white px-10 py-4 rounded-2xl font-black text-xs shadow-xl uppercase">SertifikayÄ± Ä°ndir (PDF)</button>
        </div>
    </div>

    <!-- RESET CONFIRMATION MODAL (YENÄ°) -->
    <div id="reset-modal" class="fixed inset-0 bg-black/90 z-[10001] hidden flex items-center justify-center backdrop-blur-sm transition-all duration-300">
        <div class="bg-[#161e31] border border-red-500/30 p-8 rounded-3xl max-w-sm text-center shadow-2xl transform scale-100">
            <div class="w-20 h-20 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                <span class="text-4xl">âš ï¸</span>
            </div>
            <h3 class="text-2xl font-black text-white mb-3 uppercase tracking-tight">Emin misiniz?</h3>
            <p class="text-slate-400 text-sm font-medium leading-relaxed mb-8">
                TÃ¼m ilerlemeniz kalÄ±cÄ± olarak silinecek ve program en baÅŸa dÃ¶necek.
            </p>
            <div class="flex gap-4 justify-center">
                <button onclick="closeResetModal()" class="flex-1 bg-slate-800 text-white py-4 rounded-2xl font-bold text-xs uppercase border border-white/5 hover:bg-slate-700 transition-all">VazgeÃ§</button>
                <button onclick="confirmReset()" class="flex-1 bg-red-600 text-white py-4 rounded-2xl font-bold text-xs uppercase shadow-lg shadow-red-900/40 hover:bg-red-500 hover:scale-105 transition-all">Evet, SÄ±fÄ±rla</button>
            </div>
        </div>
    </div>

    <!-- TARGET SETTING MODAL (YENÄ°) -->
    <div id="target-modal" class="fixed inset-0 bg-black/90 z-[10002] hidden flex items-center justify-center backdrop-blur-sm transition-all duration-300">
        <div class="bg-[#161e31] border border-purple-500/30 p-8 rounded-3xl max-w-sm w-full text-center shadow-2xl">
            <h3 class="text-xl font-black text-white mb-2 uppercase tracking-tight">Hedef Belirle</h3>
            <p class="text-slate-400 text-xs font-bold mb-6">BugÃ¼n kaÃ§ soru Ã§Ã¶zmeyi planlÄ±yorsun?</p>
            
            <input type="number" id="target-input-modal" class="w-full bg-[#0a0f1c] border border-white/10 rounded-xl px-4 py-4 text-white text-2xl font-black text-center focus:border-purple-500 outline-none mb-6" placeholder="200">
            
            <div class="flex gap-3">
                <button onclick="closeTargetModal()" class="flex-1 bg-slate-800 text-white py-3 rounded-xl font-bold text-xs uppercase border border-white/5 hover:bg-slate-700">Ä°ptal</button>
                <button onclick="saveTarget()" class="flex-1 bg-purple-600 text-white py-3 rounded-xl font-bold text-xs uppercase shadow-lg hover:bg-purple-500">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- THEME SELECTION MODAL (YENÄ°) -->
    <div id="theme-modal" class="fixed inset-0 bg-black/90 z-[10025] hidden flex items-center justify-center backdrop-blur-sm transition-all duration-300">
        <div class="bg-[var(--osym-card)] border border-white/10 p-8 rounded-3xl max-w-sm w-full text-center shadow-2xl">
            <h3 class="text-2xl font-black text-white mb-6 uppercase tracking-tight">Tema SeÃ§</h3>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="setTheme('default')" class="p-4 rounded-2xl bg-[#0a0f1c] border border-blue-500/30 hover:scale-105 transition-transform group">
                    <div class="w-8 h-8 rounded-full bg-blue-500 mx-auto mb-2 group-hover:shadow-[0_0_15px_#3b82f6]"></div>
                    <span class="text-xs font-bold text-slate-300">Gece (Vars.)</span>
                </button>
                <button onclick="setTheme('ocean')" class="p-4 rounded-2xl bg-[#0f172a] border border-cyan-500/30 hover:scale-105 transition-transform group">
                    <div class="w-8 h-8 rounded-full bg-cyan-500 mx-auto mb-2 group-hover:shadow-[0_0_15px_#06b6d4]"></div>
                    <span class="text-xs font-bold text-slate-300">Okyanus</span>
                </button>
                <button onclick="setTheme('forest')" class="p-4 rounded-2xl bg-[#052e16] border border-emerald-500/30 hover:scale-105 transition-transform group">
                    <div class="w-8 h-8 rounded-full bg-emerald-500 mx-auto mb-2 group-hover:shadow-[0_0_15px_#10b981]"></div>
                    <span class="text-xs font-bold text-slate-300">Orman</span>
                </button>
                <button onclick="setTheme('sunset')" class="p-4 rounded-2xl bg-[#2e1065] border border-pink-500/30 hover:scale-105 transition-transform group">
                    <div class="w-8 h-8 rounded-full bg-pink-500 mx-auto mb-2 group-hover:shadow-[0_0_15px_#f472b6]"></div>
                    <span class="text-xs font-bold text-slate-300">GÃ¼n BatÄ±mÄ±</span>
                </button>
            </div>
            <button onclick="document.getElementById('theme-modal').classList.add('hidden')" class="mt-6 text-slate-500 text-xs font-bold uppercase hover:text-white">Kapat</button>
        </div>
    </div>

    <!-- MAP MODAL (YENÄ°) -->
    <div id="map-modal" class="fixed inset-0 bg-black/95 z-[10026] hidden flex flex-col items-center justify-center backdrop-blur-md">
        <div class="relative w-full max-w-2xl h-[80vh] bg-[var(--osym-card)] rounded-3xl border border-white/10 overflow-hidden flex flex-col">
            <div class="p-6 border-b border-white/5 flex justify-between items-center bg-[var(--osym-dark)]">
                <h3 class="text-xl font-black text-white uppercase tracking-tight">BaÅŸarÄ± HaritasÄ±</h3>
                <button onclick="document.getElementById('map-modal').classList.add('hidden')" class="text-slate-500 hover:text-white text-xl">âœ•</button>
            </div>
            <div class="flex-1 overflow-y-auto custom-scrollbar p-10 relative" id="map-container">
                <!-- Harita JS ile Ã§izilecek -->
            </div>
        </div>
    </div>

    <!-- DAILY RESET MODAL (YENÄ°) -->
    <div id="daily-reset-modal" class="fixed inset-0 bg-black/90 z-[10002] hidden flex items-center justify-center backdrop-blur-sm transition-all duration-300">
        <div class="bg-[#161e31] border border-red-500/30 p-8 rounded-3xl max-w-sm w-full text-center shadow-2xl">
            <div class="w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-2xl">ğŸ—‘ï¸</span>
            </div>
            <h3 class="text-xl font-black text-white mb-2 uppercase tracking-tight">SÄ±fÄ±rla?</h3>
            <p class="text-slate-400 text-xs font-medium mb-6">
                BugÃ¼nkÃ¼ soru sayacÄ±n sÄ±fÄ±rlanacak.
            </p>
            <div class="flex gap-3">
                <button onclick="closeDailyResetModal()" class="flex-1 bg-slate-800 text-white py-3 rounded-xl font-bold text-xs uppercase border border-white/5 hover:bg-slate-700">VazgeÃ§</button>
                <button onclick="confirmDailyReset()" class="flex-1 bg-red-600 text-white py-3 rounded-xl font-bold text-xs uppercase shadow-lg hover:bg-red-500">Evet, SÄ±fÄ±rla</button>
            </div>
        </div>
    </div>

    <!-- DAILY GOAL SUCCESS MODAL (YENÄ°) -->
    <div id="daily-goal-modal" class="fixed inset-0 bg-black/90 z-[10005] hidden flex items-center justify-center backdrop-blur-sm transition-all duration-300">
        <div class="bg-[#161e31] border border-purple-500/50 p-8 rounded-3xl max-w-sm w-full text-center shadow-2xl relative overflow-hidden">
            <div class="absolute inset-0 bg-purple-600/10 blur-xl"></div>
            <div class="relative z-10">
                <div class="w-20 h-20 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-6 animate-bounce">
                    <span class="text-4xl">ğŸ¯</span>
                </div>
                <h3 class="text-2xl font-black text-white mb-2 uppercase tracking-tight">TEBRÄ°KLER!</h3>
                <p class="text-purple-300 text-sm font-bold uppercase tracking-widest mb-4">GÃ¼nlÃ¼k Hedef TamamlandÄ±</p>
                <p class="text-slate-400 text-xs font-medium leading-relaxed mb-8">
                    BugÃ¼nkÃ¼ soru hedefine ulaÅŸtÄ±n. Ä°stikrarÄ±n zaferin olacak!
                </p>
                <button onclick="closeDailyGoalModal()" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-4 rounded-2xl font-black text-xs uppercase shadow-lg hover:scale-105 transition-all">HarikayÄ±m! ğŸ˜</button>
            </div>
        </div>
    </div>

    <!-- YENÄ°: BAÅARIMLAR MODALI -->
    <div id="achievements-modal" class="fixed inset-0 bg-[#0a0f1c]/95 z-[10009] hidden flex flex-col items-center justify-center backdrop-blur-md p-4">
        <div class="bg-[var(--osym-card)] border border-white/10 p-6 md:p-8 rounded-3xl max-w-4xl w-full shadow-2xl relative">
            <button onclick="closeAchievementsModal()" class="absolute top-4 right-4 text-slate-500 hover:text-white transition-colors text-xl z-10">âœ•</button>
            <h2 class="text-xl md:text-2xl font-black text-white mb-2 uppercase tracking-tight flex items-center gap-3">
                <span class="text-3xl">ğŸ†</span> BaÅŸarÄ±mlar
            </h2>
            
            <div class="mb-6">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Tamamlama Durumu</span>
                    <span id="badge-progress-text" class="text-[10px] font-bold text-amber-400">0/0 (0%)</span>
                </div>
                <div class="w-full h-2 bg-slate-800 rounded-full overflow-hidden border border-white/5">
                    <div id="badge-progress-bar" class="h-full bg-gradient-to-r from-amber-500 to-yellow-400 transition-all duration-500" style="width: 0%;"></div>
                </div>
            </div>

            <div class="max-h-[60vh] overflow-y-auto custom-scrollbar pr-2 md:pr-4">
                <div id="badges-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                    <!-- Rozetler JS ile doldurulacak -->
                </div>
            </div>
        </div>
    </div>

    <!-- LEVEL UP MODAL -->
    <div id="level-up-modal" class="fixed inset-0 bg-black/90 z-[10007] hidden flex items-center justify-center backdrop-blur-sm transition-all duration-300">
        <div class="bg-[var(--osym-card)] border border-amber-500/50 p-8 rounded-3xl max-w-sm w-full text-center shadow-2xl relative overflow-hidden">
            <div class="absolute inset-0 bg-amber-600/10 blur-xl"></div>
            <div class="relative z-10">
                <div class="w-24 h-24 bg-amber-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                    <span class="text-5xl animate-pulse">â­</span>
                </div>
                <h3 class="text-3xl font-black text-white mb-2 uppercase tracking-tight">SEVÄ°YE ATLANDI!</h3>
                <p id="level-up-rank" class="text-amber-300 text-lg font-bold uppercase tracking-widest mb-4">Yeni RÃ¼tbe: KÄ±demli Memur</p>
                <p class="text-slate-400 text-sm font-medium leading-relaxed mb-8">
                    Harika gidiyorsun! Azmin ve kararlÄ±lÄ±ÄŸÄ±n seni bir Ã¼st seviyeye taÅŸÄ±dÄ±. Yola devam!
                </p>
                <button onclick="closeLevelUpModal()" class="w-full bg-gradient-to-r from-amber-600 to-yellow-500 text-white py-4 rounded-2xl font-black text-xs uppercase shadow-lg hover:scale-105 transition-all">MÃ¼kemmel! ğŸ’ª</button>
            </div>
        </div>
    </div>

    <!-- BADGE UNLOCKED MODAL -->
    <div id="badge-unlocked-modal" class="fixed inset-0 bg-black/90 z-[10008] hidden flex items-center justify-center backdrop-blur-sm transition-all duration-300">
        <div class="bg-[var(--osym-card)] border border-green-500/50 p-8 rounded-3xl max-w-sm w-full text-center shadow-2xl relative overflow-hidden">
            <div class="absolute inset-0 bg-green-600/10 blur-xl"></div>
            <div class="relative z-10">
                <div id="badge-modal-icon" class="w-24 h-24 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6 text-5xl">
                    <!-- ğŸ–ï¸ -->
                </div>
                <h3 class="text-2xl font-black text-white mb-2 uppercase tracking-tight">YENÄ° BAÅARIM!</h3>
                <p id="badge-modal-name" class="text-green-300 text-md font-bold uppercase tracking-widest mb-4">BaÅŸarÄ±m AdÄ±</p>
                <p id="badge-modal-desc" class="text-slate-400 text-sm font-medium leading-relaxed mb-8">
                    BaÅŸarÄ±m aÃ§Ä±klamasÄ± buraya gelecek.
                </p>
                <button onclick="closeBadgeModal()" class="w-full bg-gradient-to-r from-green-600 to-emerald-500 text-white py-4 rounded-2xl font-black text-xs uppercase shadow-lg hover:scale-105 transition-all">Koleksiyona Ekle! âœ¨</button>
            </div>
        </div>
    </div>

    <!-- POMODORO COMPLETE MODAL (YENÄ°) -->
    <div id="pomo-modal" class="fixed inset-0 bg-black/90 z-[10006] hidden flex items-center justify-center backdrop-blur-sm transition-all duration-300">
        <div class="bg-[var(--osym-card)] border border-blue-500/50 p-8 rounded-3xl max-w-sm w-full text-center shadow-2xl relative overflow-hidden">
            <div class="absolute inset-0 bg-blue-600/10 blur-xl"></div>
            <div class="relative z-10">
                <div class="w-20 h-20 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-6 animate-bounce">
                    <span class="text-4xl">â°</span>
                </div>
                <h3 class="text-2xl font-black text-white mb-2 uppercase tracking-tight">SÃœRE DOLDU!</h3>
                <p class="text-blue-300 text-sm font-bold uppercase tracking-widest mb-4">Odaklanma TamamlandÄ±</p>
                <p class="text-slate-400 text-xs font-medium leading-relaxed mb-8">
                    Harika bir iÅŸ Ã§Ä±kardÄ±n! Åimdi beynini dinlendirme veya yeni bir zafere koÅŸma zamanÄ±.
                </p>
            <div class="flex flex-col gap-3">
                    <button onclick="startBreak(5)" class="w-full bg-emerald-600 text-white py-3 rounded-xl font-bold text-xs uppercase shadow-lg hover:scale-105 transition-all">â˜• KÄ±sa Mola (5 dk)</button>
                    <button onclick="startBreak(15)" class="w-full bg-amber-600 text-white py-3 rounded-xl font-bold text-xs uppercase shadow-lg hover:scale-105 transition-all">ğŸ¥ª Uzun Mola (15 dk)</button>
                    <button onclick="startNewSession()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold text-xs uppercase shadow-lg hover:scale-105 transition-all">ğŸš€ Devam Et (Yeni Oturum)</button>
                    <button onclick="closePomoModal()" class="text-slate-500 text-xs font-bold uppercase hover:text-white mt-2">Kapat</button>
                </div>
            </div>
        </div>
    </div>

    <!-- BREATHING EXERCISE MODAL (YENÄ°) -->
    <div id="breath-modal" class="fixed inset-0 bg-[#0a0f1c]/95 z-[10010] hidden flex flex-col items-center justify-center backdrop-blur-md transition-all duration-500">
        <div class="relative w-64 h-64 flex items-center justify-center mb-12">
            <div id="breath-circle" class="absolute inset-0 bg-blue-500/30 rounded-full blur-xl transition-all duration-[4000ms] ease-in-out"></div>
            <div id="breath-circle-inner" class="w-48 h-48 bg-gradient-to-br from-blue-400 to-cyan-300 rounded-full shadow-[0_0_50px_rgba(59,130,246,0.6)] flex items-center justify-center relative z-10 transition-all duration-[4000ms] ease-in-out">
                <span id="breath-text" class="text-2xl font-black text-[#0a0f1c] uppercase tracking-widest">Nefes Al</span>
            </div>
        </div>
        <p class="text-slate-400 text-sm font-medium uppercase tracking-[0.2em] mb-8 animate-pulse">Odaklan ve Rahatla</p>
        <button onclick="stopBreathing()" class="bg-slate-800 text-white px-8 py-3 rounded-full font-bold text-xs border border-white/10 hover:bg-red-900/50 transition-colors uppercase">Egzersizi Bitir</button>
    </div>

    <!-- ANNOUNCEMENT MODAL (YENÄ°: DUYURU / BETA UYARISI) -->
    <div id="announcement-modal" class="fixed inset-0 bg-black/90 z-[10090] hidden flex items-center justify-center backdrop-blur-sm transition-all duration-300">
        <div class="bg-gradient-to-br from-blue-900/90 to-slate-900/90 border border-blue-500/30 p-8 rounded-3xl max-w-md w-full text-center shadow-2xl relative overflow-hidden">
            <!-- Dekoratif -->
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-400 via-purple-400 to-amber-400"></div>
            <div class="absolute -top-10 -right-10 w-32 h-32 bg-blue-500/20 rounded-full blur-3xl"></div>
            
            <button onclick="closeAnnouncementModal()" class="absolute top-4 right-4 text-slate-400 hover:text-white transition-colors text-xl">âœ•</button>

            <div class="w-20 h-20 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-6 animate-bounce">
                <span class="text-4xl">ğŸš€</span>
            </div>
            
            <h3 class="text-2xl font-black text-white mb-3 uppercase tracking-tight">BETA SÃœRÃœMÃœNDEYÄ°Z!</h3>
            
            <div class="bg-blue-500/10 rounded-xl p-4 mb-6 border border-blue-500/10">
                <p class="text-blue-200 text-sm font-medium leading-relaxed">
                    Sitemiz henÃ¼z Ã§ok yeni ve geliÅŸtirilme aÅŸamasÄ±nda. Bu sÃ¼reÃ§te bazÄ± kÃ¼Ã§Ã¼k hatalarla karÅŸÄ±laÅŸabilirsin.
                </p>
            </div>
            
            <p class="text-slate-400 text-xs leading-relaxed mb-8">
                KarÅŸÄ±laÅŸtÄ±ÄŸÄ±n hatalarÄ± veya "Åu Ã¶zellik de olsa harika olur!" dediÄŸin Ã¶nerilerini sayfanÄ±n en altÄ±ndaki <span class="text-amber-400 font-bold">Instagram</span> adresimizden bize iletebilirsin. Geri bildirimlerin bizim iÃ§in altÄ±n deÄŸerinde! ğŸ’›
            </p>
            
            <button onclick="closeAnnouncementModal()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-4 rounded-xl font-black text-xs uppercase shadow-lg hover:scale-[1.02] transition-transform">AnlaÅŸÄ±ldÄ±, KeÅŸfetmeye BaÅŸla!</button>
        </div>
    </div>

    <!-- CHAT RULES MODAL (YENÄ°: TOPLULUK KURALLARI) -->
    <div id="chat-rules-modal" class="fixed inset-0 bg-black/90 z-[10050] hidden flex items-center justify-center backdrop-blur-sm transition-all duration-300">
        <div class="bg-[#161e31] border border-blue-500/30 p-8 rounded-3xl max-w-sm w-full text-center shadow-2xl relative">
            <button onclick="closeChatRulesModal()" class="absolute top-4 right-4 text-slate-500 hover:text-white transition-colors text-xl">âœ•</button>
            <div class="w-16 h-16 bg-blue-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-3xl">ğŸ“œ</span>
            </div>
            <h3 class="text-xl font-black text-white mb-4 uppercase tracking-tight">Topluluk KurallarÄ±</h3>
            <ul class="text-slate-400 text-xs font-medium text-left space-y-3 mb-8 list-disc pl-4">
                <li>SaygÄ±lÄ± ve nazik olun. Hakaret, kÃ¼fÃ¼r yasaktÄ±r.</li>
                <li>Siyaset ve dini tartÄ±ÅŸmalardan kaÃ§Ä±nÄ±n.</li>
                <li>Reklam veya spam yapmak yasaktÄ±r.</li>
                <li>KiÅŸisel bilgilerinizi paylaÅŸmayÄ±n.</li>
                <li>Sadece KPSS ve ders konularÄ± konuÅŸulmalÄ±dÄ±r.</li>
            </ul>
            <button onclick="closeChatRulesModal()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold text-xs uppercase shadow-lg hover:bg-blue-500">Kabul Ediyorum</button>
        </div>
    </div>

    <!-- CREATE ANNOUNCEMENT MODAL (YENÄ°: DUYURU OLUÅTURMA) -->
    <div id="create-announcement-modal" class="fixed inset-0 bg-black/90 z-[10060] hidden flex items-center justify-center backdrop-blur-sm transition-all duration-300">
        <div class="bg-[#161e31] border border-amber-500/30 p-8 rounded-3xl max-w-md w-full shadow-2xl relative">
            <button onclick="closeCreateAnnouncementModal()" class="absolute top-4 right-4 text-slate-500 hover:text-white transition-colors text-xl">âœ•</button>
            <h3 class="text-xl font-black text-white mb-4 uppercase tracking-tight flex items-center gap-2"><span class="text-2xl">ğŸ“¢</span> Duyuru OluÅŸtur</h3>
            
            <textarea id="announcement-text" class="w-full bg-[#0a0f1c] border border-white/10 rounded-xl p-4 text-white mb-6 focus:border-amber-500 outline-none resize-none h-32" placeholder="Duyuru metnini buraya yazÄ±n..."></textarea>
            
            <div class="flex gap-6 mb-8 justify-center">
                <label class="flex items-center gap-3 text-slate-300 cursor-pointer bg-slate-800/50 px-4 py-2 rounded-lg border border-white/5 hover:bg-slate-800 transition-colors">
                    <input type="checkbox" id="target-chat" class="w-5 h-5 accent-amber-500 rounded" checked>
                    <span class="text-xs font-bold uppercase">Sohbet</span>
                </label>
                <label class="flex items-center gap-3 text-slate-300 cursor-pointer bg-slate-800/50 px-4 py-2 rounded-lg border border-white/5 hover:bg-slate-800 transition-colors">
                    <input type="checkbox" id="target-home" class="w-5 h-5 accent-amber-500 rounded">
                    <span class="text-xs font-bold uppercase">Ana Ekran</span>
                </label>
            </div>

            <button onclick="publishAnnouncement()" class="w-full bg-gradient-to-r from-amber-600 to-orange-600 text-white py-4 rounded-xl font-black text-xs uppercase shadow-lg hover:scale-[1.02] transition-transform">YayÄ±nla</button>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="hidden">
        <span class="text-3xl"></span>
        <p id="toast-quote" class="italic text-center font-bold text-lg text-white max-w-xs"></p>
    </div>

    <!-- XP KAZANMA TOAST'I -->
    <div id="xp-toast" class="fixed bottom-5 right-5 bg-gradient-to-br from-slate-800 to-slate-900 border border-amber-500/50 text-white px-6 py-3 rounded-2xl shadow-2xl flex items-center gap-3 transform translate-y-20 opacity-0 transition-all duration-500 z-[10100]">
        <span class="font-black text-amber-400" id="xp-toast-amount">+50 XP</span>
        <span class="text-xs text-slate-400" id="xp-toast-reason">Pomodoro TamamlandÄ±</span>
    </div>

    <!-- ANA SAYFA Ä°Ã‡ERÄ°ÄÄ° -->
    <div id="page-home" class="page-content active max-w-6xl mx-auto p-4 md:p-8">
        <header class="text-center mb-12">
            <div class="inline-block px-5 py-2 rounded-full bg-blue-500/10 border border-blue-500/20 text-blue-400 text-[10px] font-black tracking-widest uppercase mb-6 animate-pulse">KPSS Dashboard v7.0</div>
            
            <!-- Ãœst MenÃ¼ -->
            <div class="flex flex-wrap justify-center gap-3 md:gap-6 mb-8 px-2">
                <button onclick="openMapModal()" class="text-[10px] font-bold text-slate-500 hover:text-white transition-colors uppercase tracking-widest flex items-center gap-1"><span>ğŸ—ºï¸</span> Harita</button>
            </div>

            <!-- ANA EKRAN DUYURU ALANI -->
            <div id="home-announcements-container" class="max-w-4xl mx-auto mb-8 hidden">
                <!-- JS ile doldurulacak -->
            </div>

            <h1 class="text-4xl sm:text-5xl md:text-7xl font-black text-white mb-4 uppercase tracking-tighter">KPSS <span class="text-blue-500">AsistanÄ±m</span></h1>
            
            <!-- 3'LÃœ DETAYLI GERÄ° SAYIM SAYACI -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-10 w-full max-w-5xl mx-auto px-4">
                <!-- Lisans -->
                <div class="bg-[var(--osym-card)]/80 backdrop-blur-sm border border-blue-500/20 p-4 rounded-2xl text-center relative overflow-hidden group hover:-translate-y-1 transition-all duration-300 shadow-lg">
                    <div class="absolute top-0 left-0 w-full h-1 bg-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.5)]"></div>
                    <h3 class="text-[var(--osym-accent)] font-black text-[10px] uppercase tracking-[0.2em] mb-3">KPSS LÄ°SANS</h3>
                    <p class="text-[9px] text-slate-400 font-bold mb-2 border-b border-white/5 pb-2">BaÅŸvuru Tarihleri: 01.07.2026 - 13.07.2026</p>
                    <div id="cd-lisans" class="flex justify-center items-center gap-2 text-white">YÃ¼kleniyor...</div>
                </div>
                <!-- Ã–nlisans -->
                <div class="bg-[var(--osym-card)]/80 backdrop-blur-sm border border-amber-500/20 p-4 rounded-2xl text-center relative overflow-hidden group hover:-translate-y-1 transition-all duration-300 shadow-lg">
                    <div class="absolute top-0 left-0 w-full h-1 bg-amber-500 shadow-[0_0_10px_rgba(245,158,11,0.5)]"></div>
                    <h3 class="text-amber-500 font-black text-[10px] uppercase tracking-[0.2em] mb-3">KPSS Ã–NLÄ°SANS</h3>
                    <p class="text-[9px] text-slate-400 font-bold mb-2 border-b border-white/5 pb-2">BaÅŸvuru Tarihleri: 29.07.2026 - 10.08.2026</p>
                    <div id="cd-onlisans" class="flex justify-center items-center gap-2 text-white">YÃ¼kleniyor...</div>
                </div>
                <!-- OrtaÃ¶ÄŸretim -->
                <div class="bg-[var(--osym-card)]/80 backdrop-blur-sm border border-emerald-500/20 p-4 rounded-2xl text-center relative overflow-hidden group hover:-translate-y-1 transition-all duration-300 shadow-lg">
                    <div class="absolute top-0 left-0 w-full h-1 bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.5)]"></div>
                    <h3 class="text-emerald-500 font-black text-[10px] uppercase tracking-[0.2em] mb-3">ORTAÃ–ÄRETÄ°M</h3>
                    <p class="text-[9px] text-slate-400 font-bold mb-2 border-b border-white/5 pb-2">BaÅŸvuru Tarihleri: 27.08.2026 - 08.09.2026</p>
                    <div id="cd-ortaogretim" class="flex justify-center items-center gap-2 text-white">YÃ¼kleniyor...</div>
                </div>
            </div>

            <!-- YENÄ°LENMÄ°Å MOTÄ°VASYON KARTI -->
            <div class="mt-10 max-w-3xl mx-auto relative">
                <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 to-amber-600 rounded-[2.5rem] blur opacity-20 transition duration-1000"></div>
                <div class="relative glass-morphism rounded-[2.5rem] p-8 md:p-12 flex flex-col items-center text-center overflow-hidden border border-white/10">
                    <!-- Dekoratif Arka Plan -->
                    <div class="absolute top-0 right-0 -mt-6 -mr-6 w-32 h-32 bg-blue-500/10 rounded-full blur-3xl"></div>
                    <div class="absolute bottom-0 left-0 -mb-6 -ml-6 w-32 h-32 bg-amber-500/10 rounded-full blur-3xl"></div>
                    
                    <div class="mb-6 flex items-center gap-2 opacity-70">
                        <span class="text-xl animate-pulse">ğŸ’¡</span>
                        <span class="text-[10px] font-black uppercase tracking-[0.3em] text-blue-300">GÃ¼nÃ¼n Motivasyonu</span>
                    </div>

                    <div class="relative z-10 px-4">
                        <span class="absolute -top-8 -left-2 text-6xl text-white/5 font-serif">â€œ</span>
                        <p id="live-motivation" class="text-white font-medium text-xl md:text-3xl leading-relaxed motivation-fade motivation-active font-['Playfair_Display']">YÃ¼kleniyor...</p>
                        <span class="absolute -bottom-10 -right-2 text-6xl text-white/5 font-serif">â€</span>
                    </div>
                </div>
            </div>
            
            <div class="w-full h-2 bg-slate-800 rounded-full mt-10 overflow-hidden">
                <div id="total-progress-bar" class="h-full bg-[var(--osym-accent)] transition-all duration-1000" style="width: 0%"></div>
            </div>
            <div class="flex justify-between mt-2 px-1">
                <span class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Genel Ä°lerleme</span>
                <span id="total-percent" class="text-[10px] text-white font-bold">0%</span>
            </div>
            <p class="text-[9px] text-slate-500 mt-3 text-center max-w-lg mx-auto leading-relaxed opacity-70">
                <span class="text-amber-500 font-bold">*Bilgi:</span> Ä°lerleme Ã§ubuÄŸu, aÅŸaÄŸÄ±daki programda dersleri tamamlayÄ±p iÅŸaretledikÃ§e artar. %100'e ulaÅŸtÄ±ÄŸÄ±nda <span class="text-amber-500 font-bold">BaÅŸarÄ± SertifikasÄ±</span> almaya hak kazanÄ±rsÄ±nÄ±z.
            </p>
        </header>

        <!-- YENÄ°: OYUNLAÅTIRMA (SEVÄ°YE & XP) -->
        <section class="mb-12">
            <div class="flex items-center gap-4 mb-6">
                <div class="relative">
                    <div class="bg-amber-500/20 p-3 rounded-xl text-amber-500 text-2xl">ğŸ®</div>
                    <div class="absolute -top-2 -left-2 z-10">
                        <span class="tooltip-container" tabindex="0" onclick="event.stopPropagation()">
                            <span class="w-5 h-5 bg-[var(--osym-card)] rounded-full border border-white/10 flex items-center justify-center text-[10px] text-slate-400 shadow-md cursor-help">?</span>
                            <span class="tooltip-text" style="left: 0; transform: none; text-align: left;">YaptÄ±ÄŸÄ±n her aktivite sana tecrÃ¼be puanÄ± (XP) kazandÄ±rÄ±r. Yeterli XP ile seviye atlar, yeni rÃ¼tbeler ve baÅŸarÄ± rozetleri kazanÄ±rsÄ±n.</span>
                        </span>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl md:text-2xl font-black text-white uppercase tracking-tight">
                        OyunlaÅŸtÄ±rma
                    </h2>
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Seviye, RÃ¼tbe ve BaÅŸarÄ±mlar</p>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-12 items-center gap-6 bg-[var(--osym-card)]/50 border border-white/10 rounded-3xl p-6">
                <div class="md:col-span-2 text-center md:text-left">
                    <div id="rank-title" class="text-sm font-black text-amber-400 uppercase tracking-widest flex items-center justify-center md:justify-start">Ã‡aylak Memur</div>
                    <div class="text-3xl font-black text-white">Seviye <span id="level-display">1</span></div>
                </div>
                <div class="md:col-span-8">
                    <div class="w-full h-4 bg-slate-800 rounded-full overflow-hidden border border-white/5 relative">
                        <div id="xp-bar" class="h-full bg-gradient-to-r from-amber-500 to-yellow-400 transition-all duration-500 shadow-[0_0_10px_rgba(245,158,11,0.5)]" style="width: 0%;"></div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span id="xp-text" class="text-[10px] font-black text-white" style="text-shadow: 0px 1px 2px rgba(0,0,0,0.6);">0 / 1000 XP</span>
                        </div>
                    </div>
                </div>
                <div class="md:col-span-2">
                    <button onclick="openAchievementsModal()" class="w-full bg-slate-800 hover:bg-amber-600 text-white py-3 rounded-xl font-bold text-xs uppercase border border-white/10 transition-all flex items-center justify-center gap-2">
                        <span>ğŸ†</span> BaÅŸarÄ±mlar
                    </button>
                </div>
            </div>
        </section>

        <!-- Focus Modu -->
        <section class="glass-morphism rounded-[3rem] p-8 mb-12 collapsible-on-mobile">
            <div class="collapsible-trigger flex items-center gap-4 mb-6">
                <div class="relative">
                    <div class="bg-blue-500/20 p-3 rounded-xl text-blue-500 text-2xl">â±ï¸</div>
                    <div class="absolute -top-2 -left-2 z-10">
                        <span class="tooltip-container" tabindex="0" onclick="event.stopPropagation()">
                            <span class="w-5 h-5 bg-[var(--osym-card)] rounded-full border border-white/10 flex items-center justify-center text-[10px] text-slate-400 shadow-md cursor-help">?</span>
                            <span class="tooltip-text" style="left: 0; transform: none; text-align: left;">ZamanÄ± yÃ¶netmeni saÄŸlar (25dk Ders / 5dk Mola). AyrÄ±ca 'BugÃ¼n kaÃ§ oturum yaptÄ±n, kaÃ§ dakika odaklandÄ±n?' istatistiklerini tutar.</span>
                        </span>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl md:text-2xl font-black text-white uppercase tracking-tight">
                        ATAMA ODAÄI
                    </h2>
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Dikkati Topla, Hedefe Kilitlen</p>
                </div>
            </div>
            <div class="collapsible-content">
                <div class="flex flex-col md:flex-row items-center gap-12">
                    <div class="timer-container">
                        <svg class="timer-svg">
                            <circle class="timer-circle-bg" cx="90" cy="90" r="84"></circle>
                            <circle id="timer-path" class="timer-circle-progress" cx="90" cy="90" r="84" stroke-dasharray="527.7" stroke-dashoffset="0"></circle>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span class="text-5xl font-black tracking-tighter" id="timer-display">25:00</span>
                        </div>
                    </div>
                    <div class="flex-1 text-center md:text-left">
                        <div class="flex flex-wrap gap-3 justify-center md:justify-start">
                            <input type="number" id="timer-input" value="25" class="w-16 bg-slate-900 border border-white/10 rounded-xl px-2 py-2 text-white font-bold text-center">
                            <button onclick="startTimer()" id="start-btn" class="bg-[var(--osym-accent)] text-white px-6 py-2 rounded-xl font-black text-xs uppercase transition-all">SÃœREÃ‡ BAÅLASIN</button>
                            <button onclick="pauseTimer()" id="pause-btn" class="bg-orange-600 text-white px-6 py-2 rounded-xl font-black text-xs hidden uppercase transition-all">MOLA VER</button>
                            <button onclick="resetTimer()" class="bg-slate-800 text-slate-300 px-6 py-2 rounded-xl font-black text-xs border border-white/5 uppercase">YENÄ°DEN KUR</button>
                            <button onclick="startBreathing()" class="bg-cyan-600/20 text-cyan-400 border border-cyan-500/30 px-6 py-2 rounded-xl font-black text-xs uppercase hover:bg-cyan-600 hover:text-white transition-all">ğŸ§˜ Nefes Egzersizi</button>
                        </div>

                        <!-- YENÄ°: POMODORO Ä°STATÄ°STÄ°KLERÄ° -->
                        <div class="mt-6 flex items-center gap-4 text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                            <div class="bg-[var(--osym-dark)] px-4 py-3 rounded-xl border border-white/5 flex items-center gap-2">
                                <span class="text-lg">ğŸ…</span> 
                                <div><span id="pomo-sessions" class="text-white text-sm">0</span> Oturum</div>
                            </div>
                            <div class="bg-[var(--osym-dark)] px-4 py-3 rounded-xl border border-white/5 flex items-center gap-2">
                                <span class="text-lg">â±ï¸</span> 
                                <div><span id="pomo-minutes" class="text-white text-sm">0</span> Dakika</div>
                            </div>
                        </div>
                        
                        <!-- YENÄ°: ODAKLANMA SESLERÄ° -->
                        <div class="mt-8 pt-6 border-t border-white/5">
                            <p class="text-slate-500 text-[10px] font-bold uppercase tracking-widest mb-3">Odaklanma Sesleri (Arka Plan)</p>
                            <div class="flex flex-wrap gap-3 justify-center md:justify-start">
                                <button onclick="toggleSound('rain')" id="btn-rain" class="group bg-[var(--osym-dark)] text-slate-400 px-5 py-3 rounded-xl border border-white/5 hover:border-blue-500/50 transition-all flex items-center gap-3">
                                    <span class="text-xl group-hover:scale-110 transition-transform">ğŸŒ§ï¸</span>
                                    <span class="text-[10px] font-black uppercase">YaÄŸmur</span>
                                </button>
                                <button onclick="toggleSound('cafe')" id="btn-cafe" class="group bg-[var(--osym-dark)] text-slate-400 px-5 py-3 rounded-xl border border-white/5 hover:border-amber-500/50 transition-all flex items-center gap-3">
                                    <span class="text-xl group-hover:scale-110 transition-transform">â˜•</span>
                                    <span class="text-[10px] font-black uppercase">Kafe</span>
                                </button>
                                <!-- SES SEVÄ°YESÄ° AYARI (Buraya taÅŸÄ±ndÄ± ve butonlarla eÅŸitlendi) -->
                                <div class="flex items-center gap-3 bg-[var(--osym-dark)] px-5 py-3 rounded-xl border border-white/5">
                                    <span class="text-slate-400 text-sm">ğŸ”Š</span>
                                    <input type="range" min="0" max="1" step="0.05" value="0.5" oninput="adjustVolume(this.value)" class="w-20 md:w-24 h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- YENÄ°: DERS PROGRAMI (COLLAPSIBLE) -->
        <section class="glass-morphism rounded-[3rem] p-8 mb-12 collapsible-on-mobile">
            <div class="collapsible-trigger flex items-center gap-4 mb-6">
                <div class="relative">
                    <div class="bg-blue-600/20 p-3 rounded-xl text-blue-500 text-2xl">ğŸ“…</div>
                    <div class="absolute -top-2 -left-2 z-10">
                        <span class="tooltip-container" tabindex="0" onclick="event.stopPropagation()">
                            <span class="w-5 h-5 bg-[var(--osym-card)] rounded-full border border-white/10 flex items-center justify-center text-[10px] text-slate-400 shadow-md cursor-help">?</span>
                            <span class="tooltip-text" style="left: 0; transform: none; text-align: left;">Programdaki dersleri bitirip kutucuklarÄ± iÅŸaretledikÃ§e genel ilerleme artar. %100 olduÄŸunda ismine Ã¶zel BaÅŸarÄ± SertifikasÄ± almaya hak kazanÄ±rsÄ±n.</span>
                        </span>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl md:text-2xl font-black text-white uppercase tracking-tight">
                        Ders ProgramÄ±
                    </h2>
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">HaftalÄ±k ve GÃ¼nlÃ¼k PlanÄ±n</p>
                </div>
            </div>
            
            <div class="collapsible-content">
                <div class="bg-slate-800/50 border border-red-500/20 p-4 rounded-2xl mb-6 text-center">
                    <p class="text-slate-300 text-xs leading-relaxed"><strong class="text-red-400 font-bold">Kilit Sistemi UyarÄ±sÄ±:</strong> Disiplini korumak amacÄ±yla; bir Ã¶nceki gÃ¼nÃ¼ tamamlamadan sonraki gÃ¼ne, bir Ã¶nceki haftayÄ± tamamlamadan sonraki haftaya geÃ§iÅŸ yapamazsÄ±nÄ±z. Kilitli kartlar ğŸ”’ simgesi ile gÃ¶sterilir.</p>
                </div>
                <div id="view-title-area" class="flex flex-wrap items-center justify-between mb-8 px-4 gap-4">
                    <h3 id="current-view-title" class="text-2xl font-black text-white uppercase tracking-tighter flex items-center gap-3">
                        <span class="w-2 h-8 bg-[var(--osym-accent)] rounded-full"></span>
                        HaftalÄ±k Plan
                    </h3>
                    <div class="flex flex-wrap gap-2">
                        <button id="back-btn" onclick="transitionToView(renderWeeks)" class="hidden bg-[var(--osym-card)] text-white px-6 py-3 rounded-xl text-[10px] font-black uppercase border border-white/10">Ana Sayfa</button>
                        <button id="global-pdf-btn" onclick="downloadProgramPDF('global')" class="bg-blue-600 text-white px-6 py-3 rounded-xl text-[10px] font-black uppercase shadow-lg">Genel Ders ProgramÄ± Ä°ndir {PDF}</button>
                        <!-- YENÄ°: Sertifika Ä°ndirme Butonu (Sadece bitince gÃ¶rÃ¼nÃ¼r) -->
                        <button id="main-certificate-btn" onclick="showVictoryOverlay()" class="hidden gold-btn px-6 py-3 rounded-xl text-[10px] font-black uppercase shadow-lg animate-bounce">SertifikamÄ± Al ğŸ†</button>
                        <button id="reset-all-btn" onclick="resetAllProgress()" class="bg-red-600/80 hover:bg-red-600 text-white px-6 py-3 rounded-xl text-[10px] font-black uppercase shadow-lg hover:shadow-red-600/40 transition-all flex items-center gap-2"><span>SÄ±fÄ±rla</span> <span class="text-lg">ğŸ—‘ï¸</span></button>
                        <button id="weekly-pdf-btn" onclick="downloadProgramPDF('weekly')" class="hidden bg-amber-600 text-white px-6 py-3 rounded-xl text-[10px] font-black uppercase shadow-lg">HaftalÄ±k Program Ä°ndir {PDF}</button>
                    </div>
                </div>

                <div id="main-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 pb-8 transition-opacity duration-300">
                    <!-- Dinamik Ä°Ã§erik -->
                </div>
            </div>
        </section>

        <!-- YENÄ°: DENEME TAKÄ°BÄ° & PUAN HESAPLAMA -->
        <section class="glass-morphism rounded-[3rem] p-8 mb-12 collapsible-on-mobile">
            <div class="collapsible-trigger flex items-center gap-4 mb-6">
                <div class="relative">
                    <div class="bg-amber-500/20 p-3 rounded-xl text-amber-500 text-2xl">ğŸ“ˆ</div>
                    <div class="absolute -top-2 -left-2 z-10">
                        <span class="tooltip-container" tabindex="0" onclick="event.stopPropagation()">
                            <span class="w-5 h-5 bg-[var(--osym-card)] rounded-full border border-white/10 flex items-center justify-center text-[10px] text-slate-400 shadow-md cursor-help">?</span>
                            <span class="tooltip-text" style="left: 0; transform: none; text-align: left;">Deneme netlerini girerek tahmini puanÄ±nÄ± hesaplar. SonuÃ§larÄ±nÄ± liste ve Grafik Ã¼zerinde analiz etmeni saÄŸlar.</span>
                        </span>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl md:text-2xl font-black text-white uppercase tracking-tight">
                        Deneme Takibi
                    </h2>
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">GeliÅŸimini Kaydet, PuanÄ±nÄ± GÃ¶r</p>
                </div>
            </div>

            <div class="collapsible-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Hesaplama AlanÄ± -->
                    <div class="bg-[var(--osym-dark)]/50 p-6 rounded-3xl border border-white/5">
                        <div class="mb-4">
                            <label class="text-[10px] font-bold text-slate-500 uppercase block mb-2">SÄ±nav TÃ¼rÃ¼</label>
                            <select id="exam-type" class="w-full bg-[var(--osym-card)] border border-white/10 rounded-xl px-4 py-3 text-white font-bold focus:border-blue-500 outline-none transition-colors appearance-none cursor-pointer">
                                <option value="lisans">KPSS Lisans (P3)</option>
                                <option value="onlisans">KPSS Ã–nlisans (P93)</option>
                                <option value="ortaogretim">KPSS OrtaÃ¶ÄŸretim (P94)</option>
                            </select>
                        </div>
                        
                        <!-- YENÄ°: DETAYLI DERS GÄ°RÄ°ÅÄ° -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                            <!-- Genel Yetenek -->
                            <div class="bg-[var(--osym-card)] p-4 rounded-2xl border border-blue-500/10">
                                <h4 class="text-blue-400 font-black text-[10px] uppercase tracking-widest mb-3 border-b border-blue-500/10 pb-2">Genel Yetenek</h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="text-[9px] font-bold text-slate-500 uppercase block mb-1">TÃ¼rkÃ§e (30)</label>
                                        <input type="number" id="net-turkce" placeholder="0" class="w-full bg-[var(--osym-dark)] border border-white/5 rounded-lg px-3 py-2 text-white text-sm font-bold focus:border-blue-500 outline-none">
                                    </div>
                                    <div>
                                        <label class="text-[9px] font-bold text-slate-500 uppercase block mb-1">Matematik (30)</label>
                                        <input type="number" id="net-mat" placeholder="0" class="w-full bg-[var(--osym-dark)] border border-white/5 rounded-lg px-3 py-2 text-white text-sm font-bold focus:border-blue-500 outline-none">
                                    </div>
                                </div>
                            </div>
                            <!-- Genel KÃ¼ltÃ¼r -->
                            <div class="bg-[var(--osym-card)] p-4 rounded-2xl border border-amber-500/10">
                                <h4 class="text-amber-400 font-black text-[10px] uppercase tracking-widest mb-3 border-b border-amber-500/10 pb-2">Genel KÃ¼ltÃ¼r</h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="text-[9px] font-bold text-slate-500 uppercase block mb-1">Tarih (27)</label>
                                        <input type="number" id="net-tarih" placeholder="0" class="w-full bg-[var(--osym-dark)] border border-white/5 rounded-lg px-3 py-2 text-white text-sm font-bold focus:border-amber-500 outline-none">
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div><label class="text-[9px] font-bold text-slate-500 uppercase block mb-1">CoÄŸ. (18)</label><input type="number" id="net-cog" placeholder="0" class="w-full bg-[var(--osym-dark)] border border-white/5 rounded-lg px-3 py-2 text-white text-sm font-bold focus:border-amber-500 outline-none"></div>
                                        <div><label class="text-[9px] font-bold text-slate-500 uppercase block mb-1">Vat. (15)</label><input type="number" id="net-vat" placeholder="0" class="w-full bg-[var(--osym-dark)] border border-white/5 rounded-lg px-3 py-2 text-white text-sm font-bold focus:border-amber-500 outline-none"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button onclick="calculateAndSaveScore()" class="w-full bg-gradient-to-r from-blue-600 to-blue-500 text-white py-4 rounded-xl font-black text-xs uppercase shadow-lg hover:scale-[1.02] transition-transform">Hesapla ve Kaydet</button>
                        
                        <div id="last-score-display" class="hidden mt-6 text-center animate-pulse">
                            <span class="text-[10px] text-slate-400 uppercase font-bold">Tahmini Puan (P3)</span>
                            <div class="text-4xl font-black text-white mt-1" id="calc-score-result">--</div>
                        </div>
                    </div>

                    <!-- GeÃ§miÅŸ Listesi -->
                    <div class="bg-[var(--osym-dark)]/50 p-6 rounded-3xl border border-white/5 flex flex-col">
                        <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-4">Son Denemeler</h3>
                        <div id="exam-history-list" class="flex-1 overflow-y-auto max-h-[200px] space-y-3 pr-2 custom-scrollbar">
                            <!-- JS ile doldurulacak -->
                            <div class="text-center text-slate-600 text-xs py-8">HenÃ¼z deneme kaydÄ± yok.</div>
                        </div>
                    </div>
                </div>

                <!-- YENÄ°: GRAFÄ°K ALANI -->
                <div class="mt-8 bg-[var(--osym-dark)]/50 p-6 rounded-3xl border border-white/5">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase mb-4 flex items-center gap-2"><span class="text-lg">ğŸ“Š</span> Puan Analiz GrafiÄŸi</h3>
                    <div class="relative w-full h-64">
                        <canvas id="examChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- YENÄ°: YAPILACAKLAR LÄ°STESÄ° (TO-DO) -->
        <section class="glass-morphism rounded-[3rem] p-8 mb-12 collapsible-on-mobile">
            <div class="collapsible-trigger flex items-center gap-4 mb-6">
                <div class="relative">
                    <div class="bg-emerald-500/20 p-3 rounded-xl text-emerald-500 text-2xl">ğŸ“</div>
                    <div class="absolute -top-2 -left-2 z-10">
                        <span class="tooltip-container" tabindex="0" onclick="event.stopPropagation()">
                            <span class="w-5 h-5 bg-[var(--osym-card)] rounded-full border border-white/10 flex items-center justify-center text-[10px] text-slate-400 shadow-md cursor-help">?</span>
                            <span class="tooltip-text" style="left: 0; transform: none; text-align: left;">Program dÄ±ÅŸÄ± yapacaÄŸÄ±n ekstra Ã§alÄ±ÅŸmalarÄ± (Ã¶rn: 50 paragraf sorusu Ã§Ã¶z) buraya ekleyerek takibini yapabilirsin.</span>
                        </span>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl md:text-2xl font-black text-white uppercase tracking-tight">
                        Ekstra GÃ¶revler
                    </h2>
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Program DÄ±ÅŸÄ± Ã‡alÄ±ÅŸmalarÄ±n</p>
                </div>
            </div>
            <div class="collapsible-content">
                <div class="flex gap-3 mb-6">
                    <input type="text" id="todo-input" placeholder="Ã–rn: 50 Paragraf sorusu Ã§Ã¶z..." class="flex-1 bg-[var(--osym-dark)] border border-white/10 rounded-xl px-4 py-3 text-white font-bold focus:border-emerald-500 outline-none transition-colors" onkeypress="if(event.key === 'Enter') addTodo()">
                    <button onclick="addTodo()" class="bg-emerald-600 text-white px-6 rounded-xl font-black text-xl hover:bg-emerald-500 transition-colors shadow-lg shadow-emerald-900/20">+</button>
                </div>

                <div id="todo-list" class="space-y-3 max-h-[300px] overflow-y-auto custom-scrollbar pr-2">
                    <!-- JS ile dolacak -->
                </div>
            </div>
        </section>

        <!-- YENÄ°: GÃœNLÃœK PERFORMANS -->
        <section class="glass-morphism rounded-[3rem] p-8 mb-12 collapsible-on-mobile">
            <div class="collapsible-trigger flex items-center gap-4 mb-6">
                <div class="relative">
                    <div class="bg-purple-500/20 p-3 rounded-xl text-purple-500 text-2xl">âš¡</div>
                    <div class="absolute -top-2 -left-2 z-10">
                        <span class="tooltip-container" tabindex="0" onclick="event.stopPropagation()">
                            <span class="w-5 h-5 bg-[var(--osym-card)] rounded-full border border-white/10 flex items-center justify-center text-[10px] text-slate-400 shadow-md cursor-help">?</span>
                            <span class="tooltip-text" style="left: 0; transform: none; text-align: left;">Kendine gÃ¼nlÃ¼k bir soru Ã§Ã¶zme hedefi koyarsÄ±n. Ã‡Ã¶zdÃ¼kÃ§e sisteme girersin. AyrÄ±ca 'Zinciri KÄ±rma' takvimi ile istikrarÄ±nÄ± Ã¶lÃ§er ve hÄ±zlÄ± notlar alabilirsin.</span>
                        </span>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl md:text-2xl font-black text-white uppercase tracking-tight">
                        GÃ¼nlÃ¼k Performans
                    </h2>
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Hedef, Ä°stikrar ve Notlar</p>
                </div>
            </div>
            <div class="collapsible-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Soru Takibi -->
                    <div class="bg-gradient-to-br from-[var(--osym-card)] to-[var(--osym-dark)] p-1 rounded-3xl shadow-2xl relative overflow-hidden group">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-purple-500/10 rounded-full blur-3xl -mr-10 -mt-10 transition-all group-hover:bg-purple-500/20"></div>
                        <div class="bg-[var(--osym-dark)]/80 backdrop-blur-xl p-6 rounded-[1.3rem] h-full flex flex-col justify-between border border-white/5">
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <h3 class="text-[10px] font-black text-purple-400 uppercase tracking-widest mb-1">GÃœNLÃœK HEDEF</h3>
                                    <div class="flex items-baseline gap-1 cursor-pointer hover:opacity-80 transition-opacity" onclick="openTargetModal()" title="Hedefi DÃ¼zenle">
                                        <span id="q-target" class="text-sm font-bold text-slate-500">200</span>
                                        <span class="text-[10px] text-slate-600">âœ</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span id="q-current" class="text-5xl font-black text-white tracking-tighter drop-shadow-[0_0_15px_rgba(168,85,247,0.5)]">0</span>
                                </div>
                            </div>
                            
                            <div class="w-full h-3 bg-slate-800/50 rounded-full overflow-hidden mb-6 border border-white/5">
                                <div id="q-progress" class="h-full bg-gradient-to-r from-purple-600 via-fuchsia-500 to-blue-500 transition-all duration-1000 relative shadow-[0_0_10px_rgba(168,85,247,0.5)]" style="width: 0%"></div>
                            </div>
                            
                            <div class="grid grid-cols-4 gap-2">
                                <button onclick="addQuestions(10)" class="bg-[var(--osym-card)] hover:bg-purple-600 hover:text-white text-slate-400 py-3 rounded-xl font-black text-[10px] transition-all border border-white/5 hover:scale-105 active:scale-95">+10</button>
                                <button onclick="addQuestions(25)" class="bg-[var(--osym-card)] hover:bg-purple-600 hover:text-white text-slate-400 py-3 rounded-xl font-black text-[10px] transition-all border border-white/5 hover:scale-105 active:scale-95">+25</button>
                                <button onclick="addQuestions(50)" class="bg-[var(--osym-card)] hover:bg-purple-600 hover:text-white text-slate-400 py-3 rounded-xl font-black text-[10px] transition-all border border-white/5 hover:scale-105 active:scale-95">+50</button>
                                <button onclick="openDailyResetModal()" class="bg-[var(--osym-card)] hover:bg-red-600 hover:text-white text-slate-400 py-3 rounded-xl font-black text-[10px] transition-all border border-white/5 hover:scale-105 active:scale-95">SIFIRLA</button>
                            </div>

                            <!-- ZÄ°NCÄ°RÄ° KIRMA ENTEGRASYONU -->
                            <div class="mt-6 pt-6 border-t border-white/5">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-[10px] font-black text-rose-400 uppercase tracking-widest flex items-center gap-2">ğŸ”¥ ZÄ°NCÄ°RÄ° KIRMA</h3>
                                    <span class="text-[9px] text-slate-500 font-bold">Son 7 GÃ¼n</span>
                                </div>
                                <div id="streak-container" class="grid grid-cols-7 gap-2">
                                    <!-- JS ile doldurulacak -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- HÄ±zlÄ± Notlar -->
                    <div class="bg-[var(--osym-card)] p-1 rounded-3xl shadow-2xl border border-white/5 flex flex-col relative group">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-yellow-400 to-amber-600 rounded-t-3xl opacity-50 group-hover:opacity-100 transition-opacity"></div>
                        <div class="bg-[var(--osym-dark)]/60 backdrop-blur-sm p-6 rounded-[1.3rem] h-full flex flex-col">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-[10px] font-black text-amber-500 uppercase tracking-widest flex items-center gap-2">
                                    <span>ğŸ“Œ</span> HIZLI NOTLAR
                                </h3>
                                <span class="text-[9px] text-slate-600 font-bold uppercase tracking-wider bg-white/5 px-2 py-1 rounded-lg">Otomatik KayÄ±t</span>
                            </div>
                            <textarea id="quick-notes" class="flex-1 w-full bg-slate-900/50 border border-white/5 rounded-xl p-4 text-slate-300 text-sm font-medium focus:border-amber-500/50 focus:bg-[var(--osym-card)] outline-none transition-all resize-none custom-scrollbar placeholder:text-slate-700 leading-relaxed" placeholder="â€¢ Unutma: YarÄ±n deneme analizi yapÄ±lacak...&#10;â€¢ FormÃ¼l: x = -b Â± âˆšÎ” / 2a" oninput="saveQuickNotes()"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- YENÄ°: HAP BÄ°LGÄ°LER (FLASHCARDS) -->
        <section class="glass-morphism rounded-[3rem] p-8 mb-12 collapsible-on-mobile">
            <div class="collapsible-trigger flex items-center gap-4 mb-6">
                <div class="relative">
                    <div class="bg-pink-500/20 p-3 rounded-xl text-pink-500 text-2xl">ğŸ’Š</div>
                    <div class="absolute -top-2 -left-2 z-10">
                        <span class="tooltip-container" tabindex="0" onclick="event.stopPropagation()">
                            <span class="w-5 h-5 bg-[var(--osym-card)] rounded-full border border-white/10 flex items-center justify-center text-[10px] text-slate-400 shadow-md cursor-help">?</span>
                            <span class="tooltip-text" style="left: 0; transform: none; text-align: left;">Tarih, CoÄŸrafya ve VatandaÅŸlÄ±k dersleri iÃ§in pratik yapmanÄ± saÄŸlar. Karta tÄ±kla, cevabÄ± gÃ¶r, 'SÄ±radaki' diyerek yeni bilgiye geÃ§.</span>
                        </span>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl md:text-2xl font-black text-white uppercase tracking-tight">
                        Hap Bilgiler
                    </h2>
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Ders BazlÄ± Pratik Ezber KartlarÄ±</p>
                </div>
            </div>
            <div class="collapsible-content">
                <!-- Ders SeÃ§imi -->
                <div class="flex flex-wrap gap-2 mb-6 justify-center md:justify-start">
                    <button onclick="setFlashcardSubject('tarih')" id="fc-btn-tarih" class="fc-subject-btn bg-pink-600 text-white px-6 py-2 rounded-full font-bold text-xs uppercase shadow-lg transition-all hover:scale-105">Tarih</button>
                    <button onclick="setFlashcardSubject('cografya')" id="fc-btn-cografya" class="fc-subject-btn bg-[var(--osym-card)] text-slate-400 border border-white/10 px-6 py-2 rounded-full font-bold text-xs uppercase transition-all hover:bg-white/5 hover:text-white">CoÄŸrafya</button>
                    <button onclick="setFlashcardSubject('vatandaslik')" id="fc-btn-vatandaslik" class="fc-subject-btn bg-[var(--osym-card)] text-slate-400 border border-white/10 px-6 py-2 rounded-full font-bold text-xs uppercase transition-all hover:bg-white/5 hover:text-white">VatandaÅŸlÄ±k</button>
                    <button onclick="setFlashcardSubject('guncel')" id="fc-btn-guncel" class="fc-subject-btn bg-[var(--osym-card)] text-slate-400 border border-white/10 px-6 py-2 rounded-full font-bold text-xs uppercase transition-all hover:bg-white/5 hover:text-white">GÃ¼ncel</button>
                </div>

                <!-- BÃ¶lÃ¼m SeÃ§imi (Yeni) -->
                <div id="fc-chapter-container" class="mb-8">
                    <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3 ml-1">BÃ¶lÃ¼mler</div>
                    <div id="fc-chapter-list" class="flex overflow-x-auto gap-3 pb-4 custom-scrollbar snap-x">
                        <!-- JS ile doldurulacak -->
                    </div>
                </div>

                <!-- Kart AlanÄ± -->
                <div class="max-w-md mx-auto relative">
                    <!-- YENÄ° TASARIM: Gradient Border Wrapper -->
                    <div class="bg-gradient-to-br from-blue-500/50 via-pink-500/50 to-amber-500/50 p-1 rounded-[2.5rem] shadow-2xl shadow-black/30">
                        <div class="flashcard-container group h-[360px]" onclick="flipFlashcard(event)">
                            <div id="flashcard-inner" class="flashcard-inner">
                            <div class="flashcard-front overflow-hidden">
                                <div class="absolute top-0 left-0 w-48 h-48 bg-pink-500/10 rounded-full blur-3xl -ml-16 -mt-16"></div>
                                
                                <span class="text-5xl mb-6 opacity-80">â“</span>
                                <p id="fc-question" class="text-xl md:text-2xl font-bold text-center leading-relaxed px-4">YÃ¼kleniyor...</p>
                                <div class="mt-auto mb-2">
                                    <p class="text-[9px] text-slate-500 uppercase font-bold tracking-widest animate-pulse">Cevap iÃ§in dokun</p>
                                </div>
                            </div>
                            <div class="flashcard-back relative overflow-hidden">
                                <div class="absolute bottom-0 right-0 w-48 h-48 bg-white/10 rounded-full blur-3xl -mr-16 -mb-16"></div>
                                <span class="text-5xl mb-6 opacity-80">ğŸ’¡</span>
                                <p id="fc-answer" class="text-xl md:text-2xl font-black text-center leading-relaxed px-4">Cevap</p>
                            </div>
                        </div>
                    </div>
                    </div>

                    <!-- Kontroller -->
                    <div class="flex items-center justify-between mt-8 gap-4">
                        <button onclick="prevFlashcard(event)" class="bg-[var(--osym-card)] hover:bg-slate-700 text-white w-14 h-14 rounded-2xl border border-white/10 transition-all active:scale-95 flex items-center justify-center group">
                            <span class="text-xl group-hover:-translate-x-1 transition-transform">â†</span>
                        </button>
                        
                        <div class="flex-1 bg-[var(--osym-card)] h-14 rounded-2xl border border-white/5 flex items-center justify-between px-6">
                            <div class="flex flex-col">
                                <span class="text-[8px] text-slate-500 font-bold uppercase tracking-widest">Ä°lerleme</span>
                                <div class="flex items-baseline gap-1">
                                    <span id="fc-current-index" class="text-lg font-black text-white">1</span>
                                    <span class="text-xs text-slate-600 font-bold">/</span>
                                    <span id="fc-total-count" class="text-xs font-bold text-slate-500">15</span>
                                </div>
                            </div>
                            <!-- Progress Bar Mini -->
                            <div class="w-16 h-1.5 bg-slate-800 rounded-full overflow-hidden">
                                <div id="fc-progress-mini" class="h-full bg-blue-500 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>

                        <button onclick="nextFlashcard(event)" class="bg-gradient-to-br from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white w-14 h-14 rounded-2xl shadow-lg shadow-blue-900/30 transition-all active:scale-95 flex items-center justify-center group">
                            <span class="text-xl group-hover:translate-x-1 transition-transform">â†’</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- FOOTER: BRANDING & DISCLAIMER -->
        <footer class="mt-12 text-center border-t border-white/10 pt-8 pb-20 md:pb-8">
            <div class="mb-4 animate-pulse">
                <span class="text-slate-500 text-[10px] font-bold uppercase tracking-widest">GeliÅŸtirici</span>
                <h3 class="text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400 drop-shadow-sm">BAÅARAN TechZone</h3>
                <a href="https://www.instagram.com/basarantechzone" target="_blank" class="text-blue-500 hover:text-blue-400 text-[10px] font-bold uppercase tracking-widest">instagram.com/basarantechzone</a>
            </div>
            <p class="text-[10px] text-slate-600 max-w-lg mx-auto leading-relaxed">
                âš ï¸ Bu site Ã–SYM veya herhangi bir resmi kurumla iliÅŸkili deÄŸildir. Tamamen kiÅŸisel Ã§alÄ±ÅŸma takibi amacÄ±yla hazÄ±rlanmÄ±ÅŸtÄ±r.<br>
                <a href="https://www.instagram.com/basarantechzone" target="_blank" class="text-amber-500 hover:text-amber-400 font-bold underline decoration-amber-500/30">Destek & Ã–nerileriniz Ä°Ã§in: instagram.com/basarantechzone</a><br>


                Resmi sÄ±nav takvimi ve baÅŸvurular iÃ§in lÃ¼tfen <a href="https://www.osym.gov.tr" target="_blank" class="text-blue-500 hover:text-blue-400 font-bold underline decoration-blue-500/30">www.osym.gov.tr</a> adresini ziyaret ediniz.
            </p>
        </footer>

    </div>

    <!-- LÄ°DERLÄ°K SAYFASI -->
    <div id="page-leaderboard" class="page-content max-w-2xl mx-auto p-4 md:p-8">
        <div class="bg-[#161e31] border border-amber-500/20 p-6 md:p-8 rounded-3xl w-full shadow-2xl relative flex flex-col h-[80vh]">
            <h2 class="text-2xl font-black text-white mb-6 uppercase tracking-tight flex items-center gap-3">
                <span class="text-3xl text-amber-400">ğŸ†</span> Liderlik Tablosu
            </h2>
            <div id="leaderboard-list" class="space-y-2 overflow-y-auto custom-scrollbar pr-2 text-left flex-1">
                <div class="text-center text-slate-500 py-10">YÃ¼kleniyor...</div>
            </div>
            <p class="text-[10px] text-slate-600 mt-4 text-center">En yÃ¼ksek XP puanÄ±na sahip ilk 10 kullanÄ±cÄ± gÃ¶sterilir.</p>
        </div>
    </div>

    <!-- SOHBET SAYFASI -->
    <div id="page-chat" class="page-content max-w-md mx-auto p-4 md:p-8">
        <div class="bg-[#161e31] border border-blue-500/20 rounded-3xl w-full h-[80vh] shadow-2xl relative flex flex-col overflow-hidden">
            <div class="p-4 border-b border-white/5 bg-[#0a0f1c] flex justify-between items-center shrink-0">
                <h3 class="text-lg font-black text-white uppercase tracking-tight flex items-center gap-2"><span class="text-blue-400 text-2xl">ğŸ’¬</span> KPSS Sohbet OdasÄ±</h3>
                <div id="admin-controls" class="hidden flex gap-2">
                    <button onclick="openCreateAnnouncementModal()" class="bg-amber-600 text-white px-3 py-1 rounded-lg text-[10px] font-bold uppercase hover:bg-amber-500 transition-colors">ğŸ“¢ Duyuru</button>
                </div>
                <button onclick="openChatRulesModal()" class="text-slate-500 hover:text-white transition-colors p-2" title="Topluluk KurallarÄ±">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </button>
            </div>
            <div id="chat-messages" class="flex-1 overflow-y-auto custom-scrollbar p-4 bg-[#0f172a]/50 flex flex-col">
                <div class="text-center text-slate-500 text-xs py-10">Sohbet yÃ¼kleniyor...</div>
            </div>
            <div class="p-3 bg-[#0a0f1c] border-t border-white/5 flex gap-2 shrink-0">
                <input type="text" id="chat-input" class="flex-1 bg-slate-800/50 border border-white/10 rounded-xl px-4 py-3 text-white text-sm outline-none focus:border-blue-500 transition-colors placeholder:text-slate-600" placeholder="Bir ÅŸeyler yaz..." onkeypress="if(event.key === 'Enter') sendMessage()">
                <button onclick="sendMessage()" class="bg-blue-600 text-white w-12 rounded-xl hover:bg-blue-500 transition-colors shadow-lg flex items-center justify-center text-lg">â¤</button>
            </div>
        </div>
    </div>

    <!-- PROFÄ°L SAYFASI -->
    <div id="page-profile" class="page-content max-w-md mx-auto p-4 md:p-8">
        <div class="bg-[#161e31] border border-white/10 p-8 rounded-[2rem] w-full text-center shadow-2xl relative overflow-hidden group">
            <!-- Dekoratif Arka Plan -->
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-amber-500"></div>
            
            <!-- LOGO / Ä°KON -->
            <div class="w-20 h-20 bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-white/5 flex items-center justify-center mx-auto mb-6 shadow-lg">
                <span class="text-4xl">ğŸ‘¤</span>
            </div>

            <!-- BAÅLIK -->
            <h3 id="auth-modal-title" class="text-2xl font-black text-white mb-2 uppercase tracking-tight">Profilim</h3>
            <p id="auth-modal-desc" class="text-slate-400 text-xs font-medium leading-relaxed mb-8">
                Hesap ayarlarÄ±nÄ± buradan yÃ¶netebilirsin.
            </p>

            <!-- GÄ°RÄ°Å SEÃ‡ENEKLERÄ° (GiriÅŸ YapÄ±lmamÄ±ÅŸsa) -->
            <div id="auth-options" class="flex flex-col gap-3">
                <button onclick="handleGoogleLogin()" class="relative w-full bg-white hover:bg-slate-100 text-slate-900 py-4 rounded-xl font-bold text-sm uppercase shadow-lg transition-all flex items-center justify-center gap-3 group/btn">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5 h-5" alt="Google">
                    <span>Google ile GiriÅŸ Yap</span>
                </button>
                
                <div class="flex items-center gap-2 my-2">
                    <div class="h-px bg-white/10 flex-1"></div>
                    <span class="text-[10px] text-slate-500 uppercase">veya E-posta</span>
                    <div class="h-px bg-white/10 flex-1"></div>
                </div>

                <div class="flex flex-col gap-2">
                    <input type="email" id="login-email" placeholder="E-posta" class="bg-[#0a0f1c] border border-white/10 rounded-xl px-4 py-3 text-white text-sm outline-none focus:border-blue-500 transition-colors">
                    <input type="password" id="login-password" placeholder="Åifre" class="bg-[#0a0f1c] border border-white/10 rounded-xl px-4 py-3 text-white text-sm outline-none focus:border-blue-500 transition-colors">
                    <button onclick="handleEmailLogin()" class="bg-blue-600 text-white py-3 rounded-xl font-bold text-xs uppercase shadow-lg hover:bg-blue-500 transition-all">GiriÅŸ Yap</button>
                </div>
            </div>

            <!-- PROFÄ°L SEÃ‡ENEKLERÄ° (GiriÅŸ YapÄ±lmÄ±ÅŸsa) -->
            <div id="profile-options" class="hidden flex-col gap-3">
                <div class="bg-slate-800/50 rounded-xl p-4 mb-2 border border-white/5">
                    <p class="text-slate-400 text-xs uppercase font-bold mb-1">GiriÅŸ YapÄ±lan Hesap</p>
                    <p id="auth-current-user" class="text-white font-bold text-sm">kullanici@gmail.com</p>
                </div>
                
                <div class="bg-slate-800/50 rounded-xl p-4 mb-2 border border-white/5">
                    <p class="text-slate-400 text-xs uppercase font-bold mb-2">SÄ±ralama Ä°smi (Nick)</p>
                    <div class="flex gap-2 items-center">
                        <input type="text" id="custom-username-input" class="flex-1 bg-slate-900 border border-white/10 rounded-lg px-3 py-2 text-white text-sm font-bold outline-none focus:border-blue-500 transition-colors" placeholder="Ad Soyad">
                        <button onclick="saveCustomUsername()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg font-bold text-xs uppercase transition-colors shadow-lg shrink-0">Kaydet</button>
                    </div>
                </div>

                <button onclick="document.getElementById('theme-modal').classList.remove('hidden')" class="w-full bg-slate-700 hover:bg-slate-600 text-white py-4 rounded-xl font-bold text-sm uppercase shadow-lg transition-all flex items-center justify-center gap-2">
                    <span>ğŸ¨</span> Tema DeÄŸiÅŸtir
                </button>

                <button onclick="openAchievementsModal()" class="w-full bg-amber-600 hover:bg-amber-500 text-white py-4 rounded-xl font-bold text-sm uppercase shadow-lg transition-all flex items-center justify-center gap-2">
                    <span>ğŸ†</span> BaÅŸarÄ±mlarÄ±mÄ± GÃ¶r
                </button>

                <button onclick="handleGoogleLogin()" class="w-full bg-red-600/90 hover:bg-red-600 text-white py-4 rounded-xl font-bold text-sm uppercase shadow-lg shadow-red-900/20 transition-all mt-4">Ã‡Ä±kÄ±ÅŸ Yap</button>
            </div>
        </div>
    </div>

    <!-- DESTEK SAYFASI -->
    <div id="page-support" class="page-content max-w-2xl mx-auto p-4 md:p-8">
        <div class="bg-[var(--osym-card)] border border-white/10 p-8 rounded-3xl w-full shadow-2xl relative">
            <h2 class="text-2xl font-black text-white mb-6 uppercase tracking-tight flex items-center gap-3">
                <span class="text-3xl">ğŸ“–</span> Site KullanÄ±m Rehberi
            </h2>
            
            <div class="space-y-5 mb-8">
                <div>
                    <h3 class="text-blue-400 font-bold text-sm uppercase mb-1">1. Geri SayÄ±m SayacÄ±</h3>
                    <p class="text-slate-400 text-xs leading-relaxed">SÄ±nav tarihlerine (Lisans, Ã–nlisans, OrtaÃ¶ÄŸretim) kalan zamanÄ± gÃ¼n, saat, dakika ve saniye olarak gÃ¶sterir.</p>
                </div>
                <div>
                    <h3 class="text-amber-400 font-bold text-sm uppercase mb-1">2. OyunlaÅŸtÄ±rma (Seviye & Rozetler)</h3>
                    <p class="text-slate-400 text-xs leading-relaxed">Ders Ã§alÄ±ÅŸma sÃ¼recini bir oyuna dÃ¶nÃ¼ÅŸtÃ¼rÃ¼r. YaptÄ±ÄŸÄ±n her aktivite (ders bitirme, soru Ã§Ã¶zme, pomodoro tamamlama vb.) sana tecrÃ¼be puanÄ± (XP) kazandÄ±rÄ±r.</p>
                </div>
                <div>
                    <h3 class="text-blue-400 font-bold text-sm uppercase mb-1">3. Atama OdaÄŸÄ± (Pomodoro)</h3>
                    <p class="text-slate-400 text-xs leading-relaxed">ZamanÄ± yÃ¶netmeni saÄŸlar (25dk Ders / 5dk Mola).</p>
                </div>
                <div>
                    <h3 class="text-cyan-400 font-bold text-sm uppercase mb-1">4. Nefes Egzersizi</h3>
                    <p class="text-slate-400 text-xs leading-relaxed">StreslendiÄŸinde veya odaklanamadÄ±ÄŸÄ±nda aÃ§Ä±p, ekrandaki talimatla nefes alÄ±p vererek sakinleÅŸmeni saÄŸlar.</p>
                </div>
                <div>
                    <h3 class="text-blue-400 font-bold text-sm uppercase mb-1">5. Ders ProgramÄ± & Sertifika</h3>
                    <p class="text-slate-400 text-xs leading-relaxed">HaftalÄ±k ve gÃ¼nlÃ¼k olarak yapÄ±landÄ±rÄ±lmÄ±ÅŸ Ã§alÄ±ÅŸma planÄ±nÄ± takip et. %100'e ulaÅŸtÄ±ÄŸÄ±nda ismine Ã¶zel <strong>BaÅŸarÄ± SertifikasÄ±</strong> almaya hak kazanÄ±rsÄ±n.</p>
                </div>
                <div>
                    <h3 class="text-amber-400 font-bold text-sm uppercase mb-1">6. Deneme Takibi</h3>
                    <p class="text-slate-400 text-xs leading-relaxed">Deneme netlerini girerek tahmini puanÄ±nÄ± hesaplar. SonuÃ§larÄ±nÄ± liste ve <strong>Grafik</strong> Ã¼zerinde analiz etmeni saÄŸlar.</p>
                </div>
                <div>
                    <h3 class="text-purple-400 font-bold text-sm uppercase mb-1">7. GÃ¼nlÃ¼k Performans & Soru Hedefi</h3>
                    <p class="text-slate-400 text-xs leading-relaxed">Kendine gÃ¼nlÃ¼k bir soru Ã§Ã¶zme hedefi (Ã¶rn: 200 soru) koyarsÄ±n. Ã‡Ã¶zdÃ¼kÃ§e sisteme girersin. Hedefe ulaÅŸtÄ±ÄŸÄ±nda sistem seni kutlar.</p>
                </div>
                <div>
                    <h3 class="text-rose-400 font-bold text-sm uppercase mb-1">8. Zinciri KÄ±rma (Streak) MantÄ±ÄŸÄ±</h3>
                    <p class="text-slate-400 text-xs leading-relaxed">Bu Ã¶zellik disiplinini Ã¶lÃ§er. EÄŸer o gÃ¼nkÃ¼ "Soru Hedefine" ulaÅŸÄ±rsan, takvimdeki o gÃ¼n yeÅŸil olur. AmacÄ±n, hiÃ§ boÅŸ gÃ¼n bÄ±rakmadan (zinciri koparmadan) her gÃ¼n hedefini tutturmaktÄ±r.</p>
                </div>
                <div>
                    <h3 class="text-pink-500 font-bold text-sm uppercase mb-1">9. Hap Bilgiler (Ezber KartlarÄ±)</h3>
                    <p class="text-slate-400 text-xs leading-relaxed">Tarih, CoÄŸrafya ve VatandaÅŸlÄ±k dersleri iÃ§in pratik yapmanÄ± saÄŸlar. Karta tÄ±kla, cevabÄ± gÃ¶r, "SÄ±radaki" diyerek yeni bilgiye geÃ§.</p>
                </div>
            </div>

            <button onclick="openTermsModal()" class="w-full bg-slate-800 text-white py-4 rounded-xl font-bold text-xs uppercase hover:bg-slate-700 transition-all border border-white/5">KullanÄ±m KoÅŸullarÄ±</button>
            
            <div class="mt-8 text-center border-t border-white/10 pt-8">
                <div class="mb-4">
                    <span class="text-slate-500 text-[10px] font-bold uppercase tracking-widest">GeliÅŸtirici</span>
                    <h3 class="text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400 drop-shadow-sm">BAÅARAN TechZone</h3>
                    <a href="https://www.instagram.com/basarantechzone" target="_blank" class="text-blue-500 hover:text-blue-400 text-[10px] font-bold uppercase tracking-widest">instagram.com/basarantechzone</a>
                </div>
                <p class="text-[10px] text-slate-600 max-w-lg mx-auto leading-relaxed">
                    âš ï¸ Bu site Ã–SYM veya herhangi bir resmi kurumla iliÅŸkili deÄŸildir. Tamamen kiÅŸisel Ã§alÄ±ÅŸma takibi amacÄ±yla hazÄ±rlanmÄ±ÅŸtÄ±r.
                </p>
            </div>
        </div>
    </div>

    <!-- ALT MENÃœ (BOTTOM NAV) -->
    <nav class="bottom-nav">
        <button class="nav-item active" onclick="switchTab('home')">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            <span>Ana Sayfa</span>
        </button>
        <button class="nav-item" onclick="switchTab('leaderboard')">
            <svg viewBox="0 0 24 24"><path d="M16 11V3H8v6H2v12h20V11h-6zm-6-6h4v14h-4V5zm-6 6h4v8H4v-8zm16 8h-4v-6h4v6z"/></svg>
            <span>SÄ±ralama</span>
        </button>
        <button class="nav-item" onclick="switchTab('chat')">
            <div class="relative">
                <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
                <span id="chat-badge" class="hidden absolute -top-1 -right-2 bg-red-600 text-white text-[9px] font-black px-1.5 py-0.5 rounded-full border-2 border-[#0f172a] min-w-[18px] text-center shadow-sm animate-bounce">0</span>
            </div>
            <span>Sohbet</span>
        </button>
        <button class="nav-item" onclick="switchTab('profile')">
            <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            <span>Profil</span>
        </button>
        <button class="nav-item" onclick="switchTab('support')">
            <svg viewBox="0 0 24 24"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/></svg>
            <span>Destek</span>
        </button>
    </nav>

    <script>
        const motivasyonSozleri = [
            "BugÃ¼n ektiÄŸin o zor sorular, yarÄ±n sÄ±nav kaÄŸÄ±dÄ±nda Ã§iÃ§ek aÃ§acak.",
            "Rakiplerin sosyal medyada gezerken, sen geleceÄŸini inÅŸa ediyorsun.",
            "KPSS bir zeka sÄ±navÄ± deÄŸil, bir karakter ve dayanÄ±klÄ±lÄ±k sÄ±navÄ±dÄ±r.",
            "O masa baÅŸÄ±ndaki sÄ±rt aÄŸrÄ±sÄ±, atama kararnamesindeki imza kadar deÄŸerli.",
            "ZorlanÄ±yorsan bil ki geliÅŸiyorsun.",
            "Memuriyet bir hayal deÄŸil, planlÄ± bir Ã§alÄ±ÅŸmanÄ±n sonucudur.",
            "Kendine inan, bu puanÄ± en Ã§ok sen hak ediyorsun.",
            "YorgunluÄŸun geÃ§ecek ama baÅŸarÄ±nÄ±n gururu Ã¶mÃ¼r boyu kalacak.",
            "Her iÅŸaretlediÄŸin kutucuk, seni hayalindeki o koltuÄŸa bir adÄ±m daha yaklaÅŸtÄ±rÄ±yor.",
            "Disiplin, neyi istediÄŸinle ÅŸu an neyi istediÄŸin arasÄ±ndaki farktÄ±r."
        ];

        const rawData = [
            //1. Hafta
            ["SÃ¶zcÃ¼kte Anlam", "Temel Kavramlar", "Ä°slamiyet Ã–ncesi TÃ¼rk Devletleri"],
            ["CÃ¼mlenin AnlamÄ±", "Rasyonel SayÄ±lar", "TÃ¼rkiye CoÄŸrafi Konumu"],
            ["SÃ¶zcÃ¼k TÃ¼rleri", "OndalÄ±k SayÄ±lar", "Hukuka GiriÅŸ"],
            ["SÃ¶zcÃ¼kte YapÄ±", "Basit EÅŸitsizlikler", "Ã–zel ÃœÃ§genler"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "HaftalÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["CÃ¼mlenin Ã–geleri", "Mutlak DeÄŸer", "Ä°lk MÃ¼slÃ¼man TÃ¼rk Devletleri"],
            ["Ses OlaylarÄ±", "ÃœslÃ¼ SayÄ±lar", "TÃ¼rkiye'nin Yer Åekilleri"],
            //2. Hafta
            ["YazÄ±m KurallarÄ±", "KÃ¶klÃ¼ SayÄ±lar", "Genel Esaslar"],
            ["Noktalama Ä°ÅŸaretleri", "Ã‡arpanlara AyÄ±rma", "DÃ¶rtgenler ve Ã‡okgenler"],
            ["Paragrafta Anlam", "Denklem Ã‡Ã¶zme", "OsmanlÄ± Siyasi Tarihi"],
            ["Paragrafta AnlatÄ±m YollarÄ±", "SayÄ± Problemleri", "TÃ¼rkiye Ä°klimi ve Bitki Ã–rtÃ¼sÃ¼"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "HaftalÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["SÃ¶zel MantÄ±k", "YaÅŸ Problemleri", "Yasama"],
            ["SÃ¶zcÃ¼kte Anlam", "Hareket Problemleri", "Ã‡okgenler"],
            //3. Hafta
            ["CÃ¼mlenin AnlamÄ±", "YÃ¼zde kÃ¢r - Zarar, Faiz ", "OsmanlÄ± KÃ¼ltÃ¼r UygarlÄ±k"],
            ["SÃ¶zcÃ¼k TÃ¼rleri", "BaÄŸÄ±ntÄ± ve Fonksiyon", "Toprak ve DoÄŸa Ã‡evre"],
            ["SÃ¶zcÃ¼kte YapÄ±", "Ä°ÅŸlem", "YÃ¼rÃ¼tme"],
            ["CÃ¼mlenin Ã–geleri", "OlasÄ±lÄ±k", "Analitik Geometri"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "HaftalÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["Ses OlaylarÄ±", "SayÄ±sal MantÄ±k", "KurtuluÅŸ SavaÅŸÄ± HazÄ±rlÄ±k"],
            ["YazÄ±m KurallarÄ±", "Temel Kavramlar Tekrar", "BeÅŸeri CoÄŸrafya"],
            //4. Hafta
            ["Noktalama Ä°ÅŸaretleri", "Rasyonel SayÄ±lar", "Ä°dari YapÄ±"],
            ["Paragrafta Anlam", "OndalÄ±k SayÄ±lar", "Ã–zel ÃœÃ§genler"],
            ["Paragrafta AnlatÄ±m YollarÄ±", "Basit EÅŸitsizlikler", "KurtuluÅŸ SavaÅŸÄ± Cepheleri"],
            ["SÃ¶zel MantÄ±k", "Mutlak DeÄŸer", "TarÄ±m"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "HaftalÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["Genel Paragraf Deneme", "ÃœslÃ¼ SayÄ±lar", "GÃ¼ncel Olaylar"],
            ["SÃ¶zcÃ¼kte Anlam", "KÃ¶klÃ¼ SayÄ±lar", "DÃ¶rtgenler"],
            //5. Hafta
            ["CÃ¼mlenin AnlamÄ±", "Ã‡arpanlara AyÄ±rma", "Devrim Tarihi"],
            ["Ses OlaylarÄ± Genel Tekrar", "Denklem Ã‡Ã¶zme", "Maden ve Enerji KaynaklarÄ±"],
            ["YazÄ±m - Noktalama", "SayÄ± Problemleri", "VatandaÅŸlÄ±k Genel Tekrar"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "AylÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["Paragraf Denemesi", "YaÅŸ Problemleri", "AtatÃ¼rk DÃ¶nemi Ä°Ã§ Politika"],
            ["SÃ¶zel MantÄ±k (yeni test)", "Hareket Problemleri", "Sanayi"],
            //6. Hafta
            ["SÃ¶zcÃ¼k TÃ¼rleri", "KÃ¢r - Zarar, Faiz", "Hukuka GiriÅŸ"],
            ["Paragraf Testi", "BaÄŸÄ±ntÄ± ve Fonksiyon", "Ã‡okgenler"],
            ["Ses OlaylarÄ± Test", "Ä°ÅŸlem", "AtatÃ¼rk DÄ±ÅŸ Politika"],
            ["YazÄ±m - Noktalama Soru", "OlasÄ±lÄ±k", "UlaÅŸÄ±m"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "HaftalÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["Paragrafta Anlam", "SayÄ±sal MantÄ±k", "Yasama Tekrar"],
            ["CÃ¼mlenin AnlamÄ±", "Temel Kavramlar Tekrar", "Analitik Geometri"],
            //7. Hafta
            ["Paragraf Testleri", "Basit EÅŸitsizlikler Tekrar", "AtatÃ¼rk Ä°lkeleri"],
            ["SÃ¶zcÃ¼kte YapÄ± Tekrar", "ÃœslÃ¼ SayÄ±lar Genel Tekrar", "Turizm"],
            ["SÃ¶zel MantÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼", "Ã‡arpanlara AyÄ±rma Tekrar", "YÃ¼rÃ¼tme Tekrar"],
            ["Paragraf Denemesi", "Problemler Genel Tekrar", "Ã–zel ÃœÃ§genler Tekrar"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "HaftalÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["Paragrafta AnlatÄ±m YollarÄ±", "TÃ¼m Problemler (Test)", "Ã‡aÄŸdaÅŸ TÃ¼rk ve DÃ¼nya"],
            ["CÃ¼mlenin Ã–geleri (test)", "Fonksiyon + iÅŸlem Tekrar", "TÃ¼rkiye'nin Yer Åekilleri"],
            //8. Hafta
            ["Ses OlaylarÄ± Denemesi", "SayÄ±sal MantÄ±k Test", "Ä°dari YapÄ± (tekrar)"],
            ["Paragraf Denemesi", "Matematik KarÄ±ÅŸÄ±k Deneme", "Analitik Geometri"],
            ["YazÄ±m KurallarÄ± Test", "SayÄ± Problemleri Test", "KurtuluÅŸ SavaÅŸÄ± Tekrar"],
            ["Paragraf Testi", "Problemler Deneme", "TÃ¼rkiye'nin Ä°klimi TekrarÄ±"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "HaftalÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["Paragraf Genel Tekrar", "Matematik KarÄ±ÅŸÄ±k Deneme", "GÃ¼ncel Olaylar (tekrar)"],
            ["Noktalama - YazÄ±m Tekrar", "Ã‡arpanlara AyÄ±ma Tekrar", "Ã‡okgenler Genel Tekrar"],
            //9. Hafta
            ["SÃ¶zel MantÄ±k Denemesi", "YaÅŸ - Hareket Problemleri", "OsmanlÄ± KÃ¼ltÃ¼r + UygarlÄ±k"],
            ["Paragraf Denemesi", "Faiz + YÃ¼zde Genel Tekrar", "TarÄ±m Genel Tekrar"],
            ["SÃ¶zcÃ¼kte YapÄ± Tekrar", "Fonksiyon + Ä°ÅŸlem Tekrar", "Yasama + YÃ¼rÃ¼tme Tekrar"],
            ["TÃ¼rkÃ§e Genel Deneme", "Matematik Genel Deneme", "Geometri Genel Deneme"],
            ["AylÄ±k Tekrar (TÃ¼m Dersler)", "BÃ¼yÃ¼k Deneme SÄ±navÄ± (GK - GY '120 Soru')"],
            ["SÃ¶zcÃ¼kte Anlam Genel Tekrar", "Rasyonel SayÄ±lar Tekrar", "Ä°. Ã–. TÃ¼rk Dev. Genel Tekrar"],
            ["CÃ¼mle AnlamÄ± Genel Tekrar", "OndalÄ±k SayÄ±lar Genel Tekrar", "CoÄŸrafi Konum Genel Tekrar"],
            //10. Hafta
            ["SÃ¶zcÃ¼k TÃ¼rleri (test)", "Mutlak DeÄŸer Genel Tekrar", "Hukuka GiriÅŸ (test)"],
            ["SÃ¶zcÃ¼kte YapÄ± (soru)", "KÃ¶klÃ¼ SayÄ±lar Genel Tekrar", "Ã–zel ÃœÃ§genler (test)"],
            ["CÃ¼mlenin Ã–geleri (test)", "Denklem Ã‡Ã¶zme Tekrar", "OsmanlÄ± Siyasi Tarihi Test"],
            ["Ses OlaylarÄ± (test)", "SayÄ± Problemleri (test)", "Yer Åekilleri (test)"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "HaftalÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["YazÄ±m KurallarÄ± (test)", "YaÅŸ Problemleri (test)", "Genel Esaslar (test)"],
            ["Noktalama Ä°ÅŸaretleri (test)", "Hareket Problemi (test)", "DÃ¶rtgenler (test)"],
            //11. Hafta
            ["Paragrafta Anlam (test)", "Faiz Problemleri (test)", "KÃ¼ltÃ¼r ve UygarlÄ±k (test)"],
            ["Paragrafta AnlatÄ±m YollarÄ±", "Fonksiyon Genel Tekrar", "Ä°klim ve Bitki Ã–rtÃ¼sÃ¼ (test)"],
            ["SÃ¶zel MantÄ±k (detay test)", "OlasÄ±lÄ±k (detay test)", "Yasama (detay test)"],
            ["Genel Paragraf Denemesi", "SayÄ±sal MantÄ±k (test)", "Ã‡okgenler (test)"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "HaftalÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["SÃ¶zcÃ¼kte Anlam (test)", "Denklem Ã‡Ã¶zme (test)", "KurtuluÅŸ SavaÅŸÄ± (test)"],
            ["CÃ¼mlenin AnlamÄ± (tekrar)", "Problemler Genel Tekrar)", "Toprak ve DoÄŸa Ã‡evvre"],
            //12. Hafta
            ["SÃ¶zcÃ¼k TÃ¼rleri (test)", "ÃœslÃ¼ SayÄ±lar (test)", "YÃ¼rÃ¼tme (detay test)"],
            ["Paragrafta Anlam (test)", "KÃ¶klÃ¼ SayÄ±lar (test)", "Analitik Geometri (test)"],
            ["Ses Olaylar (tekrar)", "Ä°ÅŸlem + OlasÄ±lÄ±k Denemesi", "KurtuluÅŸ SavaÅŸu (test)"],
            ["Noktlama Genel Tekrar)", "SayÄ±sal MantÄ±k Denemesi", "BeÅŸeri CoÄŸrafya (test)"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "HaftalÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["Paragraf Denemesi)", "KarÄ±ÅŸÄ±k Problemler Testi", "Ä°dari YapÄ± (test)"],
            ["SÃ¶zel MantÄ±k Denemesi)", "Matematik Genel Tekrar", "Geometri KarÄ±ÅŸÄ±k Test"],
            //13. Hafta
            ["Paragraf Genel Tekrar", "Matematik KarÄ±ÅŸÄ±k Deneme", "Ä°Ã§ ve DÄ±ÅŸ Politika (test)"],
            ["CÃ¼mlenin Ã–geleri (test)", "YÃ¼zde Problem Tekrar", "Madenler (test)"],
            ["YazÄ±m Noktalama (tekrar)", "Fonksiyon + Ä°ÅŸlem Tekrar", "GÃ¼ncel Olaylar (test)"],
            ["Paragraf Denemesi", "Matematik Genel Deneme", "Geometri Genel Tekrar"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "HaftalÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["SÃ¶zel MantÄ±k (karÄ±ÅŸÄ±k test)", "KarÄ±ÅŸÄ±k Problem Denemesi", "AtatÃ¼rk Ä°lkeleri (test)"],
            ["Paragraf Genel Test", "KarÄ±ÅŸÄ±k Deneme (40 Soru)", "Turizm (detay test)"],
            //14. Hafta 
            ["AylÄ±k Genel Tekrar", "BÃ¼yÃ¼k Deneme SÄ±navÄ± (GK - GY '120 Soru')",],
            ["SÃ¶zcÃ¼kte Anlam (test)", "Temel Kavram Genel Tekrar", "islamiyet Ã–ncesi TÃ¼rk Devletleri (test)"],
            ["CÃ¼mlenin AnlamÄ± (test)", "Basit EÅŸitsizlikler Tekrar", "CoÄŸrafi Konum (test)"],
            ["SÃ¶zcÃ¼k TÃ¼rleri (test)", "ÃœslÃ¼ SayÄ±lar Genel Tekrar", "Hukuka GiriÅŸ (test)"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "HaftalÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["SÃ¶zcÃ¼kte YapÄ± (tekrar)", "Ã‡arpanlara AyÄ±rma (tekrar)", "Ã¶zel ÃœÃ§genler"],
            ["CÃ¼mlenin Ã–geleri (test)", "Problemler Genel Tekrar", "OsmanlÄ± Siyasi Tarihi (test)"],
            //15. Hafta
            ["Ses OlaylarÄ± (test)", "SayÄ± Problemleri (test)", "Yer Åekilleri (test)"],
            ["YazÄ±m KurallarÄ± (test)", "YaÅŸ Problemleri (tekrar)", "Genel Esaslar (test)"],
            ["Noktalama Ä°ÅŸaretleri (test)", "Hareket Problem Tekrar", "DÃ¶rtgenler"],
            ["Paragrafta Anlam (test)", "YÃ¼zde Problemleri (test)", "KÃ¼ltÃ¼r ve UygarlÄ±k (test)"],
            ["Genel Tekrar", "Deneme SÄ±navÄ±", "HaftalÄ±k Soru Ã‡Ã¶zÃ¼mÃ¼"],
            ["Paragrafta AnlatÄ±m (test)", "Fonksiyon Genel Tekrar)", "Ä°klim ve Bitki Ã–rtÃ¼sÃ¼ (test)"],
            ["SÃ¶zel MantÄ±k (test)", "OlasÄ±lÄ±k (test)", "Yasama (test)"],
            //16. Hafta


        ];

        const weeks = [
            { id: 0, title: "1. HAFTA", days: [0, 1, 2, 3, 4, 5, 6] },
            { id: 1, title: "2. HAFTA", days: [7, 8, 9, 10, 11, 12, 13] },
            { id: 2, title: "3. HAFTA", days: [14, 15, 16, 17, 18, 19, 20] },
            { id: 3, title: "4. HAFTA", days: [21, 22, 23, 24, 25, 26, 27] },
            { id: 4, title: "5. HAFTA", days: [28, 29, 30, 31, 32, 33, 34] },
            { id: 5, title: "6. HAFTA", days: [35, 36, 37, 38, 39, 40, 41] },
            { id: 6, title: "7. HAFTA", days: [42, 43, 44, 45, 46, 47, 48] },
            { id: 7, title: "8. HAFTA", days: [49, 50, 51, 52, 53, 54, 55] },
            { id: 8, title: "9. HAFTA", days: [56, 57, 58, 59, 60, 61, 62] },
            { id: 9, title: "10. HAFTA", days: [63, 64, 65, 66, 67, 68, 69] },
            { id: 10, title: "11. HAFTA", days: [70, 71, 72, 73, 74, 75, 76] },
            { id: 11, title: "12. HAFTA", days: [77, 78, 79, 80, 81, 82, 83] },
            { id: 12, title: "13. HAFTA", days: [84, 85, 86, 87, 88, 89, 90] },
            { id: 13, title: "14. HAFTA", days: [91, 92, 93, 94, 95, 96, 97] },
            { id: 14, title: "15. HAFTA", days: [98, 99, 100, 101, 102, 103, 104] },
            




        ];

        let completedLessons = JSON.parse(localStorage.getItem('kpss_v6_data')) || {};
        let currentWeekId = null;

        // YENÄ°: HoÅŸ Geldin EkranÄ± Fonksiyonu
        window.showWelcomeScreen = (user) => {
            const overlay = document.getElementById('welcome-overlay');
            const nameEl = document.getElementById('welcome-name');
            const imgEl = document.getElementById('welcome-avatar');
            const rankEl = document.getElementById('welcome-rank');

            nameEl.innerText = user.displayName || 'Misafir';
            // Google fotosu varsa kullan, yoksa baÅŸ harflerden avatar oluÅŸtur
            imgEl.src = user.photoURL ? user.photoURL : `https://ui-avatars.com/api/?name=${user.displayName}&background=f59e0b&color=fff&size=128`;

            // RÃ¼tbe bilgisini ekle
            if (rankEl && typeof gamificationData !== 'undefined' && typeof RANKS !== 'undefined') {
                const currentRank = RANKS.slice().reverse().find(r => gamificationData.level >= r.level) || RANKS[0];
                rankEl.innerHTML = `<span class="text-amber-500">${currentRank.icon}</span> Seviye ${gamificationData.level} - ${currentRank.title}`;
            }

            overlay.classList.remove('hidden');
            
            // 2.5 saniye sonra yavaÅŸÃ§a kaybol
            setTimeout(() => {
                overlay.classList.add('opacity-0');
                setTimeout(() => {
                    overlay.classList.add('hidden');
                    overlay.classList.remove('opacity-0');
                }, 1000);
            }, 2500);
        };

        // YENÄ°: Sekme DeÄŸiÅŸtirme Fonksiyonu
        window.switchTab = (tabId) => {
            // TÃ¼m sayfalarÄ± gizle
            document.querySelectorAll('.page-content').forEach(el => el.classList.remove('active'));
            // SeÃ§ilen sayfayÄ± gÃ¶ster
            document.getElementById(`page-${tabId}`).classList.add('active');
            
            // Alt menÃ¼ ikonlarÄ±nÄ± gÃ¼ncelle
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            // TÄ±klanan butonu bulmak iÃ§in basit bir index mantÄ±ÄŸÄ± veya onclick iÃ§inde class ekleme yapÄ±labilir ama
            // burada onclick'ten gelen event'i yakalamadÄ±ÄŸÄ±mÄ±z iÃ§in manuel index ile yapalÄ±m:
            const tabs = ['home', 'leaderboard', 'chat', 'profile', 'support'];
            const index = tabs.indexOf(tabId);
            if (index !== -1) {
                document.querySelectorAll('.nav-item')[index].classList.add('active');
            }

            // Sayfa Ã¶zel yÃ¼klemeleri
            if (tabId === 'leaderboard') openLeaderboardModal();
            if (tabId === 'chat') openChatModal();
            
            // Sohbet sekmesine geÃ§ildiyse bildirimi sÄ±fÄ±rla
            if (tabId === 'chat') {
                unreadChatCount = 0;
                updateChatBadge();
            }
            if (tabId === 'profile') openAuthModal();
            
            // Sayfa baÅŸÄ±na kaydÄ±r
            window.scrollTo(0, 0);
        };

        // -----------------------------------------------------------------------
        // FIREBASE ENTEGRASYONU (VERÄ° TABANI & GÄ°RÄ°Å)
        // -----------------------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyA_BN7C4YdaDBWfnqNTdqM2fv89pNY3PRs",
            authDomain: "kpss-b34e3.firebaseapp.com",
            projectId: "kpss-b34e3",
            storageBucket: "kpss-b34e3.firebasestorage.app",
            messagingSenderId: "858677856177",
            appId: "1:858677856177:web:ba1eaffdd4c19d3e1b5f90",
            measurementId: "G-8GPTMZ73HX"
        };

        let auth, db, provider;

        // Firebase BaÅŸlatma
        if (typeof firebase !== 'undefined') {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            provider = new firebase.auth.GoogleAuthProvider();

            // KullanÄ±cÄ± Durumunu Dinle
            auth.onAuthStateChanged(async (user) => {
                const btnText = document.getElementById('login-btn-text');
                if (user) {
                    // if(btnText) btnText.innerText = "HesabÄ±m"; // ArtÄ±k alt menÃ¼de
                    localStorage.setItem('kpss_user_name', user.displayName);
                    
                    // Verileri Buluttan Ã‡ek
                    await loadUserData(user);

                    // HoÅŸ Geldin EkranÄ± (15 Dakika KuralÄ±)
                    const lastShown = localStorage.getItem('kpss_welcome_last_shown');
                    const now = Date.now();
                    if (!lastShown || (now - parseInt(lastShown)) > (15 * 60 * 1000)) {
                        window.showWelcomeScreen(user);
                        localStorage.setItem('kpss_welcome_last_shown', now);
                    }
                    
                    // Sohbet sistemini baÅŸlat (Bildirimler iÃ§in)
                    initChatSystem();
                } else {
                    // if(btnText) btnText.innerText = "GiriÅŸ Yap"; // ArtÄ±k alt menÃ¼de
                }
            });
        }

        // Veri YÃ¼kleme (Firestore -> Site)
        async function loadUserData(user) {
            if (!db) return;
            try {
                const doc = await db.collection('users').doc(user.uid).get();
                if (doc.exists) {
                    const data = doc.data();
                    if(data.completedLessons) { completedLessons = data.completedLessons; localStorage.setItem('kpss_v6_data', JSON.stringify(completedLessons)); }
                    if(data.gamificationData) { gamificationData = data.gamificationData; localStorage.setItem('kpss_gamification_data', JSON.stringify(gamificationData)); }
                    if(data.xpGrantedItems) { xpGrantedItems = new Set(data.xpGrantedItems); localStorage.setItem('kpss_xp_granted_items', JSON.stringify(data.xpGrantedItems)); }
                    if(data.examHistory) { examHistory = data.examHistory; localStorage.setItem('kpss_exam_history', JSON.stringify(examHistory)); }
                    if(data.todos) { todos = data.todos; localStorage.setItem('kpss_todos', JSON.stringify(todos)); }
                    if(data.qTarget) { qTarget = data.qTarget; localStorage.setItem('kpss_q_target', qTarget); }
                    if(data.qCurrent) { qCurrent = data.qCurrent; localStorage.setItem('kpss_q_current', qCurrent); }
                    if(data.streakLog) { streakLog = data.streakLog; localStorage.setItem('kpss_streak_log', JSON.stringify(streakLog)); }
                    if(data.pomoStats) { pomoStats = data.pomoStats; localStorage.setItem('kpss_pomo_stats', JSON.stringify(pomoStats)); }
                    if(data.quickNotes) { localStorage.setItem('kpss_quick_notes', data.quickNotes); const qn = document.getElementById('quick-notes'); if(qn) qn.value = data.quickNotes; }

                    // ArayÃ¼zÃ¼ Yenile
                    renderWeeks();
                    updateTotalProgress();
                    updateGamificationUI();
                    renderExamHistory();
                    renderTodos();
                    updateQuestionUI();
                    renderStreak();
                    updatePomoUI();
                    renderChart();
                    renderBadges();

                    // BaÅŸarÄ±lÄ± YÃ¼kleme Bildirimi
                    const toast = document.getElementById('toast');
                    if(toast) {
                        toast.querySelector('span').textContent = 'â˜ï¸';
                        document.getElementById('toast-quote').textContent = 'Verileriniz baÅŸarÄ±yla yÃ¼klendi.';
                        toast.classList.remove('hidden');
                        toast.classList.add('show');
                        setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.classList.add('hidden'), 700); }, 3000);
                    }
                } else {
                    // EÄŸer bulutta veri yoksa (ilk giriÅŸ), eldeki verileri buluta kaydet
                    saveUserData();
                }
            } catch (error) { console.error("Veri yÃ¼kleme hatasÄ±:", error); }
        }

        // Veri Kaydetme (Site -> Firestore)
        window.saveUserData = async () => {
            if (!auth || !auth.currentUser || !db) return;
            const user = auth.currentUser;
            const dataToSave = {
                displayName: user.displayName,
                photoURL: user.photoURL,
                completedLessons: completedLessons,
                gamificationData: gamificationData,
                xpGrantedItems: Array.from(xpGrantedItems),
                examHistory: examHistory,
                todos: todos,
                qTarget: qTarget,
                qCurrent: qCurrent,
                streakLog: streakLog,
                pomoStats: pomoStats,
                quickNotes: localStorage.getItem('kpss_quick_notes') || '',
                lastUpdated: new Date().toISOString()
            };
            try {
                await db.collection('users').doc(user.uid).set(dataToSave, { merge: true });
            } catch (error) { console.error("Veri kaydetme hatasÄ±:", error); }
        };

        // YENÄ°: Auth Modal FonksiyonlarÄ±
        window.openAuthModal = () => {
            // ArtÄ±k modal deÄŸil, sayfa iÃ§i elementleri gÃ¼ncelliyoruz
            const title = document.getElementById('auth-modal-title');
            const desc = document.getElementById('auth-modal-desc');
            const authOptions = document.getElementById('auth-options');
            const profileOptions = document.getElementById('profile-options');
            const currentUserEmail = document.getElementById('auth-current-user');

            if (auth && auth.currentUser) {
                // KullanÄ±cÄ± giriÅŸ yapmÄ±ÅŸsa Profil modunu gÃ¶ster
                title.innerText = `Merhaba, ${auth.currentUser.displayName.split(' ')[0]}`;
                desc.innerText = "HesabÄ±n ÅŸu an aktif. Ã‡Ä±kÄ±ÅŸ yapmak mÄ± istiyorsun?";
                authOptions.classList.add('hidden');
                profileOptions.classList.remove('hidden');
                profileOptions.classList.add('flex');
                currentUserEmail.innerText = auth.currentUser.email;
                
                // KullanÄ±cÄ± adÄ±nÄ± inputa doldur
                const nameInput = document.getElementById('custom-username-input');
                if(nameInput) nameInput.value = auth.currentUser.displayName || '';
            } else {
                // GiriÅŸ yapÄ±lmamÄ±ÅŸsa GiriÅŸ modunu gÃ¶ster
                title.innerText = "AramÄ±za KatÄ±l";
                desc.innerText = "Ä°lerlemeni kaydetmek, rozet kazanmak ve sÄ±ralamaya girmek iÃ§in giriÅŸ yap.";
                authOptions.classList.remove('hidden');
                profileOptions.classList.add('hidden');
                profileOptions.classList.remove('flex');
            }
            // modal.classList.remove('hidden'); // ArtÄ±k sayfa geÃ§iÅŸi ile yapÄ±lÄ±yor
        };

        window.closeAuthModal = () => {
            // document.getElementById('auth-selection-modal').classList.add('hidden');
            switchTab('home'); // KapatÄ±nca ana sayfaya dÃ¶n
        };

        // YENÄ°: KullanÄ±cÄ± AdÄ± Kaydetme
        window.saveCustomUsername = async () => {
            const input = document.getElementById('custom-username-input');
            const newName = input.value.trim();
            if (!newName) return alert("LÃ¼tfen geÃ§erli bir isim girin.");
            
            if (auth && auth.currentUser) {
                try {
                    // 1. Firebase Auth Profilini GÃ¼ncelle
                    await auth.currentUser.updateProfile({ displayName: newName });
                    
                    // 2. Firestore VeritabanÄ±nÄ± GÃ¼ncelle (Liderlik tablosu iÃ§in)
                    await db.collection('users').doc(auth.currentUser.uid).set({ displayName: newName }, { merge: true });
                    
                    // 3. ArayÃ¼zÃ¼ GÃ¼ncelle
                    localStorage.setItem('kpss_user_name', newName);
                    document.getElementById('auth-modal-title').innerText = `Merhaba, ${newName.split(' ')[0]}`;
                    
                    // Toast Bildirimi (Site Ä°Ã§i Mesaj)
                    const toast = document.getElementById('toast');
                    toast.querySelector('span').textContent = 'âœ…';
                    document.getElementById('toast-quote').textContent = 'Ä°sminiz baÅŸarÄ±yla gÃ¼ncellendi! ğŸ‰';
                    toast.classList.remove('hidden');
                    toast.classList.add('show');
                    setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.classList.add('hidden'), 700); }, 3000);
                } catch (error) {
                    console.error("Ä°sim gÃ¼ncelleme hatasÄ±:", error);
                    alert("Hata: " + error.message);
                }
            }
        };

        // Google GiriÅŸ Butonu Ä°Ã§in
        window.handleGoogleLogin = async () => {
            if (!auth) return alert("Firebase baÄŸlantÄ±sÄ± kurulamadÄ±.");
            if (auth.currentUser) {
                // Ã‡IKIÅ YAPILIRKEN YEREL VERÄ°LERÄ° TEMÄ°ZLE
                localStorage.removeItem('kpss_v6_data');
                localStorage.removeItem('kpss_gamification_data');
                localStorage.removeItem('kpss_xp_granted_items');
                localStorage.removeItem('kpss_exam_history');
                localStorage.removeItem('kpss_todos');
                localStorage.removeItem('kpss_q_target');
                localStorage.removeItem('kpss_q_current');
                localStorage.removeItem('kpss_streak_log');
                localStorage.removeItem('kpss_pomo_stats');
                localStorage.removeItem('kpss_quick_notes');
                localStorage.removeItem('kpss_user_name');
                localStorage.removeItem('kpss_total_q_solved');
                localStorage.removeItem('kpss_q_date');
                localStorage.removeItem('kpss_welcome_last_shown'); // HoÅŸ geldin sÃ¼resini de sÄ±fÄ±rla
                
                await auth.signOut();
                location.reload();
            } else {
                try {
                    await auth.signInWithPopup(provider);
                } catch (error) {
                    alert("GiriÅŸ hatasÄ±: " + error.message);
                }
            }
        };

        function updateLiveMotivation() {
            const el = document.getElementById('live-motivation');
            if(!el) return;
            el.classList.remove('motivation-active');
            setTimeout(() => {
                const randomQuote = motivasyonSozleri[Math.floor(Math.random() * motivasyonSozleri.length)];
                el.textContent = randomQuote;
                el.classList.add('motivation-active');
            }, 500);
        }

        function cleanTurkish(text) {
            return text.replace(/ÄŸ/g, 'g').replace(/Ä/g, 'G').replace(/Ã¼/g, 'u').replace(/Ãœ/g, 'U').replace(/ÅŸ/g, 's').replace(/Å/g, 'S').replace(/Ä±/g, 'i').replace(/Ä°/g, 'I').replace(/Ã¶/g, 'o').replace(/Ã–/g, 'O').replace(/Ã§/g, 'c').replace(/Ã‡/g, 'C');
        }

        function transitionToView(renderFunc, param = null) {
            const grid = document.getElementById('main-grid');
            grid.style.opacity = 0;
            setTimeout(() => {
                renderFunc(param);
                grid.style.opacity = 1;
            }, 300);
        }

        function renderWeeks() {
            currentWeekId = null;
            const grid = document.getElementById('main-grid');
            const backBtn = document.getElementById('back-btn');
            const globalPdfBtn = document.getElementById('global-pdf-btn');
            const weeklyPdfBtn = document.getElementById('weekly-pdf-btn');
            const title = document.getElementById('current-view-title');
            
            grid.innerHTML = '';
            backBtn.classList.add('hidden');
            weeklyPdfBtn.classList.add('hidden');
            globalPdfBtn.classList.remove('hidden');
            title.innerHTML = `<span class="w-2 h-8 bg-[var(--osym-accent)] rounded-full"></span> HaftalÄ±k Plan`;

            weeks.forEach((week, index) => {
                let doneDaysCount = 0;
                week.days.forEach(dIdx => {
                    const isDayDone = rawData[dIdx].every((_, lIdx) => completedLessons[`${dIdx}-${lIdx}`]);
                    if (isDayDone) doneDaysCount++;
                });
                
                const isWeekFullDone = doneDaysCount === week.days.length;
                const isLocked = index > 0 && !isWeekCompleted(index - 1);

                const card = document.createElement('div');
                card.className = `week-card glass-morphism rounded-[2.5rem] p-10 flex flex-col items-center text-center fade-in ${isWeekFullDone ? 'week-done' : ''} ${isLocked ? 'opacity-50 grayscale cursor-not-allowed' : ''}`;
                
                card.onclick = () => {
                    if (isLocked) {
                        const toast = document.getElementById('toast');
                        toast.classList.remove('hidden');
                        toast.querySelector('span').textContent = 'ğŸ”’';
                        document.getElementById('toast-quote').textContent = 'Ã–nceki haftayÄ± tamamlamadan bu haftaya geÃ§emezsin!';
                        toast.classList.add('show');
                        setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.classList.add('hidden'), 700); }, 3000);
                        return;
                    }
                    transitionToView(renderDays, week.id);
                };
                
                card.innerHTML = `
                    <div class="mb-4 bg-white/5 w-16 h-16 rounded-2xl flex items-center justify-center text-3xl">
                        ${isLocked ? 'ğŸ”’' : (isWeekFullDone ? 'ğŸ‘‘' : 'ğŸ“š')}
                    </div>
                    <h4 class="text-xl font-black mb-1 uppercase">${week.title}</h4>
                    <div class="mt-2 bg-blue-500/10 px-4 py-1.5 rounded-full border border-blue-500/20">
                        <span class="text-[10px] font-black ${isWeekFullDone ? 'text-black' : 'text-slate-300'} uppercase">
                            ${doneDaysCount} / ${week.days.length} GÃœN TAMAMLANDI
                        </span>
                    </div>
                `;
                grid.appendChild(card);
            });
            updateTotalProgress();
        }

        function renderDays(weekId) {
            currentWeekId = weekId;
            const grid = document.getElementById('main-grid');
            const backBtn = document.getElementById('back-btn');
            const weeklyPdfBtn = document.getElementById('weekly-pdf-btn');
            const globalPdfBtn = document.getElementById('global-pdf-btn');
            const title = document.getElementById('current-view-title');
            const week = weeks[weekId];
            
            grid.innerHTML = '';
            backBtn.classList.remove('hidden');
            globalPdfBtn.classList.add('hidden');
            weeklyPdfBtn.classList.remove('hidden');
            title.innerHTML = `<span class="w-2 h-8 bg-[var(--osym-accent)] rounded-full"></span> ${week.title} DetayÄ±`;

            week.days.forEach(dayIdx => {
                const isDayDone = rawData[dayIdx].every((_, lIdx) => completedLessons[`${dayIdx}-${lIdx}`]);
                
                let isLocked = false;
                if (dayIdx > 0) {
                    const prevDayIdx = dayIdx - 1;
                    const isPrevDayDone = rawData[prevDayIdx].every((_, lIdx) => completedLessons[`${prevDayIdx}-${lIdx}`]);
                    if (!isPrevDayDone) isLocked = true;
                }

                const containerDiv = document.createElement('div');
                containerDiv.className = 'day-card-container fade-in relative';
                containerDiv.id = `day-container-${dayIdx}`;
                
                let lessonsHtml = rawData[dayIdx].map((lesson, lIdx) => {
                    const key = `${dayIdx}-${lIdx}`;
                    const isDone = completedLessons[key];
                    return `
                        <div class="flex items-center gap-4 p-4 border-b border-white/5 cursor-pointer hover:bg-white/5 transition-all" onclick="toggleLesson('${key}', ${dayIdx}, ${weekId}, event)">
                            <div class="checkbox-container ${isDone ? 'is-checked' : ''}">
                                <div class="checkbox-inner"><div class="checkbox-front"></div><div class="checkbox-back">âœ“</div></div>
                            </div>
                            <span class="text-[13px] font-bold text-slate-300 ${isDone ? 'checked-item' : ''}">${lesson}</span>
                        </div>
                    `;
                }).join('');

                containerDiv.innerHTML = `
                    ${isLocked ? `
                    <div class="absolute inset-0 bg-[#0a0f1c]/80 z-50 flex flex-col items-center justify-center rounded-[2rem] backdrop-blur-sm border border-white/5">
                        <div class="text-4xl mb-2">ğŸ”’</div>
                        <div class="text-xs font-bold text-slate-400 uppercase tracking-widest">Ã–nceki GÃ¼nÃ¼ Tamamla</div>
                    </div>` : ''}
                    <div class="day-card-inner ${isDayDone ? 'is-day-done' : ''}">
                        <div class="day-card-front overflow-hidden">
                            <div class="p-4 bg-white/2 border-b border-white/5 text-center">
                                <span class="text-[9px] font-black uppercase text-[var(--osym-accent)] tracking-widest">${dayIdx + 1}. GÃœN PLANI</span>
                            </div>
                            <div class="flex-grow">${lessonsHtml}</div>
                        </div>
                        <div class="day-card-back p-6 text-center">
                            <div class="text-4xl mb-4">ğŸ¯</div>
                            <h4 class="font-black text-xl uppercase mb-1">GÃœN BÄ°TTÄ°!</h4>
                            <p class="text-[9px] font-bold uppercase opacity-60 mb-6">Hedefe Bir AdÄ±m Daha...</p>
                            <button onclick="reopenDay(${dayIdx}, ${weekId})" class="text-[9px] font-black bg-black/20 text-black px-6 py-2 rounded-xl border border-black/10 uppercase">SÄ±fÄ±rla</button>
                        </div>
                    </div>
                `;
                grid.appendChild(containerDiv);
            });
        }

        function toggleLesson(key, dayIdx, weekId, event) {
            completedLessons[key] = !completedLessons[key];
            localStorage.setItem('kpss_v6_data', JSON.stringify(completedLessons));
            if(window.saveUserData) window.saveUserData();
            
            const checkbox = event.currentTarget.querySelector('.checkbox-container');
            const text = event.currentTarget.querySelector('span');

            if (completedLessons[key]) {
                // Ders tamamlama XP'si (Sadece ilk kez tamamlandÄ±ÄŸÄ±nda verilir)
                if (!xpGrantedItems.has(key)) {
                    addXp(XP_VALUES.LESSON_COMPLETE, "Ders TamamlandÄ±");
                    xpGrantedItems.add(key);
                    localStorage.setItem('kpss_xp_granted_items', JSON.stringify(Array.from(xpGrantedItems)));
                }
                checkbox.classList.add('is-checked');
                text.classList.add('checked-item');
            } else {
                checkbox.classList.remove('is-checked');
                text.classList.remove('checked-item');
            }

            updateLiveMotivation();

            // GÃ¼n tamamlama kontrolÃ¼
            const isDayNowDone = rawData[dayIdx].every((_, lIdx) => completedLessons[`${dayIdx}-${lIdx}`]);
            if (isDayNowDone) { 
                const dayKey = `day-${dayIdx}`;
                // GÃ¼n tamamlama XP'si (Sadece ilk kez tamamlandÄ±ÄŸÄ±nda verilir)
                if (!xpGrantedItems.has(dayKey)) {
                    fireMiniCelebration();
                    addXp(XP_VALUES.DAY_COMPLETE, "GÃ¼n TamamlandÄ±");
                    xpGrantedItems.add(dayKey);
                    localStorage.setItem('kpss_xp_granted_items', JSON.stringify(Array.from(xpGrantedItems)));
                }
                checkVictory();
                const cardInner = event.currentTarget.closest('.day-card-inner');
                if (cardInner && !cardInner.classList.contains('is-day-done')) {
                    cardInner.classList.add('is-day-done');
                }

                // Hafta tamamlama kontrolÃ¼
                const week = weeks.find(w => w.days.includes(dayIdx));
                if (week) {
                    const isWeekDone = week.days.every(d => rawData[d].every((_, lIdx) => completedLessons[`${d}-${lIdx}`]));
                    if (isWeekDone) {
                        const weekKey = `week-${week.id}`;
                        // Hafta tamamlama XP'si (Sadece ilk kez tamamlandÄ±ÄŸÄ±nda verilir)
                        if (!xpGrantedItems.has(weekKey)) {
                            addXp(XP_VALUES.WEEK_COMPLETE, `${week.title} TamamlandÄ±`);
                            xpGrantedItems.add(weekKey);
                            localStorage.setItem('kpss_xp_granted_items', JSON.stringify(Array.from(xpGrantedItems)));
                        }
                    }
                }
            }

            // YENÄ°: Bir sonraki gÃ¼nÃ¼n kilidini anlÄ±k olarak aÃ§/kapa
            const nextDayIdx = dayIdx + 1;
            const nextDayContainer = document.getElementById(`day-container-${nextDayIdx}`);
            if (nextDayContainer) {
                const lockOverlay = nextDayContainer.querySelector('.absolute.z-50');
                if (isDayNowDone) {
                    if (lockOverlay) lockOverlay.remove();
                } else {
                    if (!lockOverlay) {
                        const overlay = document.createElement('div');
                        overlay.className = "absolute inset-0 bg-[#0a0f1c]/80 z-50 flex flex-col items-center justify-center rounded-[2rem] backdrop-blur-sm border border-white/5";
                        overlay.innerHTML = `
                            <div class="text-4xl mb-2">ğŸ”’</div>
                            <div class="text-xs font-bold text-slate-400 uppercase tracking-widest">Ã–nceki GÃ¼nÃ¼ Tamamla</div>
                        `;
                        nextDayContainer.prepend(overlay);
                    }
                }
            }

            updateTotalProgress();
        }

        function reopenDay(dayIdx, weekId) {
            rawData[dayIdx].forEach((_, lIdx) => completedLessons[`${dayIdx}-${lIdx}`] = false);
            localStorage.setItem('kpss_v6_data', JSON.stringify(completedLessons));
            if(window.saveUserData) window.saveUserData();
            renderDays(weekId);
            updateTotalProgress();
        }

        function updateTotalProgress() {
            const total = rawData.flat().length;
            const done = Object.values(completedLessons).filter(v => v).length;
            const percent = Math.round((done / total) * 100) || 0;
            
            document.getElementById('total-percent').textContent = `${percent}%`;
            document.getElementById('total-progress-bar').style.width = `${percent}%`;

            // YENÄ°: Sertifika butonu kontrolÃ¼
            const certBtn = document.getElementById('main-certificate-btn');
            if (percent === 100) {
                certBtn.classList.remove('hidden');
                checkForBadges(); // Program bitince rozet kontrolÃ¼
            } else {
                certBtn.classList.add('hidden');
            }
        }

        function resetAllProgress() {
            // Eski confirm yerine yeni modalÄ± aÃ§Ä±yoruz
            document.getElementById('reset-modal').classList.remove('hidden');
        }

        function closeResetModal() {
            document.getElementById('reset-modal').classList.add('hidden');
        }

        function confirmReset() {
            completedLessons = {};
            localStorage.setItem('kpss_v6_data', JSON.stringify(completedLessons));
            
            // YENÄ°: KazanÄ±lan tÃ¼m XP'leri de sÄ±fÄ±rla
            xpGrantedItems.clear();
            localStorage.removeItem('kpss_xp_granted_items');
            if(window.saveUserData) window.saveUserData();

            renderWeeks();
            updateTotalProgress();
            document.getElementById('victory-overlay').classList.add('hidden');
            closeResetModal();
        }

        function fireMiniCelebration() {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.7 } });
            const toast = document.getElementById('toast');
            toast.classList.remove('hidden');
            document.getElementById('toast-quote').textContent = motivasyonSozleri[Math.floor(Math.random() * motivasyonSozleri.length)];
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.classList.add('hidden'), 700); }, 3000);
        }

        function showVictoryOverlay() {
            const userName = localStorage.getItem('kpss_user_name') || 'GeleceÄŸin Memuru';
            document.getElementById('cert-user-name').innerText = userName;
            document.getElementById('cert-date').textContent = new Date().toLocaleDateString('tr-TR');
            document.getElementById('victory-overlay').classList.remove('hidden');
        }

        function checkVictory() {
            const total = rawData.flat().length;
            const done = Object.values(completedLessons).filter(v => v).length;
            if (done === total && total > 0) {
                const programKey = 'program_complete_xp';
                // Program tamamlama XP'si (Sadece ilk kez)
                if (!xpGrantedItems.has(programKey)) {
                    addXp(XP_VALUES.PROGRAM_COMPLETE, "Program TamamlandÄ±!");
                    xpGrantedItems.add(programKey);
                    localStorage.setItem('kpss_xp_granted_items', JSON.stringify(Array.from(xpGrantedItems)));
                    showVictoryOverlay();
                }
            }
        }

        function downloadCertificate(event) {
            const userName = localStorage.getItem('kpss_user_name') || "GELECEÄÄ°N MEMURU";

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4');
            const w = 297; const h = 210;
            
            // Ã‡erÃ§eve
            doc.setFillColor(255, 253, 249);
            doc.rect(0, 0, w, h, 'F');
            
            doc.setDrawColor(180, 83, 9);
            doc.setLineWidth(1.5);
            doc.rect(10, 10, w - 20, h - 20);
            doc.setLineWidth(0.5);
            doc.rect(12, 12, w - 24, h - 24);

            // KÃ¶ÅŸe SÃ¼sleri (Basit Ã‡izgiler)
            doc.setLineWidth(2);
            doc.line(10, 10, 30, 10); doc.line(10, 10, 10, 30); // Sol Ãœst
            doc.line(w-10, 10, w-30, 10); doc.line(w-10, 10, w-10, 30); // SaÄŸ Ãœst
            doc.line(10, h-10, 30, h-10); doc.line(10, h-10, 10, h-30); // Sol Alt
            doc.line(w-10, h-10, w-30, h-10); doc.line(w-10, h-10, w-10, h-30); // SaÄŸ Alt

            doc.setTextColor(180, 83, 9);
            doc.setFont("helvetica", "bold");
            doc.setFontSize(10);
            doc.text("KPSS CALISMA PROGRAMI", w/2, 30, { align: "center" });


            doc.setTextColor(26, 32, 44);
            doc.setFontSize(42);
            doc.text("Ustun Basari Belgesi", w/2, 50, { align: "center" });

            doc.setTextColor(100, 116, 139);
            doc.setFont("helvetica", "italic");
            doc.setFontSize(12);
            doc.text("Bu belge, gosterdigi azim ve kararlilikla programi tamamlayan", w/2, 65, { align: "center" });

            doc.setTextColor(0, 0, 0);
            doc.setFont("helvetica", "bold");
            doc.setFontSize(30);
            doc.text(cleanTurkish(userName).toUpperCase(), w/2, 85, { align: "center" });
            
            doc.setDrawColor(200, 200, 200);
            doc.setLineWidth(0.5);
            doc.line(w/2 - 60, 90, w/2 + 60, 90);

            doc.setTextColor(50, 50, 50);
            doc.setFont("helvetica", "normal");
            doc.setFontSize(10);
            doc.text(cleanTurkish("HaftalÄ±k Ã§alÄ±ÅŸma disiplinini bozmadan tÃ¼m konularÄ± baÅŸarÄ±yla bitirmiÅŸ"), w/2, 100, { align: "center" });
            doc.text(cleanTurkish("ve hedefine giden yolda sarsÄ±lmaz bir irade gÃ¶stermiÅŸtir."), w/2, 106, { align: "center" });

            // --- Ä°STATÄ°STÄ°K KUTULARI (YENÄ°) ---
            const boxY = 120;
            const boxW = 50;
            const boxH = 25;
            const gap = 15;
            const startX = (w - (3 * boxW + 2 * gap)) / 2;

            function drawStatBox(x, label, value) {
                doc.setDrawColor(220, 220, 220);
                doc.setFillColor(252, 252, 252);
                doc.roundedRect(x, boxY, boxW, boxH, 3, 3, 'FD');
                
                doc.setFontSize(14);
                doc.setTextColor(180, 83, 9); // Amber
                doc.setFont("helvetica", "bold");
                doc.text(value.toString(), x + boxW/2, boxY + 11, { align: "center" });
                
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.setFont("helvetica", "normal");
                doc.text(cleanTurkish(label), x + boxW/2, boxY + 19, { align: "center" });
            }

            drawStatBox(startX, "COZULEN SORU", totalQuestions);
            drawStatBox(startX + boxW + gap, "POMODORO", totalPomodoro);
            drawStatBox(startX + 2 * (boxW + gap), "GUN ZINCIRI", currentStreak);

            doc.setFontSize(9);
            doc.setTextColor(50, 50, 50);
            doc.text("Tarih: " + new Date().toLocaleDateString('tr-TR'), 40, 175);
            
            doc.setDrawColor(180, 83, 9);
            doc.setFillColor(180, 83, 9);
            doc.circle(w - 50, 170, 14, 'F');
            doc.setDrawColor(255, 255, 255);
            doc.setLineWidth(0.5);
            doc.circle(w - 50, 170, 12, 'S');

            doc.setTextColor(255, 255, 255);
            doc.setFontSize(8);
            doc.setFont("helvetica", "bold");
            doc.text("RESMI", w - 50, 168, { align: "center" });
            doc.text("ONAY", w - 50, 173, { align: "center" });

            // Branding & Disclaimer (PDF Alt Bilgi)
           doc.setTextColor(150, 150, 150);
            doc.setFont("helvetica", "normal");
            doc.setFontSize(8);
            doc.text(cleanTurkish("GeliÅŸtirici: BAÅARAN TechZone"), w/2, 195, { align: "center" });
            doc.setFontSize(7);
            doc.setFontSize(6); 
            doc.text(cleanTurkish("Bu belge resmi deÄŸildir. Ã–SYM ile iliÅŸkisi yoktur. Resmi iÅŸlemler iÃ§in www.osym.gov.tr adresini ziyaret ediniz."), w/2, 205, { align: "center" });

            doc.save("KPSS_Basari_Belgesi.pdf");
        }

        document.getElementById('download-certificate-button').addEventListener('click', downloadCertificate);


        function downloadProgramPDF(mode) {
            const doc = new jsPDF('p', 'mm', 'a4');
            doc.setFillColor(10, 15, 28);
            doc.rect(0, 0, 210, 40, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFont("helvetica", "bold");
            doc.setFontSize(18);
            const mainTitle = mode === 'global' ? "KPSS MUFREDAT PLANI" : `KPSS ${weeks[currentWeekId].title} PLANI`;
            doc.text(cleanTurkish(mainTitle), 105, 22, { align: "center" });

            const body = [];
            const activeWeeks = mode === 'global' ? weeks : [weeks[currentWeekId]];
            activeWeeks.forEach(w => {
                body.push([{ content: cleanTurkish(w.title), colSpan: 2, styles: { fillColor: [240, 240, 240], fontStyle: 'bold', halign: 'center' } }]);
                w.days.forEach(dIdx => {
                    body.push([cleanTurkish(`${dIdx + 1}. GUN`), cleanTurkish(rawData[dIdx].join(" - "))]);
                });
            });

            doc.autoTable({
                startY: 45,
                head: [[cleanTurkish('ZAMAN'), cleanTurkish('KONULAR')]],
                body: body,
                theme: 'grid',
                headStyles: { fillColor: [59, 130, 246] }
            });
            doc.save("KPSS_Program.pdf");
        }

        let timer, timeLeft = 1500, totalTime = 1500, isRunning = false;
        function updateTimerDisplay() {
            const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
            const s = (timeLeft % 60).toString().padStart(2, '0');
            document.getElementById('timer-display').textContent = `${m}:${s}`;
            document.getElementById('timer-path').style.strokeDashoffset = 527.7 - (timeLeft / totalTime) * 527.7;
        }
        function startTimer() {
            if (isRunning) return;
            totalTime = (parseInt(document.getElementById('timer-input').value) || 25) * 60;
            if (timeLeft <= 0 || timeLeft > totalTime) timeLeft = totalTime;
            isRunning = true;
            document.getElementById('start-btn').classList.add('hidden');
            document.getElementById('pause-btn').classList.remove('hidden');
            timer = setInterval(() => { if (timeLeft > 0) { timeLeft--; updateTimerDisplay(); } else { clearInterval(timer); completePomodoro(); } }, 1000);
        }
        function pauseTimer() { clearInterval(timer); isRunning = false; document.getElementById('start-btn').classList.remove('hidden'); document.getElementById('pause-btn').classList.add('hidden'); }
        function resetTimer() { pauseTimer(); timeLeft = (parseInt(document.getElementById('timer-input').value) || 25) * 60; updateTimerDisplay(); }

        // --- YENÄ°: ODAKLANMA SESLERÄ° ---
        const sounds = {
            rain: new Audio('https://actions.google.com/sounds/v1/weather/rain_heavy_loud.ogg'),
            cafe: new Audio('https://actions.google.com/sounds/v1/ambiences/coffee_shop.ogg')
        };
        // Sesleri dÃ¶ngÃ¼ye al (bitince baÅŸa sarar)
        Object.values(sounds).forEach(s => {
            s.loop = true;
            s.volume = 0.5; // VarsayÄ±lan ses seviyesi %50
            s.preload = 'auto';
            s.onerror = () => console.log("Ses yÃ¼klenirken hata oluÅŸtu.");
        });

        function adjustVolume(val) {
            Object.values(sounds).forEach(s => s.volume = val);
        }

        function toggleSound(type) {
            const audio = sounds[type];
            const btn = document.getElementById(`btn-${type}`);
            const isPlaying = !btn.classList.contains('bg-[var(--osym-dark)]'); // Butonun renginden durumu anla
            
            if (!isPlaying) {
                // Ã‡almaya BaÅŸlat
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log("Ses Ã§alma hatasÄ±:", error);
                        // Hata olursa butonu geri kapat
                        btn.classList.add('bg-[var(--osym-dark)]', 'text-slate-400');
                        btn.classList.remove('bg-blue-600', 'text-white', 'border-blue-400', 'shadow-lg', 'shadow-blue-900/50');
                    });
                }
                btn.classList.remove('bg-[var(--osym-dark)]', 'text-slate-400');
                btn.classList.add('bg-blue-600', 'text-white', 'border-blue-400', 'shadow-lg', 'shadow-blue-900/50');
            } else {
                // Durdur
                audio.pause();
                btn.classList.add('bg-[var(--osym-dark)]', 'text-slate-400');
                btn.classList.remove('bg-blue-600', 'text-white', 'border-blue-400', 'shadow-lg', 'shadow-blue-900/50');
            }
        }

        // --- YENÄ°: GERÄ° SAYIM FONKSÄ°YONLARI ---
        // Tahmini 2026 Tarihleri (Resmi takvim aÃ§Ä±klanÄ±nca gÃ¼ncellenebilir)
        const exams = [
            { id: 'cd-lisans', date: '2026-09-06T10:15:00' }, 
            { id: 'cd-onlisans', date: '2026-10-04T10:15:00' }, 
            { id: 'cd-ortaogretim', date: '2026-10-25T10:15:00' } 
        ];

        function updateCountdown() {
            const now = new Date();
            
            exams.forEach(exam => {
                const target = new Date(exam.date);
                const diff = target - now;
                const el = document.getElementById(exam.id);
                
                if (diff <= 0) {
                    el.innerHTML = '<span class="text-red-500 font-bold">SINAV GÃœNÃœ!</span>';
                    return;
                }

                const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((diff % (1000 * 60)) / 1000);

                el.innerHTML = `
                    <div class="flex flex-col"><span class="text-xl md:text-2xl font-black tracking-tighter tabular-nums">${d}</span><span class="text-[8px] text-slate-500 font-bold">GÃœN</span></div>
                    <span class="text-xl text-slate-600 font-light">:</span>
                    <div class="flex flex-col"><span class="text-xl md:text-2xl font-black tracking-tighter tabular-nums">${h}</span><span class="text-[8px] text-slate-500 font-bold">SA</span></div>
                    <span class="text-xl text-slate-600 font-light">:</span>
                    <div class="flex flex-col"><span class="text-xl md:text-2xl font-black tracking-tighter tabular-nums">${m}</span><span class="text-[8px] text-slate-500 font-bold">DK</span></div>
                    <span class="text-xl text-slate-600 font-light">:</span>
                    <div class="flex flex-col"><span class="text-xl md:text-2xl font-black tracking-tighter tabular-nums text-blue-400">${s}</span><span class="text-[8px] text-slate-500 font-bold">SN</span></div>
                `;
            });
        }

        // --- YENÄ°: DENEME TAKÄ°P FONKSÄ°YONLARI ---
        let examHistory = JSON.parse(localStorage.getItem('kpss_exam_history')) || [];

        function calculateAndSaveScore() {
            const type = document.getElementById('exam-type').value;
            
            // DetaylÄ± Netleri Al
            const turkce = parseFloat(document.getElementById('net-turkce').value) || 0;
            const mat = parseFloat(document.getElementById('net-mat').value) || 0;
            const tarih = parseFloat(document.getElementById('net-tarih').value) || 0;
            const cog = parseFloat(document.getElementById('net-cog').value) || 0;
            const vat = parseFloat(document.getElementById('net-vat').value) || 0;

            const gy = turkce + mat;
            const gk = tarih + cog + vat;
            
            if(gy > 60 || gk > 60) { alert('Net sayÄ±sÄ± 60\'tan bÃ¼yÃ¼k olamaz!'); return; }

            let score = 0;
            let typeLabel = "";

            // EÄŸer toplam net 1'den kÃ¼Ã§Ã¼kse puan hesaplanmaz (Ã–SYM kuralÄ± benzeri)
            if ((gy + gk) < 1) {
                score = 0;
            } else {
                if(type === 'lisans') {
                    score = 55 + (gy * 0.4) + (gk * 0.5); // Lisans P3 YaklaÅŸÄ±k
                    typeLabel = "LÄ°SANS (P3)";
                } else if(type === 'onlisans') {
                    score = 58 + (gy * 0.4) + (gk * 0.5); // Ã–nlisans P93 YaklaÅŸÄ±k
                    typeLabel = "Ã–NLÄ°SANS (P93)";
                } else {
                    score = 60 + (gy * 0.4) + (gk * 0.5); // OrtaÃ¶ÄŸretim P94 YaklaÅŸÄ±k
                    typeLabel = "ORTAÃ–ÄRETÄ°M (P94)";
                }
            }
            
            if(score > 100) score = 100;
            
            const newExam = {
                id: Date.now(),
                date: new Date().toLocaleDateString('tr-TR'),
                type: typeLabel,
                gy: gy,
                gk: gk,
                score: score.toFixed(2)
            };

            examHistory.unshift(newExam); // En baÅŸa ekle
            localStorage.setItem('kpss_exam_history', JSON.stringify(examHistory));
            if(window.saveUserData) window.saveUserData();
            
            document.getElementById('calc-score-result').innerText = score.toFixed(2);
            document.getElementById('last-score-display').classList.remove('hidden');
            
            renderExamHistory();
            renderChart(); // GrafiÄŸi gÃ¼ncelle
            addXp(XP_VALUES.ADD_TRIAL, "Deneme Kaydedildi");
            
            // InputlarÄ± temizle
            document.getElementById('net-turkce').value = '';
            document.getElementById('net-mat').value = '';
            document.getElementById('net-tarih').value = '';
            document.getElementById('net-cog').value = '';
            document.getElementById('net-vat').value = '';
        }

        function renderExamHistory() {
            const list = document.getElementById('exam-history-list');
            if (examHistory.length === 0) {
                list.innerHTML = '<div class="text-center text-slate-600 text-xs py-8">HenÃ¼z deneme kaydÄ± yok.</div>';
                return;
            }

            list.innerHTML = examHistory.map(exam => `
                <div class="flex items-center justify-between bg-[var(--osym-card)] p-3 rounded-xl border border-white/5 group">
                    <div>
                        <div class="text-[9px] text-slate-500 font-bold">${exam.date} <span class="text-blue-400 ml-1">${exam.type || 'LÄ°SANS (P3)'}</span></div>
                        <div class="text-xs font-bold text-white">GY: ${exam.gy} | GK: ${exam.gk}</div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="text-amber-500 font-black text-sm">${exam.score}</span>
                        <button onclick="deleteExam(${exam.id})" class="text-slate-600 hover:text-red-500 transition-colors text-xs">âœ•</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteExam(id) {
            examHistory = examHistory.filter(e => e.id !== id);
            localStorage.setItem('kpss_exam_history', JSON.stringify(examHistory));
            if(window.saveUserData) window.saveUserData();
            renderExamHistory();
            renderChart(); // GrafiÄŸi gÃ¼ncelle
        }

        // --- YENÄ°: YAPILACAKLAR LÄ°STESÄ° FONKSÄ°YONLARI ---
        let todos = JSON.parse(localStorage.getItem('kpss_todos')) || [];

        function renderTodos() {
            const list = document.getElementById('todo-list');
            list.innerHTML = '';
            if (todos.length === 0) {
                list.innerHTML = '<div class="text-center text-slate-500 text-xs italic py-4">HenÃ¼z eklenmiÅŸ bir gÃ¶rev yok.</div>';
                return;
            }
            todos.forEach((todo, index) => {
                list.innerHTML += `
                    <div class="flex items-center justify-between bg-[var(--osym-card)] p-4 rounded-xl border border-white/5 group transition-all hover:border-emerald-500/30">
                        <div class="flex items-center gap-4 cursor-pointer flex-1" onclick="toggleTodo(${index})">
                            <div class="w-6 h-6 rounded-lg border-2 flex-shrink-0 flex items-center justify-center transition-colors ${todo.completed ? 'bg-emerald-500 border-emerald-500' : 'border-slate-600'}">
                                ${todo.completed ? '<span class="text-black font-bold text-xs">âœ“</span>' : ''}
                            </div>
                            <span class="text-sm font-bold ${todo.completed ? 'text-slate-500 line-through' : 'text-white'} break-all">${todo.text}</span>
                        </div>
                        <button onclick="deleteTodo(${index})" class="text-slate-600 hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100 px-2">ğŸ—‘ï¸</button>
                    </div>
                `;
            });
        }

        function addTodo() {
            const input = document.getElementById('todo-input');
            const text = input.value.trim();
            if (!text) return;
            // Her gÃ¶reve benzersiz bir ID ekle
            todos.unshift({ id: `todo_${Date.now()}`, text, completed: false });
            localStorage.setItem('kpss_todos', JSON.stringify(todos));
            if(window.saveUserData) window.saveUserData();
            input.value = '';
            renderTodos();
            addXp(XP_VALUES.ADD_TODO, "Yeni GÃ¶rev Eklendi");
        }

        function toggleTodo(index) {
            const todo = todos[index];
            // Eski gÃ¶revlere ID ata (eÄŸer yoksa)
            if (!todo.id) {
                todo.id = `todo_${Date.now()}_${index}`;
            }
            todo.completed = !todo.completed;
            
            // GÃ¶rev tamamlama XP'si (Sadece ilk kez)
            if (todo.completed) {
                if (!xpGrantedItems.has(todo.id)) {
                    addXp(XP_VALUES.COMPLETE_TODO, "GÃ¶rev TamamlandÄ±");
                    xpGrantedItems.add(todo.id);
                    localStorage.setItem('kpss_xp_granted_items', JSON.stringify(Array.from(xpGrantedItems)));
                }
            }
            localStorage.setItem('kpss_todos', JSON.stringify(todos));
            if(window.saveUserData) window.saveUserData();
            renderTodos();
        }

        function deleteTodo(index) {
            todos.splice(index, 1);
            localStorage.setItem('kpss_todos', JSON.stringify(todos));
            if(window.saveUserData) window.saveUserData();
            renderTodos();
        }

        // --- YENÄ°: GÃœNLÃœK PERFORMANS FONKSÄ°YONLARI ---
        let qTarget = parseInt(localStorage.getItem('kpss_q_target')) || 200;
        let qCurrent = parseInt(localStorage.getItem('kpss_q_current')) || 0;
        let lastQDate = localStorage.getItem('kpss_q_date');

        function initDailyPerformance() {
            const today = new Date().toLocaleDateString('tr-TR');
            // EÄŸer gÃ¼n deÄŸiÅŸtiyse sayacÄ± sÄ±fÄ±rla
            if (lastQDate !== today) {
                qCurrent = 0;
                localStorage.setItem('kpss_q_current', 0);
                localStorage.setItem('kpss_q_date', today);
            }
            
            document.getElementById('quick-notes').value = localStorage.getItem('kpss_quick_notes') || '';
            updateQuestionUI();
        }

        function updateQuestionUI() {
            document.getElementById('q-current').innerText = qCurrent;
            document.getElementById('q-target').innerText = qTarget;
            const percent = Math.min(100, Math.round((qCurrent / qTarget) * 100));
            document.getElementById('q-progress').style.width = `${percent}%`;
        }

        function addQuestions(amount) {
            const wasBelow = qCurrent < qTarget;
            qCurrent += amount;
            localStorage.setItem('kpss_q_current', qCurrent);

            let totalQSoved = parseInt(localStorage.getItem('kpss_total_q_solved')) || 0;
            totalQSoved += amount;
            localStorage.setItem('kpss_total_q_solved', totalQSoved);
            if(window.saveUserData) window.saveUserData();
            addXp(XP_VALUES.QUESTION * amount, `${amount} Soru Ã‡Ã¶zÃ¼ldÃ¼`);

            localStorage.setItem('kpss_q_date', new Date().toLocaleDateString('tr-TR'));
            updateQuestionUI();
            checkAndSaveStreak(); // Streak kontrolÃ¼

            if (wasBelow && qCurrent >= qTarget) {
                fireDailyGoalCelebration();
            }
        }

        function openDailyResetModal() {
            document.getElementById('daily-reset-modal').classList.remove('hidden');
        }

        function closeDailyResetModal() {
            document.getElementById('daily-reset-modal').classList.add('hidden');
        }

        function confirmDailyReset() {
            qCurrent = 0;
            localStorage.setItem('kpss_q_current', 0);
            if(window.saveUserData) window.saveUserData();
            updateQuestionUI();
            closeDailyResetModal();
        }

        function openTargetModal() {
            document.getElementById('target-input-modal').value = qTarget;
            document.getElementById('target-modal').classList.remove('hidden');
        }

        function closeTargetModal() {
            document.getElementById('target-modal').classList.add('hidden');
        }

        function saveTarget() {
            const val = document.getElementById('target-input-modal').value;
            if(val && !isNaN(val)) {
                qTarget = parseInt(val);
                localStorage.setItem('kpss_q_target', qTarget);
                if(window.saveUserData) window.saveUserData();
                updateQuestionUI();
                closeTargetModal();
            }
        }

        function fireDailyGoalCelebration() {
            document.getElementById('daily-goal-modal').classList.remove('hidden');
            confetti({
                particleCount: 200,
                spread: 100,
                origin: { y: 0.6 },
                colors: ['#a855f7', '#3b82f6', '#ffffff']
            });
        }

        function closeDailyGoalModal() {
            document.getElementById('daily-goal-modal').classList.add('hidden');
        }

        function saveQuickNotes() {
            const val = document.getElementById('quick-notes').value;
            localStorage.setItem('kpss_quick_notes', val);
            if(window.saveUserData) window.saveUserData();
        }

        // --- YENÄ°: ZÄ°NCÄ°RÄ° KIRMA (STREAK) FONKSÄ°YONLARI ---
        let streakLog = JSON.parse(localStorage.getItem('kpss_streak_log')) || [];

        function checkAndSaveStreak() {
            const today = new Date().toLocaleDateString('tr-TR');
            if (qCurrent >= qTarget) {
                if (!streakLog.includes(today)) {
                    streakLog.push(today);
                    addXp(XP_VALUES.STREAK_DAY, "GÃ¼nlÃ¼k Hedef Serisi");
                    localStorage.setItem('kpss_streak_log', JSON.stringify(streakLog));
                    if(window.saveUserData) window.saveUserData();
                    renderStreak();
                }
            }
        }

        function renderStreak() {
            const container = document.getElementById('streak-container');
            container.innerHTML = '';
            
            const days = ['Paz', 'Pzt', 'Sal', 'Ã‡ar', 'Per', 'Cum', 'Cmt'];
            
            // Son 7 gÃ¼nÃ¼ oluÅŸtur
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const dateStr = d.toLocaleDateString('tr-TR');
                const dayName = days[d.getDay()];
                const isDone = streakLog.includes(dateStr);
                const isToday = i === 0;

                container.innerHTML += `
                    <div class="flex flex-col items-center gap-2">
                        <div class="w-full aspect-square rounded-xl flex items-center justify-center text-sm md:text-base font-black border transition-all ${isDone ? 'bg-rose-600 border-rose-500 text-white shadow-[0_0_10px_rgba(225,29,72,0.4)]' : 'bg-[var(--osym-card)] border-white/5 text-slate-600'} ${isToday ? 'ring-1 ring-white/30' : ''}">
                            ${isDone ? 'âœ“' : ''}
                        </div>
                        <span class="text-[9px] font-bold uppercase ${isToday ? 'text-white' : 'text-slate-500'}">${dayName}</span>
                    </div>
                `;
            }
        }

        // --- YENÄ°: OYUNLAÅTIRMA SÄ°STEMÄ° ---

        let gamificationData = { xp: 0, level: 1, badges: [] };
        let xpGrantedItems = new Set(); // YENÄ°: XP kazanÄ±lan Ã¶ÄŸeleri takip etmek iÃ§in

        const XP_VALUES = {
            LESSON_COMPLETE: 10,
            DAY_COMPLETE: 150,
            WEEK_COMPLETE: 1000,
            POMODORO_SESSION: 50,
            QUESTION: 0.5,
            ADD_TRIAL: 250,
            ADD_TODO: 5,
            COMPLETE_TODO: 20,
            STREAK_DAY: 100,
            PROGRAM_COMPLETE: 10000
        };

        const getXpForLevel = (level) => Math.floor(1000 * Math.pow(level, 1.5));

        const RANKS = [
            { level: 1, title: "Ã‡aylak Memur", icon: "ğŸ”°", color: "text-slate-400" },
            { level: 5, title: "Stajyer Memur", icon: "ğŸ§‘â€ğŸ’»", color: "text-sky-400" },
            { level: 10, title: "Memur", icon: "ğŸ‘¤", color: "text-blue-400" },
            { level: 15, title: "KÄ±demli Memur", icon: "ğŸ‘”", color: "text-emerald-400" },
            { level: 20, title: "Uzman", icon: "ğŸ§‘â€ğŸ«", color: "text-purple-400" },
            { level: 30, title: "Åef", icon: "ğŸ‘‘", color: "text-pink-400" },
            { level: 40, title: "MÃ¼dÃ¼r YardÄ±mcÄ±sÄ±", icon: "â­", color: "text-amber-400" },
            { level: 50, title: "Daire BaÅŸkanÄ±", icon: "ğŸ†", color: "text-yellow-400" }
        ];

        const BADGES = {
            'pomodoro_10': { name: 'Odak UstasÄ±', desc: '10 Pomodoro oturumu tamamla.', icon: 'ğŸ…', criteria: () => pomoStats.sessions >= 10 },
            'pomodoro_50': { name: 'Pomodoro CanavarÄ±', desc: '50 Pomodoro oturumu tamamla.', icon: 'ğŸ‘¹', criteria: () => pomoStats.sessions >= 50 },
            'streak_7': { name: 'Zincir KÄ±rmayan', desc: '7 gÃ¼n Ã¼st Ã¼ste hedefini tamamla.', icon: 'ğŸ”¥', criteria: () => calculateCurrentStreak() >= 7 },
            'streak_30': { name: 'Ä°stikrar Abidesi', desc: '30 gÃ¼n Ã¼st Ã¼ste hedefini tamamla.', icon: 'ğŸ›ï¸', criteria: () => calculateCurrentStreak() >= 30 },
            'questions_1000': { name: 'Soru AvcÄ±sÄ±', desc: 'Toplam 1000 soru Ã§Ã¶z.', icon: 'ğŸ¯', criteria: () => (parseInt(localStorage.getItem('kpss_total_q_solved')) || 0) >= 1000 },
            'questions_10000': { name: 'Soru Ä°mparatoru', desc: 'Toplam 10.000 soru Ã§Ã¶z.', icon: 'ğŸ‘‘', criteria: () => (parseInt(localStorage.getItem('kpss_total_q_solved')) || 0) >= 10000 },
            'trials_5': { name: 'Deneme AslanÄ±', desc: '5 deneme sonucunu kaydet.', icon: 'ğŸ¦', criteria: () => examHistory.length >= 5 },
            'trials_20': { name: 'Deneme ProfesÃ¶rÃ¼', desc: '20 deneme sonucunu kaydet.', icon: 'ğŸ§‘â€ğŸ«', criteria: () => examHistory.length >= 20 },
            'program_half': { name: 'Yolun YarÄ±sÄ±', desc: 'Ders programÄ±nÄ±n %50\'sini tamamla.', icon: 'ğŸŒ—', criteria: () => getTotalProgressPercent() >= 50 },
            'program_complete': { name: 'Zafere UlaÅŸan', desc: 'Ders programÄ±nÄ±n tamamÄ±nÄ± bitir.', icon: 'ğŸ†', criteria: () => getTotalProgressPercent() >= 100 },
            'first_day': { name: 'Ä°lk AdÄ±m', desc: 'Programdaki ilk gÃ¼nÃ¼nÃ¼ tamamla.', icon: 'ğŸ‘Ÿ', criteria: () => Object.values(completedLessons).filter(v => v).length > 0 },
        };

        function initGamification() {
            const savedData = JSON.parse(localStorage.getItem('kpss_gamification_data'));
            if (savedData) gamificationData = savedData;

            // YENÄ°: XP kazanÄ±lan Ã¶ÄŸeleri yÃ¼kle
            const savedXpItems = JSON.parse(localStorage.getItem('kpss_xp_granted_items'));
            if (savedXpItems && Array.isArray(savedXpItems)) {
                xpGrantedItems = new Set(savedXpItems);
            }

            if (!localStorage.getItem('kpss_total_q_solved')) localStorage.setItem('kpss_total_q_solved', '0');
            updateGamificationUI();
            renderBadges();
        }

        function saveGamificationData() { 
            localStorage.setItem('kpss_gamification_data', JSON.stringify(gamificationData));
            if(window.saveUserData) window.saveUserData();
        }

        function addXp(amount, reason) {
            if (!amount || amount <= 0) return;
            gamificationData.xp += amount;
            showXpToast(amount, reason);
            updateGamificationUI();
            checkForLevelUp();
            checkForBadges();
            saveGamificationData();
        }

        function showXpToast(amount, reason) {
            const toast = document.getElementById('xp-toast');
            document.getElementById('xp-toast-amount').innerText = `+${Math.round(amount)} XP`;
            document.getElementById('xp-toast-reason').innerText = reason;
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 2500);
        }

        function updateGamificationUI() {
            const { level, xp } = gamificationData;
            const xpForNext = getXpForLevel(level);
            const xpForCurrent = level > 1 ? getXpForLevel(level - 1) : 0;
            const levelXp = xp - xpForCurrent;
            const requiredXp = xpForNext - xpForCurrent;
            const percentage = Math.min(100, (levelXp / requiredXp) * 100);

            document.getElementById('level-display').innerText = level;
            document.getElementById('xp-bar').style.width = `${percentage}%`;
            document.getElementById('xp-text').innerText = `${Math.round(levelXp)} / ${Math.round(requiredXp)} XP`;
            const currentRank = RANKS.slice().reverse().find(r => level >= r.level) || RANKS[0];
            
            // YENÄ°: RÃ¼tbe rengini ve ikonunu gÃ¼ncelle
            const rankTitleEl = document.getElementById('rank-title');
            rankTitleEl.innerHTML = `<span class="mr-2">${currentRank.icon}</span> <span>${currentRank.title}</span>`;
            RANKS.forEach(r => rankTitleEl.classList.remove(r.color));
            rankTitleEl.classList.remove('text-amber-400'); // varsayÄ±lan rengi de kaldÄ±r
            rankTitleEl.classList.add(currentRank.color);
        }

        function checkForLevelUp() {
            if (gamificationData.xp >= getXpForLevel(gamificationData.level)) {
                gamificationData.level++;
                const newRank = RANKS.find(r => gamificationData.level === r.level);
                showLevelUpModal(gamificationData.level, newRank);
                checkForLevelUp();
            }
        }

        function showLevelUpModal(newLevel, newRank) {
            document.getElementById('level-up-rank').innerText = `Seviye ${newLevel}'e YÃ¼kseldin!`;
            if (newRank) {
                document.getElementById('level-up-rank').innerHTML = `Yeni RÃ¼tbe: <span class="ml-2">${newRank.icon}</span> ${newRank.title}`;
            }
            document.getElementById('level-up-modal').classList.remove('hidden');
            confetti({ particleCount: 300, spread: 150, origin: { y: 0.6 }, colors: ['#f59e0b', '#fbbf24', '#ffffff'] });
        }

        function closeLevelUpModal() { document.getElementById('level-up-modal').classList.add('hidden'); updateGamificationUI(); }
        function closeBadgeModal() { document.getElementById('badge-unlocked-modal').classList.add('hidden'); }

        // YENÄ°: BaÅŸarÄ±m ModalÄ± FonksiyonlarÄ±
        function openAchievementsModal() {
            // Ä°lerleme Ã§ubuÄŸunu hesapla ve gÃ¼ncelle
            const unlockedCount = gamificationData.badges.length;
            const totalCount = Object.keys(BADGES).length;
            const percentage = totalCount > 0 ? Math.round((unlockedCount / totalCount) * 100) : 0;

            document.getElementById('badge-progress-text').innerText = `${unlockedCount}/${totalCount} (${percentage}%)`;
            document.getElementById('badge-progress-bar').style.width = `${percentage}%`;

            document.getElementById('achievements-modal').classList.remove('hidden'); 
        }
        function closeAchievementsModal() { document.getElementById('achievements-modal').classList.add('hidden'); }

        function toggleBadgeHint(btn, text) {
            const p = btn.parentElement.querySelector('.badge-desc');
            if (p.innerText === text) {
                p.innerText = 'Kilitli. Ä°pucu iÃ§in ? butonuna tÄ±kla.';
                btn.classList.remove('bg-amber-500', 'text-black');
                btn.classList.add('bg-white/10', 'text-white');
            } else {
                p.innerText = text;
                btn.classList.remove('bg-white/10', 'text-white');
                btn.classList.add('bg-amber-500', 'text-black');
            }
        }

        function renderBadges() {
            const container = document.getElementById('badges-container');
            container.innerHTML = '';
            for (const id in BADGES) {
                const badge = BADGES[id];
                const unlocked = gamificationData.badges.includes(id);
                
                const safeDesc = badge.desc.replace(/'/g, "\\'");
                const hintBtn = !unlocked ? `<button onclick="toggleBadgeHint(this, '${safeDesc}')" class="absolute top-2 right-2 w-6 h-6 rounded-full bg-white/10 hover:bg-amber-500 hover:text-black flex items-center justify-center transition-all text-[10px] font-bold z-20">?</button>` : '';
                const descText = unlocked ? badge.desc : 'Kilitli. Ä°pucu iÃ§in ? butonuna tÄ±kla.';

                container.innerHTML += `
                    <div class="badge-card ${unlocked ? '' : 'locked'} relative">
                        ${hintBtn}
                        <div class="badge-icon">${unlocked ? badge.icon : 'â“'}</div>
                        <div class="badge-name">${badge.name}</div>
                        <p class="badge-desc">${descText}</p>
                    </div>
                `;
            }
        }

        function checkForBadges() {
            for (const id in BADGES) {
                if (!gamificationData.badges.includes(id) && BADGES[id].criteria()) {
                    gamificationData.badges.push(id);
                    saveGamificationData();
                    showBadgeModal(id);
                    renderBadges();
                }
            }
        }

        function showBadgeModal(id) {
            const badge = BADGES[id];
            document.getElementById('badge-modal-icon').innerText = badge.icon;
            document.getElementById('badge-modal-name').innerText = badge.name;
            document.getElementById('badge-modal-desc').innerText = badge.desc;
            document.getElementById('badge-unlocked-modal').classList.remove('hidden');
            confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 }, colors: ['#22c55e', '#10b981', '#ffffff'] });
        }

        function getTotalProgressPercent() {
            const total = rawData.flat().length;
            const done = Object.values(completedLessons).filter(v => v).length;
            return Math.round((done / total) * 100) || 0;
        }

        function calculateCurrentStreak() {
            if (streakLog.length === 0) return 0;
            let streak = 0;
            const sortedLog = streakLog.map(d => { const p = d.split('.'); return new Date(p[2], p[1] - 1, p[0]); }).sort((a, b) => b - a);
            const oneDay = 24 * 60 * 60 * 1000;
            const today = new Date(); today.setHours(0,0,0,0);
            if (Math.round(Math.abs((today - sortedLog[0]) / oneDay)) <= 1) {
                streak = 1;
                for (let i = 0; i < sortedLog.length - 1; i++) {
                    if (Math.round(Math.abs((sortedLog[i] - sortedLog[i+1]) / oneDay)) === 1) streak++;
                    else break;
                }
            }
            return streak;
        }

        // --- YENÄ°: NEFES EGZERSÄ°ZÄ° FONKSÄ°YONLARI ---
        let breathInterval;
        const breathSounds = {
            in: new Audio('https://actions.google.com/sounds/v1/weather/wind_synthetic.ogg'),
            out: new Audio('https://actions.google.com/sounds/v1/foley/air_woosh_underwater.ogg')
        };
        breathSounds.in.preload = 'auto';
        breathSounds.out.preload = 'auto';
        
        function startBreathing() {
            document.getElementById('breath-modal').classList.remove('hidden');
            const circle = document.getElementById('breath-circle-inner');
            const text = document.getElementById('breath-text');
            
            // Sesleri hazÄ±rla
            breathSounds.in.volume = 1.0;
            breathSounds.out.volume = 1.0;

            // Ä°lk nefes al
            text.innerText = "NEFES AL";
            circle.style.transform = "scale(1.5)";
            breathSounds.in.play().catch(e => console.log("Ses hatasÄ±:", e));
            
            breathInterval = setInterval(() => {
                const isExpanded = circle.style.transform === "scale(1.5)";
                if(isExpanded) {
                    text.innerText = "NEFES VER";
                    circle.style.transform = "scale(1)";
                    breathSounds.out.play().catch(e => console.log("Ses hatasÄ±:", e));
                } else {
                    text.innerText = "NEFES AL";
                    circle.style.transform = "scale(1.5)";
                    breathSounds.in.play().catch(e => console.log("Ses hatasÄ±:", e));
                }
            }, 4000); // 4 saniyede bir deÄŸiÅŸim
        }

        function stopBreathing() {
            clearInterval(breathInterval);
            document.getElementById('breath-modal').classList.add('hidden');
            // Reset
            document.getElementById('breath-circle-inner').style.transform = "scale(1)";
            // Sesleri durdur
            breathSounds.in.pause();
            breathSounds.in.currentTime = 0;
            breathSounds.out.pause();
            breathSounds.out.currentTime = 0;
        }

        function fireDailyGoalCelebration() {
            document.getElementById('daily-goal-modal').classList.remove('hidden');
            confetti({
                particleCount: 200,
                spread: 100,
                origin: { y: 0.6 },
                colors: ['#a855f7', '#3b82f6', '#ffffff']
            });
        }

        function closeDailyGoalModal() {
            document.getElementById('daily-goal-modal').classList.add('hidden');
        }

        // YENÄ°: KullanÄ±m KoÅŸullarÄ± Modal FonksiyonlarÄ±
        function openTermsModal() {
            document.getElementById('terms-modal').classList.remove('hidden');
        }

        function closeTermsModal() {
            document.getElementById('terms-modal').classList.add('hidden');
        }

        // YENÄ°: Liderlik Tablosu FonksiyonlarÄ±
        async function openLeaderboardModal() {
            // if (!auth || !auth.currentUser) {
            //     switchTab('profile'); // GiriÅŸ yapmamÄ±ÅŸsa profile yÃ¶nlendir
            //     return;
            // }
            // const modal = document.getElementById('leaderboard-modal'); // ArtÄ±k sayfa
            const list = document.getElementById('leaderboard-list');
            // modal.classList.remove('hidden');
            list.innerHTML = '<div class="text-center text-slate-500 py-10 animate-pulse">Liderler yÃ¼kleniyor...</div>';

            try {
                const query = db.collection('users').orderBy('gamificationData.xp', 'desc').limit(10);
                const snapshot = await query.get();

                if (snapshot.empty) {
                    list.innerHTML = '<div class="text-center text-slate-500 py-10">HenÃ¼z sÄ±ralamada kimse yok.</div>';
                    return;
                }

                let rank = 1;
                let listHtml = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const xp = data.gamificationData ? Math.round(data.gamificationData.xp) : 0;
                    const avatar = data.photoURL || `https://ui-avatars.com/api/?name=${data.displayName}&background=1e293b&color=fff&size=128`;
                    
                    const isCurrentUser = doc.id === auth.currentUser.uid;
                    const highlightClass = isCurrentUser ? 'bg-amber-500/10 border-amber-500/50' : 'bg-slate-800/50 border-white/5';

                    listHtml += `
                        <div class="flex items-center gap-4 p-3 rounded-2xl border ${highlightClass} transition-all">
                            <div class="w-8 text-center font-black text-lg ${rank <= 3 ? 'text-amber-400' : 'text-slate-500'}">${rank}</div>
                            <img src="${avatar}" class="w-10 h-10 rounded-full object-cover border-2 border-slate-700" alt="Avatar">
                            <div class="flex-1 min-w-0"><p class="font-bold text-sm text-white truncate">${data.displayName || 'Ä°simsiz Kahraman'}</p><p class="text-[10px] text-slate-400 font-bold">${xp.toLocaleString('tr-TR')} XP</p></div>
                        </div>
                    `;
                    rank++;
                });
                list.innerHTML = listHtml;

            } catch (error) {
                console.error("Liderlik tablosu hatasÄ±:", error);
                list.innerHTML = `<div class="text-center text-red-500 py-10">Veriler yÃ¼klenemedi. LÃ¼tfen giriÅŸ yapÄ±n..</div>`;
            }
        }

        function closeLeaderboardModal() {
            // document.getElementById('leaderboard-modal').classList.add('hidden');
            switchTab('home');
        }

        // YENÄ°: Admin AyarlarÄ±
        // BURAYA YÃ–NETÄ°CÄ° E-POSTA ADRESLERÄ°NÄ° YAZIN
        const ADMIN_EMAILS = ["enfalbasaran@gmail.com", "admin@kpss.com", "fotomood7@gmail.com"]; 

        function isAdmin() {
            // GiriÅŸ yapÄ±lmamÄ±ÅŸsa veya e-posta yoksa false dÃ¶n
            if (!auth || !auth.currentUser || !auth.currentUser.email) {
                return false;
            }
            return ADMIN_EMAILS.includes(auth.currentUser.email);
        }

        // YENÄ°: Sohbet FonksiyonlarÄ±
        let chatUnsubscribe = null;
        let unreadChatCount = 0;
        let isChatInitialized = false;

        function openChatModal() {
            if (!auth || !auth.currentUser) {
                // switchTab('profile'); // GiriÅŸ yapmamÄ±ÅŸsa profile yÃ¶nlendir
                document.getElementById('chat-messages').innerHTML = '<div class="text-center text-slate-500 text-xs py-10">Sohbeti gÃ¶rmek iÃ§in lÃ¼tfen giriÅŸ yapÄ±n.</div>';
                return;
            }
            // document.getElementById('chat-modal').classList.remove('hidden');
            // loadMessages(); // ArtÄ±k initChatSystem ile global Ã§alÄ±ÅŸÄ±yor
            const container = document.getElementById('chat-messages');
            setTimeout(() => container.scrollTop = container.scrollHeight, 100);
            
            // Admin butonlarÄ±nÄ± gÃ¶ster/gizle
            if (isAdmin()) {
                document.getElementById('admin-controls').classList.remove('hidden');
            } else {
                document.getElementById('admin-controls').classList.add('hidden');
            }
        }

        function closeChatModal() {
            // document.getElementById('chat-modal').classList.add('hidden');
            if (chatUnsubscribe) {
                chatUnsubscribe(); // Dinlemeyi durdur (performans iÃ§in)
                chatUnsubscribe = null;
            }
            // Global dinleyiciyi kapatmÄ±yoruz
            switchTab('home');
        }

        // YENÄ°: Sohbet KurallarÄ± ModalÄ±
        function openChatRulesModal() {
            document.getElementById('chat-rules-modal').classList.remove('hidden');
        }
        function closeChatRulesModal() {
            document.getElementById('chat-rules-modal').classList.add('hidden');
        }

        function initChatSystem() {
            if (isChatInitialized) return;
            isChatInitialized = true;

            const container = document.getElementById('chat-messages');
            // Son 50 mesajÄ± tarihe gÃ¶re sÄ±rala
            const query = db.collection('public_chat').orderBy('createdAt', 'desc').limit(50);
            
            chatUnsubscribe = query.onSnapshot(snapshot => {
                const messages = [];
                snapshot.forEach(doc => messages.push({ id: doc.id, ...doc.data() }));
                
                // MesajlarÄ± eskiden yeniye doÄŸru sÄ±rala (sohbet akÄ±ÅŸÄ± iÃ§in)
                messages.reverse();
                
                container.innerHTML = '';
                if (messages.length === 0) {
                    container.innerHTML = '<div class="text-center text-slate-500 text-xs py-10">HenÃ¼z mesaj yok. Ä°lk mesajÄ± sen yaz! ğŸ‘‹</div>';
                }

                messages.forEach(msg => {
                    const isMine = msg.uid === auth.currentUser.uid;
                    const time = msg.createdAt ? new Date(msg.createdAt.toDate()).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' }) : '...';
                    const avatar = msg.photoURL || `https://ui-avatars.com/api/?name=${msg.displayName}&background=random&color=fff&size=64`;
                    
                    // Admin KontrolÃ¼ (MesajÄ± atan kiÅŸi admin mi?)
                    const isMsgFromAdmin = ADMIN_EMAILS.includes(msg.email);
                    const displayName = isMsgFromAdmin ? 'YÃ–NETÄ°CÄ°' : msg.displayName;
                    const adminBadge = isMsgFromAdmin ? '<span class="chat-badge-admin">ğŸ‘‘</span>' : '';
                    
                    // Silme Butonu (GiriÅŸ yapan kiÅŸi adminse veya kendi mesajÄ±ysa)
                    const canDelete = isAdmin() || isMine; 
                    const deleteBtn = canDelete ? `<span onclick="deleteMessage('${msg.id}')" class="delete-msg-btn" title="Sil">ğŸ—‘ï¸</span>` : '';

                    // Duyuru MesajÄ± mÄ±?
                    if (msg.type === 'announcement') {
                        container.innerHTML += `
                            <div class="chat-message announcement">
                                <div class="chat-bubble">ğŸ“¢ ${msg.text}</div>
                                <div class="chat-info mt-1 text-amber-500">YÃ–NETÄ°CÄ° DUYURUSU â€¢ ${time} ${isAdmin() ? deleteBtn : ''}</div>
                            </div>
                        `;
                    } else {
                        container.innerHTML += `
                            <div class="chat-message ${isMine ? 'mine' : ''} ${isMsgFromAdmin ? 'admin' : ''}">
                                <img src="${avatar}" class="w-8 h-8 rounded-full object-cover border border-white/10 shadow-sm shrink-0">
                                <div class="flex flex-col ${isMine ? 'items-end' : 'items-start'} max-w-[80%]">
                                    <div class="chat-info">${displayName} ${adminBadge} â€¢ ${time} ${deleteBtn}</div>
                                    <div class="chat-bubble">${msg.text}</div>
                                </div>
                            </div>
                        `;
                    }
                });

                // En alta kaydÄ±r
                container.scrollTop = container.scrollHeight;
                // EÄŸer sohbet sayfasÄ±ndaysak en alta kaydÄ±r
                if (document.getElementById('page-chat').classList.contains('active')) {
                    container.scrollTop = container.scrollHeight;
                }

                // Bildirim KontrolÃ¼
                snapshot.docChanges().forEach(change => {
                    if (change.type === 'added') {
                        const msg = change.doc.data();
                        const isChatActive = document.getElementById('page-chat').classList.contains('active');
                        if (auth.currentUser && msg.uid !== auth.currentUser.uid && !isChatActive) {
                            if (isChatReadyForNotifications) {
                                unreadChatCount++;
                                updateChatBadge();
                            }
                        }
                    }
                });
                
                isChatReadyForNotifications = true;
            });
        }
        
        let isChatReadyForNotifications = false;

        function updateChatBadge() {
            const badge = document.getElementById('chat-badge');
            if (unreadChatCount > 0) {
                badge.innerText = unreadChatCount > 9 ? '9+' : unreadChatCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text || !auth.currentUser) return;

            try {
                await db.collection('public_chat').add({
                    text: text,
                    uid: auth.currentUser.uid,
                    email: auth.currentUser.email, // Admin kontrolÃ¼ iÃ§in email ekledik
                    displayName: auth.currentUser.displayName || 'Ä°simsiz',
                    photoURL: auth.currentUser.photoURL,
                    type: 'text',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                input.value = '';
            } catch (error) {
                console.error("Mesaj gÃ¶nderme hatasÄ±:", error);
                alert("Mesaj gÃ¶nderilemedi. Firebase kurallarÄ±nÄ± kontrol et (public_chat izni).");
            }
        }

        // YENÄ°: Mesaj Silme
        async function deleteMessage(msgId) {
            if(!confirm("Bu mesajÄ± silmek istediÄŸine emin misin?")) return;
            try {
                await db.collection('public_chat').doc(msgId).delete();
            } catch(e) { 
                console.error(e);
                alert("Silme iÅŸlemi baÅŸarÄ±sÄ±z. Yetkiniz olmayabilir."); 
            }
        }

        // YENÄ°: Duyuru Modal FonksiyonlarÄ±
        function openCreateAnnouncementModal() {
            document.getElementById('create-announcement-modal').classList.remove('hidden');
        }

        function closeCreateAnnouncementModal() {
            document.getElementById('create-announcement-modal').classList.add('hidden');
        }

        async function publishAnnouncement() {
            const text = document.getElementById('announcement-text').value.trim();
            const toChat = document.getElementById('target-chat').checked;
            const toHome = document.getElementById('target-home').checked;

            if (!text) return;
            if (!toChat && !toHome) return alert("LÃ¼tfen en az bir yayÄ±nlama yeri seÃ§in.");
            
            if (!db) return alert("VeritabanÄ± baÄŸlantÄ±sÄ± kurulamadÄ±.");

            try {
                const batch = db.batch();
                const timestamp = firebase.firestore.FieldValue.serverTimestamp();
                const userData = {
                    uid: auth.currentUser.uid,
                    email: auth.currentUser.email,
                    displayName: auth.currentUser.displayName || 'YÃ–NETÄ°CÄ°',
                    photoURL: auth.currentUser.photoURL
                };

                if (toChat) {
                    const chatRef = db.collection('public_chat').doc();
                    batch.set(chatRef, {
                        ...userData,
                        text: text,
                        type: 'announcement',
                        createdAt: timestamp
                    });
                }

                if (toHome) {
                    const homeRef = db.collection('announcements').doc();
                    batch.set(homeRef, {
                        ...userData,
                        text: text,
                        createdAt: timestamp
                    });
                }

                await batch.commit();
                
                document.getElementById('announcement-text').value = '';
                closeCreateAnnouncementModal();
                alert("Duyuru baÅŸarÄ±yla yayÄ±nlandÄ±!");

            } catch (error) {
                console.error(error);
                alert("Hata: " + error.message);
            }
        }

        // YENÄ°: Duyuru ModalÄ± FonksiyonlarÄ±
        function showAnnouncementModal() {
            // EÄŸer bu oturumda daha Ã¶nce gÃ¶sterilmediyse gÃ¶ster
            if (!sessionStorage.getItem('announcement_shown')) {
                document.getElementById('announcement-modal').classList.remove('hidden');
                sessionStorage.setItem('announcement_shown', 'true');
            }
        }

        function closeAnnouncementModal() {
            document.getElementById('announcement-modal').classList.add('hidden');
        }

        // YENÄ°: Ana Ekran DuyurularÄ±nÄ± Dinle
        function initHomeAnnouncements() {
            const container = document.getElementById('home-announcements-container');
            // Son 1 duyuruyu getir
            db.collection('announcements').orderBy('createdAt', 'desc').limit(1)
                .onSnapshot(snapshot => {
                    if (snapshot.empty) {
                        container.classList.add('hidden');
                        return;
                    }
                    
                    const data = snapshot.docs[0].data();
                    container.innerHTML = `
                        <div class="bg-gradient-to-r from-amber-600 to-orange-600 rounded-2xl p-6 shadow-lg relative overflow-hidden flex items-center gap-4 animate-pulse">
                            <div class="text-4xl">ğŸ“¢</div>
                            <div class="flex-1">
                                <h4 class="text-white font-black uppercase text-sm mb-1">YÃ–NETÄ°CÄ° DUYURUSU</h4>
                                <p class="text-white font-medium text-xs leading-relaxed">${data.text}</p>
                            </div>
                            <button onclick="this.parentElement.remove()" class="text-white/50 hover:text-white">âœ•</button>
                        </div>
                    `;
                    container.classList.remove('hidden');
                });
        }

        // --- YENÄ°: POMODORO Ä°STATÄ°STÄ°K FONKSÄ°YONLARI ---
        let pomoStats = JSON.parse(localStorage.getItem('kpss_pomo_stats')) || { date: new Date().toLocaleDateString('tr-TR'), sessions: 0, minutes: 0 };
        const timerSound = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');

        function initPomoStats() {
            const today = new Date().toLocaleDateString('tr-TR');
            if (pomoStats.date !== today) {
                pomoStats = { date: today, sessions: 0, minutes: 0 };
                localStorage.setItem('kpss_pomo_stats', JSON.stringify(pomoStats));
            }
            updatePomoUI();
        }

        function updatePomoUI() {
            document.getElementById('pomo-sessions').innerText = pomoStats.sessions;
            document.getElementById('pomo-minutes').innerText = pomoStats.minutes;
        }

        function completePomodoro() {
            clearInterval(timer);
            isRunning = false;
            
            // Ä°statistikleri gÃ¼ncelle
            const duration = parseInt(document.getElementById('timer-input').value) || 25;
            pomoStats.sessions++;
            pomoStats.minutes += duration;
            addXp(XP_VALUES.POMODORO_SESSION, "Pomodoro Oturumu");
            localStorage.setItem('kpss_pomo_stats', JSON.stringify(pomoStats));
            if(window.saveUserData) window.saveUserData();
            updatePomoUI();

            // Ses Ã§al
            timerSound.play().catch(() => {});
            
            // ModalÄ± aÃ§
            document.getElementById('pomo-modal').classList.remove('hidden');
            resetTimer();
        }

        function startBreak(minutes) {
            document.getElementById('timer-input').value = minutes;
            closePomoModal();
            resetTimer();
            startTimer();
        }

        function startNewSession() {
            document.getElementById('timer-input').value = 25;
            closePomoModal();
            resetTimer();
            startTimer();
        }

        function closePomoModal() {
            document.getElementById('pomo-modal').classList.add('hidden');
        }

        // --- YENÄ°: HAP BÄ°LGÄ°LER (FLASHCARDS) FONKSÄ°YONLARI ---
        // YardÄ±mcÄ± fonksiyon: Demo verisi oluÅŸturmak iÃ§in
        function generateCards(lesson, topic, count, startReal = []) {
            const cards = startReal.map(item => ({ q: item.q, a: item.a }));
            for (let i = cards.length; i < count; i++) {
                cards.push({
                    q: `${lesson} - ${topic} konusunda bilinmesi gereken ${i + 1}. Ã¶nemli bilgi nedir?`,
                    a: `Bu, ${topic} konusundaki ${i + 1}. hap bilgidir. SÄ±navda Ã§Ä±kabilir, dikkat et!`
                });
            }
            return cards;
        }

        const flashcardsData = {
            tarih: [
                {
                    title: "1. BÃ¶lÃ¼m: Ä°slamiyet Ã–ncesi",
                    cards: generateCards("Tarih", "Ä°slamiyet Ã–ncesi", 15, [
                        { q: "Ä°lk TÃ¼rk kadÄ±n hÃ¼kÃ¼mdar kimdir?", a: "Tomris Hatun" },
                        { q: "TÃ¼rk adÄ±nÄ±n anlamÄ± Ã‡in kaynaklarÄ±nda ne olarak geÃ§er?", a: "MiÄŸfer" },
                        { q: "MuseviliÄŸi kabul eden ilk ve tek TÃ¼rk devleti?", a: "Hazarlar" },
                        { q: "BU BÄ°R DENEME YAZISIDIR?", a: "DENENDÄ°"}
                    ])
                },
                {
                    title: "2. BÃ¶lÃ¼m: Ä°lk TÃ¼rk Ä°slam",
                    cards: generateCards("Tarih", "TÃ¼rk Ä°slam", 15, [
                        { q: "MÄ±sÄ±r'da kurulan ilk TÃ¼rk Ä°slam devleti?", a: "TolunoÄŸullarÄ±" },
                        { q: "Kuran-Ä± Kerim'i TÃ¼rkÃ§eye Ã§eviren devlet?", a: "Akkoyunlular" }
                    ])
                },
                {
                    title: "3. BÃ¶lÃ¼m: OsmanlÄ± KuruluÅŸ",
                    cards: generateCards("Tarih", "OsmanlÄ± KuruluÅŸ", 15, [
                        { q: "OsmanlÄ±'da ilk bakÄ±r para kimin dÃ¶neminde basÄ±ldÄ±?", a: "Osman Bey" },
                        { q: "OsmanlÄ±'ya katÄ±lan ilk beylik?", a: "KaresioÄŸullarÄ±" }
                    ])
                }
            ],
            cografya: [
                {
                    title: "1. BÃ¶lÃ¼m: CoÄŸrafi Konum",
                    cards: generateCards("CoÄŸrafya", "Konum", 15, [
                        { q: "TÃ¼rkiye'nin en doÄŸusu ile batÄ±sÄ± arasÄ±ndaki zaman farkÄ±?", a: "76 Dakika" },
                        { q: "GÃ¼neÅŸin en geÃ§ battÄ±ÄŸÄ± ilimiz?", a: "Ã‡anakkale (GÃ¶kÃ§eada)" }
                    ])
                },
                {
                    title: "2. BÃ¶lÃ¼m: Yer Åekilleri",
                    cards: generateCards("CoÄŸrafya", "Yer Åekilleri", 15, [
                        { q: "TÃ¼rkiye'nin en yÃ¼ksek daÄŸÄ±?", a: "AÄŸrÄ± DaÄŸÄ±" },
                        { q: "TÃ¼rkiye'nin en bÃ¼yÃ¼k gÃ¶lÃ¼?", a: "Van GÃ¶lÃ¼" }
                    ])
                }
            ],
            vatandaslik: [
                {
                    title: "1. BÃ¶lÃ¼m: Temel Hukuk",
                    cards: generateCards("VatandaÅŸlÄ±k", "Hukuk", 15, [
                        { q: "Hukuk kurallarÄ±nÄ±n yaptÄ±rÄ±mÄ± nedir?", a: "Maddi YaptÄ±rÄ±m" },
                        { q: "KiÅŸiliÄŸin baÅŸlangÄ±cÄ± nedir?", a: "Tam ve saÄŸ doÄŸum" }
                    ])
                },
                {
                    title: "2. BÃ¶lÃ¼m: Yasama YÃ¼rÃ¼tme",
                    cards: generateCards("VatandaÅŸlÄ±k", "Anayasa", 15, [
                        { q: "Yasama yetkisi kime aittir?", a: "TBMM" },
                        { q: "Milletvekili seÃ§ilme yaÅŸÄ± kaÃ§tÄ±r?", a: "18" }
                    ])
                }
            ],
            guncel: [
                {
                    title: "1. BÃ¶lÃ¼m: GÃ¼ncel Bilgiler",
                    cards: generateCards("GÃ¼ncel", "Genel KÃ¼ltÃ¼r", 15, [
                        { q: "EXPO 2025 nerede dÃ¼zenlenecek?", a: "Osaka, Japonya" },
                        { q: "TÃ¼rkiye'nin ilk yerli otomobili?", a: "TOGG" }
                    ])
                }
            ]
        };

        let currentSubject = 'tarih';
        let currentChapterIndex = 0;
        let currentCardIndex = 0;

        function initFlashcards() {
            setFlashcardSubject('tarih');
        }

        function setFlashcardSubject(subject) {
            currentSubject = subject;
            currentChapterIndex = 0; // Ä°lk bÃ¶lÃ¼me dÃ¶n
            currentCardIndex = 0; // Ä°lk karta dÃ¶n
            
            // Buton stillerini gÃ¼ncelle
            document.querySelectorAll('.fc-subject-btn').forEach(btn => {
                btn.classList.remove('bg-pink-600', 'text-white', 'shadow-lg', 'bg-[var(--osym-card)]');
                btn.classList.add('bg-[var(--osym-card)]', 'text-slate-400', 'border', 'border-white/10');
            });
            const activeBtn = document.getElementById(`fc-btn-${subject}`);
            activeBtn.classList.remove('bg-[var(--osym-card)]', 'text-slate-400', 'border', 'border-white/10');
            activeBtn.classList.add('bg-pink-600', 'text-white', 'shadow-lg');

            renderChapters();
            renderFlashcard();
        }

        function renderChapters() {
            const list = document.getElementById('fc-chapter-list');
            list.innerHTML = '';
            
            flashcardsData[currentSubject].forEach((chapter, index) => {
                const btn = document.createElement('button');
                const isActive = index === currentChapterIndex;
                btn.className = `flex-shrink-0 px-4 py-2 rounded-xl text-[10px] font-bold uppercase transition-all border ${isActive ? 'bg-blue-600 text-white border-blue-500 shadow-lg' : 'bg-[var(--osym-card)] text-slate-400 border-white/10 hover:bg-white/5'}`;
                btn.innerText = chapter.title;
                btn.onclick = () => setFlashcardChapter(index);
                list.appendChild(btn);
            });
        }

        function setFlashcardChapter(index) {
            currentChapterIndex = index;
            currentCardIndex = 0;
            renderChapters(); // Aktif butonu gÃ¼ncellemek iÃ§in
            
            // KartÄ± sÄ±fÄ±rla
            const inner = document.getElementById('flashcard-inner');
            inner.classList.remove('flashcard-flipped');
            setTimeout(renderFlashcard, 600); // DÃ¶nme efekti bitince iÃ§eriÄŸi deÄŸiÅŸtir (yeni animasyon sÃ¼resi)
        }

        function renderFlashcard() {
            const chapter = flashcardsData[currentSubject][currentChapterIndex];
            const data = chapter.cards[currentCardIndex];
            
            // UI GÃ¼ncelle
            document.getElementById('fc-current-index').innerText = currentCardIndex + 1;
            document.getElementById('fc-total-count').innerText = chapter.cards.length;
            
            // Progress Bar
            const progress = ((currentCardIndex + 1) / chapter.cards.length) * 100;
            document.getElementById('fc-progress-mini').style.width = `${progress}%`;

            document.getElementById('fc-question').innerText = data.q;
            document.getElementById('fc-answer').innerText = data.a;
        }

        function flipFlashcard(event) {
            if(event) event.stopPropagation();
            document.getElementById('flashcard-inner').classList.toggle('flashcard-flipped');
        }

        function nextFlashcard(e) {
            if(e) e.stopPropagation(); // KartÄ±n dÃ¶nmesini engelle
            
            const chapter = flashcardsData[currentSubject][currentChapterIndex];
            let newIndex = currentCardIndex + 1;
            if (newIndex >= chapter.cards.length) {
                newIndex = 0; // BaÅŸa dÃ¶n
            }
            changeCard(newIndex);
        }

        function prevFlashcard(e) {
            if(e) e.stopPropagation();
            const chapter = flashcardsData[currentSubject][currentChapterIndex];
            let newIndex = currentCardIndex - 1;
            if (newIndex < 0) {
                newIndex = chapter.cards.length - 1; // Sona git
            }
            changeCard(newIndex);
        }

        function changeCard(newIndex) {
            const inner = document.getElementById('flashcard-inner');
            if (inner.classList.contains('flashcard-flipped')) {
                inner.classList.remove('flashcard-flipped');
                setTimeout(() => { currentCardIndex = newIndex; renderFlashcard(); }, 600); // Yeni animasyon sÃ¼resini bekle
            } else {
                currentCardIndex = newIndex; renderFlashcard();
            }
        }

        // --- YENÄ°: GRAFÄ°K (CHART.JS) FONKSÄ°YONLARI ---
        let examChart = null;

        function renderChart() {
            const ctx = document.getElementById('examChart').getContext('2d');
            
            // Veriyi tarihe gÃ¶re eskiden yeniye sÄ±rala
            const sortedHistory = [...examHistory].reverse();
            const labels = sortedHistory.map(e => e.date);
            const dataPoints = sortedHistory.map(e => e.score);

            if (examChart) {
                examChart.destroy();
            }

            examChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Puan GeliÅŸimi',
                        data: dataPoints,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#f59e0b',
                        pointRadius: 5,
                        tension: 0.4, // EÄŸrisel Ã§izgi
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { 
                            backgroundColor: '#1e293b',
                            titleColor: '#fff',
                            bodyColor: '#cbd5e1',
                            borderColor: 'rgba(255,255,255,0.1)',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }

        function setupCollapsibles() {
            const sections = document.querySelectorAll('.collapsible-on-mobile');
            sections.forEach(section => {
                const trigger = section.querySelector('.collapsible-trigger');
                if (trigger) {
                    trigger.addEventListener('click', () => {
                        if (window.innerWidth < 768) {
                            section.classList.toggle('is-open');
                        }
                    });
                }
            });
        }

        // --- YENÄ°: TEMA VE HARÄ°TA FONKSÄ°YONLARI ---
        function setTheme(themeName) {
            document.body.className = ''; // Ã–nceki temalarÄ± temizle
            if (themeName !== 'default') {
                document.body.classList.add(`theme-${themeName}`);
            }
            localStorage.setItem('kpss_theme', themeName);
            document.getElementById('theme-modal').classList.add('hidden');
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('kpss_theme') || 'default';
            setTheme(savedTheme);
        }

        function openMapModal() {
            renderMap();
            document.getElementById('map-modal').classList.remove('hidden');
        }

        function renderMap() {
            const container = document.getElementById('map-container');
            container.innerHTML = '';
            
            const wrapper = document.createElement('div');
            wrapper.className = 'map-wrapper';
            
            const line = document.createElement('div');
            line.className = 'map-line';
            wrapper.appendChild(line);

            weeks.forEach((week, index) => {
                let doneDaysCount = 0;
                week.days.forEach(dIdx => {
                    const isDayDone = rawData[dIdx].every((_, lIdx) => completedLessons[`${dIdx}-${lIdx}`]);
                    if (isDayDone) doneDaysCount++;
                });
                const isCompleted = doneDaysCount === week.days.length;
                const isLocked = index > 0 && !isWeekCompleted(index - 1);
                const isCurrent = !isCompleted && !isLocked;

                const item = document.createElement('div');
                item.className = 'map-item';

                const node = document.createElement('div');
                node.className = `map-node ${isCompleted ? 'completed' : ''} ${isCurrent ? 'current' : ''} ${isLocked ? 'locked' : ''}`;
                if (isLocked) {
                    node.innerHTML = `${index + 1}<div class="absolute -top-2 -right-2 text-xs bg-[var(--osym-dark)] rounded-full w-5 h-5 flex items-center justify-center border border-white/20 shadow-sm z-20">ğŸ”’</div>`;
                } else {
                    node.innerHTML = isCompleted ? 'âœ“' : (index + 1);
                }
                
                node.onclick = () => {
                    if(isLocked) return;
                    document.getElementById('map-modal').classList.add('hidden');
                    transitionToView(renderDays, week.id);
                };

                const content = document.createElement('div');
                content.className = `map-content ${index % 2 === 0 ? 'left' : 'right'}`;
                content.innerHTML = `
                    <div class="map-title ${isCurrent ? 'text-[var(--osym-accent)]' : ''}">${week.title}</div>
                    <div class="map-desc">${doneDaysCount}/${week.days.length} GÃ¼n TamamlandÄ±</div>
                `;

                item.appendChild(node);
                item.appendChild(content);
                wrapper.appendChild(item);
            });
            
            container.appendChild(wrapper);
            
            // Scroll to current
            setTimeout(() => {
                const current = wrapper.querySelector('.map-node.current');
                if(current) current.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        }

        function isWeekCompleted(weekIndex) {
            if (weekIndex < 0) return true;
            const week = weeks[weekIndex];
            let doneDaysCount = 0;
            week.days.forEach(dIdx => {
                const isDayDone = rawData[dIdx].every((_, lIdx) => completedLessons[`${dIdx}-${lIdx}`]);
                if (isDayDone) doneDaysCount++;
            });
            return doneDaysCount === week.days.length;
        }

        window.onload = () => { 
            renderWeeks(); 
            updateTimerDisplay(); 
            updateLiveMotivation();
            updateCountdown();
            renderExamHistory();
            renderTodos();
            initDailyPerformance();
            renderStreak(); // Streak yÃ¼kle
            initPomoStats(); // Pomodoro istatistiklerini yÃ¼kle
            renderChart(); // GrafiÄŸi Ã§iz
            initGamification(); // OyunlaÅŸtÄ±rmayÄ± yÃ¼kle
            initFlashcards(); // Hap bilgileri yÃ¼kle
            setupCollapsibles(); // Mobil iÃ§in aÃ§Ä±lÄ±r/kapanÄ±r bÃ¶lÃ¼mleri ayarla
            initTheme(); // TemayÄ± yÃ¼kle
            showAnnouncementModal(); // Duyuru modalÄ±nÄ± gÃ¶ster
            setInterval(updateLiveMotivation, 30000);
            setInterval(updateCountdown, 1000); // Saniyede bir gÃ¼ncelle
            if(db) initHomeAnnouncements(); // Ana ekran duyurularÄ±nÄ± baÅŸlat
        }
    </script>
</body>

</html>